import{_ as Q,c as m,o as r,w as o,a as s,b as e,Q as g,e as f,t as n,af as x,f as T,P as w,d as b,a8 as _,a9 as c,aa as p,ab as y,ac as v,aD as O,O as A,ay as V}from"./index-DVCerC9r.js";import{Q as C}from"./QSelect-DIiqx0qu.js";import{c as q,Q as D,b as h}from"./QList-DHcw5oJq.js";import{Q as L}from"./QBtnDropdown-BBk9AH-a.js";import{Q as E}from"./QBadge-gXV_d1J4.js";import{Q as N}from"./QInnerLoading-BfRCJ9I-.js";import{Q as j}from"./QPage-BkkVKuYx.js";import{C as k}from"./ClosePopup-2Vl9zOwm.js";import{h as S}from"./moment-BLMuvzoS.js";import"./format-XJ_3nmQE.js";import"./position-engine-BLvOGWon.js";const I={name:"ReporteAjusteCajaGarden",data(){return{loading:!1,title:"AJUSTE EN CAJA GARDEN ORURO",filters:{date_from:null,date_to:null,pago:null,user_id:null},users:[],rows:[],detalle:{ingresos_by_day:{},egresos_by_day:{}},totales:{ingresos:0,egresos:0,en_caja:0},selectedDay:null,pagoOptions:[{label:"Todos",value:null},{label:"EFECTIVO",value:"EFECTIVO"},{label:"QR",value:"QR"}]}},computed:{userOptions(){return[{label:"Todos",value:null},...this.users.map(d=>({label:d.name,value:d.id}))]},selectedRow(){return this.rows.find(d=>d.fecha===this.selectedDay)||null},ingSelected(){return this.selectedDay?this.detalle.ingresos_by_day?.[this.selectedDay]||{}:{}},egrSelectedList(){return this.selectedDay?this.detalle.egresos_by_day?.[this.selectedDay]||[]:[]}},mounted(){this.setWeek()},methods:{money(d){return Number(d||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},numberNoDecimals(d){return Number(d||0).toLocaleString("es-BO",{minimumFractionDigits:0,maximumFractionDigits:0})},setToday(){const d=S().format("YYYY-MM-DD");this.filters.date_from=d,this.filters.date_to=d,this.fetchData(!1)},setWeek(){const d=S().startOf("isoWeek"),t=S().endOf("isoWeek");this.filters.date_from=d.format("YYYY-MM-DD"),this.filters.date_to=t.format("YYYY-MM-DD"),this.fetchData(!1)},selectDay(d){this.selectedDay=d},async fetchData(d=!1){this.loading=!0;try{const t=d?{week:1}:{date_from:this.filters.date_from,date_to:this.filters.date_to,pago:this.filters.pago,user_id:this.filters.user_id},{data:u}=await this.$axios.get("reportes/ajuste-caja",{params:t});this.title=u.title||this.title,this.filters.date_from=u.date_from,this.filters.date_to=u.date_to,this.filters.pago=u.pago??this.filters.pago,this.filters.user_id=u.user_id??this.filters.user_id,this.users=u.users||[],this.rows=u.rows||[],this.detalle=u.detalle||{ingresos_by_day:{},egresos_by_day:{}},this.totales=u.totales||this.totales,this.selectedDay=this.rows?.[0]?.fecha||null}catch{this.$q.notify?.({type:"negative",message:"No se pudo cargar el reporte de ajuste en caja"})}finally{this.loading=!1}},exportExcel(){const d=new URLSearchParams({date_from:this.filters.date_from,date_to:this.filters.date_to,pago:this.filters.pago||"",user_id:this.filters.user_id||""}).toString();window.open(`${this.$axios.defaults.baseURL}/reportes/ajuste-caja/excel?${d}`,"_blank")}}},Y={class:"col-12 col-sm-4"},U={class:"text-h6 text-weight-bold"},B={class:"col-6 col-sm-2"},G={class:"col-6 col-sm-2"},F={class:"col-6 col-sm-2"},P={class:"col-6 col-sm-2"},M={class:"col-12 col-sm-2 text-right"},z={class:"row q-col-gutter-sm"},W={class:"col-12 col-md-7"},J={class:"table-wrap blue"},H={class:"pdf-table"},K=["onClick"],X={class:"td-center"},Z={class:"td-left"},$={class:"td-right td-bold"},ee={key:0},te={class:"col-12 col-md-5"},se={class:"totales-box"},le={class:"tot-row"},ae={class:"val"},oe={class:"tot-row"},ie={class:"val"},de={class:"tot-row tot-strong"},re={class:"val"},ne={class:"table-wrap orange"},ce={class:"pdf-table"},ue=["onClick"],me={class:"td-center"},fe={class:"td-left"},_e={class:"td-right td-bold"},he={key:0},ge={key:0,class:"day-chip"},pe={class:"text-weight-bold"},be={class:"q-ml-sm"},ye={class:"q-ml-sm"},ve={class:"q-ml-sm"},we={class:"col-auto"},De={class:"col-12 col-md-6"},ke={class:"panel-wrap"},Se={class:"mini-table"},xe={class:"td-left"},Oe={class:"td-right"},Ce={key:0},Ee={class:"col-12 col-md-6"},Re={class:"panel-wrap"},Qe={class:"mini-table"},Te={class:"td-left"},Ae={class:"td-right"},Ve={key:0};function qe(d,t,u,Le,i,a){return r(),m(j,{class:"q-pa-sm bg-grey-3"},{default:o(()=>[s(g,{flat:"",bordered:"",class:"q-mb-sm"},{default:o(()=>[s(f,{class:"row items-end q-col-gutter-sm"},{default:o(()=>[e("div",Y,[e("div",U,n(i.title),1),t[5]||(t[5]=e("div",{class:"text-caption text-grey-7"}," Semana Lun-Dom: totales por día (arriba) + desglose por día (abajo). ",-1))]),e("div",B,[s(x,{modelValue:i.filters.date_from,"onUpdate:modelValue":t[0]||(t[0]=l=>i.filters.date_from=l),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),e("div",G,[s(x,{modelValue:i.filters.date_to,"onUpdate:modelValue":t[1]||(t[1]=l=>i.filters.date_to=l),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])]),e("div",F,[s(C,{modelValue:i.filters.pago,"onUpdate:modelValue":t[2]||(t[2]=l=>i.filters.pago=l),options:i.pagoOptions,label:"Pago",dense:"",outlined:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"])]),e("div",P,[s(C,{modelValue:i.filters.user_id,"onUpdate:modelValue":t[3]||(t[3]=l=>i.filters.user_id=l),options:a.userOptions,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"])]),e("div",M,[s(T,{color:"primary",icon:"search",label:"Actualizar","no-caps":"",loading:i.loading,onClick:t[4]||(t[4]=l=>a.fetchData(!1)),class:"q-mr-sm"},null,8,["loading"]),s(L,{color:"grey-9",icon:"more_horiz",label:"Acciones","no-caps":""},{default:o(()=>[s(q,null,{default:o(()=>[w((r(),m(D,{clickable:"",onClick:a.setWeek},{default:o(()=>[s(h,{avatar:""},{default:o(()=>[s(b,{name:"date_range"})]),_:1}),s(h,null,{default:o(()=>[...t[6]||(t[6]=[_("Semana (Lun-Dom)",-1)])]),_:1})]),_:1},8,["onClick"])),[[k]]),w((r(),m(D,{clickable:"",onClick:a.setToday},{default:o(()=>[s(h,{avatar:""},{default:o(()=>[s(b,{name:"today"})]),_:1}),s(h,null,{default:o(()=>[...t[7]||(t[7]=[_("Hoy",-1)])]),_:1})]),_:1},8,["onClick"])),[[k]]),w((r(),m(D,{clickable:"",onClick:a.exportExcel},{default:o(()=>[s(h,{avatar:""},{default:o(()=>[s(b,{name:"grid_on"})]),_:1}),s(h,null,{default:o(()=>[...t[8]||(t[8]=[_("Exportar Excel",-1)])]),_:1})]),_:1},8,["onClick"])),[[k]])]),_:1})]),_:1})])]),_:1})]),_:1}),e("div",z,[e("div",W,[s(g,{flat:"",bordered:"",class:"card-like"},{default:o(()=>[s(f,{class:"q-pa-none"},{default:o(()=>[t[11]||(t[11]=e("div",{class:"pdf-title blue"},[e("div",{class:"pdf-title-left"},"INGRESOS (TOTAL POR DÍA)")],-1)),e("div",J,[e("table",H,[t[10]||(t[10]=e("thead",null,[e("tr",null,[e("th",{class:"th-center w-dia"},"DIA"),e("th",{class:"th-left"},"fecha"),e("th",{class:"th-right w-total"},"TOTAL")])],-1)),e("tbody",null,[(r(!0),c(y,null,v(i.rows,l=>(r(),c("tr",{key:l.fecha,class:O(["click-row",{active:i.selectedDay===l.fecha}]),onClick:R=>a.selectDay(l.fecha)},[e("td",X,n(l.dia),1),e("td",Z,n(l.label),1),e("td",$,n(a.numberNoDecimals(l.ingresos_total)),1)],10,K))),128)),i.rows.length?p("",!0):(r(),c("tr",ee,[...t[9]||(t[9]=[e("td",{colspan:"3",class:"td-center muted"},"Sin datos",-1)])]))])])])]),_:1})]),_:1})]),e("div",te,[s(g,{flat:"",bordered:"",class:"card-like q-mb-sm"},{default:o(()=>[s(f,{class:"q-pa-none"},{default:o(()=>[e("div",se,[t[15]||(t[15]=e("div",{class:"totales-title"},"TOTALES",-1)),e("div",le,[t[12]||(t[12]=e("div",{class:"label"},"INGRESOS",-1)),e("div",ae,n(a.money(i.totales.ingresos)),1)]),e("div",oe,[t[13]||(t[13]=e("div",{class:"label"},"EGRESOS",-1)),e("div",ie,n(a.money(i.totales.egresos)),1)]),e("div",de,[t[14]||(t[14]=e("div",{class:"label"},"EN CAJA",-1)),e("div",re,n(a.money(i.totales.en_caja)),1)])])]),_:1})]),_:1}),s(g,{flat:"",bordered:"",class:"card-like"},{default:o(()=>[s(f,{class:"q-pa-none"},{default:o(()=>[t[21]||(t[21]=e("div",{class:"pdf-title orange"},[e("div",{class:"pdf-title-left"},"EGRESOS (TOTAL POR DÍA)")],-1)),e("div",ne,[e("table",ce,[t[17]||(t[17]=e("thead",null,[e("tr",null,[e("th",{class:"th-center w-dia"},"DIA"),e("th",{class:"th-left"},"fecha"),e("th",{class:"th-right w-total"},"TOTAL")])],-1)),e("tbody",null,[(r(!0),c(y,null,v(i.rows,l=>(r(),c("tr",{key:l.fecha+"-e",class:O(["click-row",{active:i.selectedDay===l.fecha}]),onClick:R=>a.selectDay(l.fecha)},[e("td",me,n(l.dia),1),e("td",fe,n(l.label),1),e("td",_e,n(a.numberNoDecimals(l.egresos_total)),1)],10,ue))),128)),i.rows.length?p("",!0):(r(),c("tr",he,[...t[16]||(t[16]=[e("td",{colspan:"3",class:"td-center muted"},"Sin datos",-1)])]))])])]),a.selectedRow?(r(),c("div",ge,[s(b,{name:"event",class:"q-mr-xs"}),e("span",pe,n(a.selectedRow.label),1),e("span",be,[t[18]||(t[18]=_("| Ingresos: ",-1)),e("b",null,n(a.money(a.selectedRow.ingresos_total)),1)]),e("span",ye,[t[19]||(t[19]=_("| Egresos: ",-1)),e("b",null,n(a.money(a.selectedRow.egresos_total)),1)]),e("span",ve,[t[20]||(t[20]=_("| En caja: ",-1)),e("b",null,n(a.money(a.selectedRow.en_caja)),1)])])):p("",!0)]),_:1})]),_:1})])]),s(g,{flat:"",bordered:"",class:"q-mt-sm card-like"},{default:o(()=>[s(f,{class:"row items-center q-col-gutter-sm"},{default:o(()=>[t[22]||(t[22]=e("div",{class:"col"},[e("div",{class:"text-subtitle1 text-weight-bold"},"Desglose del día"),e("div",{class:"text-caption text-grey-7"}," Click en un día (arriba) para ver el detalle (ingresos por usuario + egresos itemizados). ")],-1)),e("div",we,[a.selectedRow?(r(),m(E,{key:0,color:"primary",label:a.selectedRow.label},null,8,["label"])):(r(),m(E,{key:1,color:"grey-7",label:"Selecciona un día"}))])]),_:1}),s(A),s(f,{class:"row q-col-gutter-sm"},{default:o(()=>[e("div",De,[t[25]||(t[25]=e("div",{class:"panel-title blue"},"INGRESOS (por usuario)",-1)),e("div",ke,[e("table",Se,[t[24]||(t[24]=e("thead",null,[e("tr",null,[e("th",{class:"th-left"},"Usuario"),e("th",{class:"th-right"},"Total")])],-1)),e("tbody",null,[(r(!0),c(y,null,v(i.users,l=>(r(),c("tr",{key:l.id},[e("td",xe,n(l.name),1),e("td",Oe,n(a.money(a.ingSelected[String(l.id)]||0)),1)]))),128)),i.users.length?p("",!0):(r(),c("tr",Ce,[...t[23]||(t[23]=[e("td",{colspan:"2",class:"td-center muted"},"Sin usuarios",-1)])]))])])])]),e("div",Ee,[t[28]||(t[28]=e("div",{class:"panel-title orange"},"EGRESOS (detalle)",-1)),e("div",Re,[e("table",Qe,[t[27]||(t[27]=e("thead",null,[e("tr",null,[e("th",{class:"th-left"},"Detalle"),e("th",{class:"th-right"},"Total")])],-1)),e("tbody",null,[(r(!0),c(y,null,v(a.egrSelectedList,l=>(r(),c("tr",{key:l.id},[e("td",Te,n(l.detalle),1),e("td",Ae,n(a.money(l.total)),1)]))),128)),a.egrSelectedList.length?p("",!0):(r(),c("tr",Ve,[...t[26]||(t[26]=[e("td",{colspan:"2",class:"td-center muted"},"Sin egresos",-1)])]))])])])])]),_:1})]),_:1}),s(N,{showing:i.loading},{default:o(()=>[s(V,{size:"40px"})]),_:1},8,["showing"])]),_:1})}const We=Q(I,[["render",qe],["__scopeId","data-v-8de19f7e"]]);export{We as default};
