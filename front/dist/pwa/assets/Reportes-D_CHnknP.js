import{_ as x,c as v,o as w,w as a,a as s,b as l,Q as r,e as n,aj as _,f as y,t as i,a5 as c,I as f}from"./index-CFijxswf.js";import{Q as k}from"./QSelect-BI3jy7Kf.js";import{Q as h}from"./QSpace-DEZis64Z.js";import{Q as p}from"./QBadge-B4qvL5Me.js";import{Q as g}from"./QTable-BlGfmXI_.js";import{Q as N}from"./QPage-C9pMFG-5.js";import"./format-DmcXr_N6.js";import"./QItem-DYqrvN-W.js";import"./QList-BW16JEPo.js";const Q={name:"ReportesPage",data(){return{loading:!1,users:[],filters:{date_from:"",date_to:"",user_id:null},kpis:{ingresos:0,egresos:0,neto:0,ventas:0,items:0,ticket_promedio:0},pagos:[],mesas:[],qr:{total:0,items:0},porDia:[],insumos:[],insumosResumen:{costo_insumos:0,ingresos:0,ganancia_aprox:0},colsPagos:[{name:"pago",label:"Pago",field:"pago",align:"left"},{name:"items",label:"# ventas",field:"items",align:"right",format:e=>Number(e).toLocaleString()},{name:"total",label:"Total (Bs)",field:"total",align:"right",format:e=>Number(e||0).toFixed(2)}],colsMesas:[{name:"mesa",label:"Mesa",field:"mesa",align:"left"},{name:"items",label:"# ventas",field:"items",align:"right",format:e=>Number(e).toLocaleString()},{name:"total",label:"Total (Bs)",field:"total",align:"right",format:e=>Number(e||0).toFixed(2)}],colsDia:[{name:"date",label:"Fecha",field:"date",align:"left"},{name:"ingreso",label:"Ingreso",field:"ingreso",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"egreso",label:"Egreso",field:"egreso",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"neto",label:"Neto",field:"neto",align:"right",format:e=>Number(e||0).toFixed(2)}],colsInsumos:[{name:"nombre",label:"Insumo",field:"nombre",align:"left"},{name:"unidad",label:"Unidad",field:"unidad",align:"left"},{name:"usado",label:"Cantidad usada",field:"usado",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"costo",label:"Costo unit.",field:"costo",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"costo_total",label:"Costo total",field:"costo_total",align:"right",format:e=>Number(e||0).toFixed(2)}]}},mounted(){this.prefillDates(),this.loadUsers(),this.fetchAll()},methods:{prefillDates(){const e=new Date,t=e.getFullYear(),m=String(e.getMonth()+1).padStart(2,"0"),b=`${t}-${m}-01`,o=`${t}-${m}-${String(new Date(t,e.getMonth()+1,0).getDate()).padStart(2,"0")}`;this.filters.date_from=b,this.filters.date_to=o},async loadUsers(){try{const{data:e}=await this.$axios.get("users");this.users=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[]}catch{}},async fetchAll(){this.loading=!0;try{const e={...this.filters},t=await this.$axios.get("reportes/ventas",{params:e});this.kpis=t.data?.kpis||this.kpis,this.pagos=t.data?.pagos||[],this.qr=t.data?.qr||{total:0,items:0},this.mesas=t.data?.mesas||[],this.porDia=t.data?.por_dia||[];const m=await this.$axios.get("reportes/insumos",{params:e});this.insumos=m.data?.consumo||[],this.insumosResumen=m.data?.resumen||this.insumosResumen}catch(e){const t=e?.response?.data?.message||"No se pudieron obtener los reportes";this.$q.notify?.({type:"negative",message:t})}finally{this.loading=!1}},money(e){return Number(e||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})}}},q={class:"col-12 col-sm-3"},B={class:"col-12 col-sm-3"},D={class:"col-12 col-sm-3"},F={class:"col-12 col-sm-3"},S={class:"row q-col-gutter-md q-mb-md"},V={class:"col-12 col-sm-6 col-md-3"},C={class:"text-h5 text-weight-bold"},I={class:"col-12 col-sm-6 col-md-3"},R={class:"text-h5 text-weight-bold"},A={class:"col-12 col-sm-6 col-md-3"},M={class:"text-h5 text-weight-bold"},U={class:"col-12 col-sm-6 col-md-3"},P={class:"text-h5 text-weight-bold"},T={class:"text-caption text-grey"},L={class:"row q-col-gutter-md q-mb-md"},E={class:"col-12 col-md-6"},j={class:"col-12 col-md-6"};function G(e,t,m,b,o,d){return w(),v(N,{class:"q-pa-md bg-grey-3"},{default:a(()=>[s(r,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[s(n,{class:"row q-col-gutter-sm items-end"},{default:a(()=>[l("div",q,[s(_,{modelValue:o.filters.date_from,"onUpdate:modelValue":t[0]||(t[0]=u=>o.filters.date_from=u),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),l("div",B,[s(_,{modelValue:o.filters.date_to,"onUpdate:modelValue":t[1]||(t[1]=u=>o.filters.date_to=u),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),l("div",D,[s(k,{modelValue:o.filters.user_id,"onUpdate:modelValue":t[2]||(t[2]=u=>o.filters.user_id=u),options:o.users,"option-value":"id","option-label":"name","emit-value":"","map-options":"",clearable:"",dense:"",outlined:"",label:"Usuario"},null,8,["modelValue","options"])]),l("div",F,[s(y,{color:"primary",icon:"search",label:"Consultar",loading:o.loading,"no-caps":"",class:"full-width",onClick:d.fetchAll},null,8,["loading","onClick"])])]),_:1})]),_:1}),l("div",S,[l("div",V,[s(r,{flat:"",bordered:"",class:"kpi kpi-green"},{default:a(()=>[s(n,null,{default:a(()=>[t[3]||(t[3]=l("div",{class:"text-caption text-positive"},"Ingresos",-1)),l("div",C,i(d.money(o.kpis.ingresos))+" Bs",1)]),_:1})]),_:1})]),l("div",I,[s(r,{flat:"",bordered:"",class:"kpi kpi-red"},{default:a(()=>[s(n,null,{default:a(()=>[t[4]||(t[4]=l("div",{class:"text-caption text-negative"},"Egresos",-1)),l("div",R,i(d.money(o.kpis.egresos))+" Bs",1)]),_:1})]),_:1})]),l("div",A,[s(r,{flat:"",bordered:"",class:"kpi kpi-indigo"},{default:a(()=>[s(n,null,{default:a(()=>[t[5]||(t[5]=l("div",{class:"text-caption"},"Neto",-1)),l("div",M,i(d.money(o.kpis.neto))+" Bs",1)]),_:1})]),_:1})]),l("div",U,[s(r,{flat:"",bordered:"",class:"kpi"},{default:a(()=>[s(n,null,{default:a(()=>[t[6]||(t[6]=l("div",{class:"text-caption"},"Ticket promedio",-1)),l("div",P,i(d.money(o.kpis.ticket_promedio))+" Bs",1),l("div",T,"#ventas: "+i(o.kpis.ventas)+" · ítems: "+i(o.kpis.items),1)]),_:1})]),_:1})])]),l("div",L,[l("div",E,[s(r,{flat:"",bordered:""},{default:a(()=>[s(n,{class:"row items-center"},{default:a(()=>[t[7]||(t[7]=l("div",{class:"text-subtitle1 text-weight-bold"},"Pagos",-1)),s(h),s(p,{color:"blue",outline:""},{default:a(()=>[c("QR: "+i(d.money(o.qr.total))+" Bs ("+i(o.qr.items)+")",1)]),_:1})]),_:1}),s(f),s(g,{rows:o.pagos,columns:o.colsPagos,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1})]),l("div",j,[s(r,{flat:"",bordered:""},{default:a(()=>[s(n,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>[...t[8]||(t[8]=[c("Mesas",-1)])]),_:1}),s(f),s(g,{rows:o.mesas,columns:o.colsMesas,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1})])]),s(r,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[s(n,{class:"text-subtitle1 text-weight-bold"},{default:a(()=>[...t[9]||(t[9]=[c("Movimiento por día",-1)])]),_:1}),s(f),s(g,{rows:o.porDia,columns:o.colsDia,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1}),s(r,{flat:"",bordered:""},{default:a(()=>[s(n,{class:"row items-center"},{default:a(()=>[t[10]||(t[10]=l("div",{class:"text-subtitle1 text-weight-bold"},"Consumo de insumos",-1)),s(h),s(p,{color:"orange",outline:"",class:"q-mr-sm"},{default:a(()=>[c("Costo: "+i(d.money(o.insumosResumen.costo_insumos))+" Bs",1)]),_:1}),s(p,{color:"green",outline:""},{default:a(()=>[c("Ganancia aprox: "+i(d.money(o.insumosResumen.ganancia_aprox))+" Bs",1)]),_:1})]),_:1}),s(f),s(g,{rows:o.insumos,columns:o.colsInsumos,dense:"",flat:"",bordered:"","rows-per-page-options":[10,20,0]},null,8,["rows","columns"])]),_:1})]),_:1})}const $=x(Q,[["render",G],["__scopeId","data-v-c75d9279"]]);export{$ as default};
