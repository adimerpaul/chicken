import{_ as v,c as f,o as p,w as s,a as e,a5 as m,t as u,J as h,d as b,f as d,aj as r,h as y,Q as C,e as k,b as a,am as N}from"./index-CFijxswf.js";import{Q as w,b as c,a as _}from"./QItem-DYqrvN-W.js";import{Q as x}from"./QList-BW16JEPo.js";import{Q as D}from"./QBtnDropdown-DmTQexuZ.js";import{Q as g}from"./QTd-CQX3v9o9.js";import{Q as U}from"./QBadge-B4qvL5Me.js";import{Q as S}from"./QTable-BlGfmXI_.js";import{Q as B}from"./QSpace-DEZis64Z.js";import{Q as q}from"./QSelect-BI3jy7Kf.js";import{Q as E}from"./QForm-BIGVEbL2.js";import{Q as I}from"./QPage-C9pMFG-5.js";import{C as Q}from"./ClosePopup-wmZgwW_X.js";import"./format-DmcXr_N6.js";const M={name:"InsumosPage",data(){return{rows:[],loading:!1,filter:"",dlg:!1,item:{},unidades:[{label:"UND",value:"UND"},{label:"KG",value:"KG"},{label:"LT",value:"LT"},{label:"PAQ",value:"PAQ"}],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"nombre",label:"Nombre",align:"left",field:"nombre",sortable:!0},{name:"unidad",label:"Unidad",align:"left",field:"unidad",sortable:!0},{name:"stock",label:"Stock",align:"left",field:"stock",sortable:!0},{name:"costo",label:"Costo (Bs)",align:"left",field:"costo",sortable:!0},{name:"min_stock",label:"Mínimo",align:"left",field:"min_stock"},{name:"descripcion",label:"Descripción",align:"left",field:"descripcion"}]}},mounted(){this.fetchRows()},methods:{formatMoney(i){return i=Number(i||0),i.toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},badgeColor(i){return i.min_stock&&Number(i.stock)<=Number(i.min_stock)?"negative":"primary"},async fetchRows(){this.loading=!0;try{const i=await this.$axios.get("insumos");this.rows=i.data}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo cargar")}finally{this.loading=!1}},onNew(){this.item={nombre:"",unidad:"UND",stock:0,costo:0,min_stock:null,descripcion:""},this.dlg=!0},onEdit(i){this.item={...i},this.dlg=!0},async onDelete(i){this.$alert.dialog("¿Eliminar el insumo?").onOk(async()=>{this.loading=!0;try{await this.$axios.delete(`insumos/${i}`),this.$alert?.success?.("Eliminado"),this.fetchRows()}catch(t){this.$alert?.error?.(t.response?.data?.message||"Error al eliminar")}finally{this.loading=!1}})},async submit(){this.loading=!0;try{this.item.id?(await this.$axios.put(`insumos/${this.item.id}`,this.item),this.$alert?.success?.("Actualizado")):(await this.$axios.post("insumos",this.item),this.$alert?.success?.("Creado")),this.dlg=!1,this.fetchRows()}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo guardar")}finally{this.loading=!1}}}},A={class:"row q-col-gutter-sm"},L={class:"col-12 col-sm-8"},P={class:"col-12 col-sm-4"},R={class:"col-6"},T={class:"col-6"},z={class:"col-6"},F={class:"col-12"},G={class:"text-right q-mt-md"};function O(i,t,K,j,o,n){return p(),f(I,{class:"q-pa-md"},{default:s(()=>[e(S,{rows:o.rows,columns:o.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Insumos",filter:o.filter},{"top-right":s(()=>[e(d,{color:"positive",label:"Nuevo",onClick:n.onNew,"no-caps":"",icon:"add_circle_outline",loading:o.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),e(d,{color:"primary",label:"Actualizar",onClick:n.fetchRows,"no-caps":"",icon:"refresh",loading:o.loading},null,8,["onClick","loading"]),e(r,{modelValue:o.filter,"onUpdate:modelValue":t[0]||(t[0]=l=>o.filter=l),label:"Buscar",dense:"",outlined:"",class:"q-ml-sm"},{append:s(()=>[e(b,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":s(l=>[e(g,{props:l},{default:s(()=>[e(D,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:s(()=>[e(x,null,{default:s(()=>[h((p(),f(w,{clickable:"",onClick:V=>n.onEdit(l.row)},{default:s(()=>[e(c,{avatar:""},{default:s(()=>[e(b,{name:"edit"})]),_:1}),e(c,null,{default:s(()=>[e(_,null,{default:s(()=>[...t[10]||(t[10]=[m("Editar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Q]]),h((p(),f(w,{clickable:"",onClick:V=>n.onDelete(l.row.id)},{default:s(()=>[e(c,{avatar:""},{default:s(()=>[e(b,{name:"delete"})]),_:1}),e(c,null,{default:s(()=>[e(_,null,{default:s(()=>[...t[11]||(t[11]=[m("Eliminar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Q]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-costo":s(l=>[e(g,{props:l},{default:s(()=>[m(u(n.formatMoney(l.row.costo)),1)]),_:2},1032,["props"])]),"body-cell-stock":s(l=>[e(g,{props:l},{default:s(()=>[e(U,{color:n.badgeColor(l.row),align:"middle"},{default:s(()=>[m(u(l.row.stock)+" "+u(l.row.unidad),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),e(y,{modelValue:o.dlg,"onUpdate:modelValue":t[9]||(t[9]=l=>o.dlg=l),persistent:""},{default:s(()=>[e(C,{style:{width:"520px","max-width":"90vw"}},{default:s(()=>[e(k,{class:"q-pb-none row items-center"},{default:s(()=>[a("div",null,u(o.item.id?"Editar":"Nuevo")+" insumo",1),e(B),e(d,{icon:"close",flat:"",round:"",dense:"",onClick:t[1]||(t[1]=l=>o.dlg=!1)})]),_:1}),e(k,{class:"q-pt-none"},{default:s(()=>[e(E,{onSubmit:N(n.submit,["prevent"])},{default:s(()=>[a("div",A,[a("div",L,[e(r,{modelValue:o.item.nombre,"onUpdate:modelValue":t[2]||(t[2]=l=>o.item.nombre=l),label:"Nombre",dense:"",outlined:""},null,8,["modelValue"])]),a("div",P,[e(q,{modelValue:o.item.unidad,"onUpdate:modelValue":t[3]||(t[3]=l=>o.item.unidad=l),label:"Unidad",dense:"",outlined:"",options:o.unidades,"emit-value":"","map-options":""},null,8,["modelValue","options"])]),a("div",R,[e(r,{modelValue:o.item.stock,"onUpdate:modelValue":t[4]||(t[4]=l=>o.item.stock=l),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Stock",dense:"",outlined:""},null,8,["modelValue"])]),a("div",T,[e(r,{modelValue:o.item.costo,"onUpdate:modelValue":t[5]||(t[5]=l=>o.item.costo=l),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Costo (Bs)",dense:"",outlined:""},null,8,["modelValue"])]),a("div",z,[e(r,{modelValue:o.item.min_stock,"onUpdate:modelValue":t[6]||(t[6]=l=>o.item.min_stock=l),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Stock mínimo",dense:"",outlined:""},null,8,["modelValue"])]),a("div",F,[e(r,{modelValue:o.item.descripcion,"onUpdate:modelValue":t[7]||(t[7]=l=>o.item.descripcion=l),type:"textarea",autogrow:"",label:"Descripción",dense:"",outlined:""},null,8,["modelValue"])])]),a("div",G,[e(d,{color:"negative",label:"Cancelar","no-caps":"",onClick:t[8]||(t[8]=l=>o.dlg=!1),loading:o.loading},null,8,["loading"]),e(d,{color:"primary",label:"Guardar","no-caps":"",class:"q-ml-sm",type:"submit",loading:o.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ae=v(M,[["render",O]]);export{ae as default};
