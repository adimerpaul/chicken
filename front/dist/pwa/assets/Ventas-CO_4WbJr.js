import{_ as U,c as y,o as d,w as a,b as s,a as l,Q as b,e as p,af as h,a9 as c,a8 as f,ab as v,ac as x,t as r,f as m,aa as C,d as Q,aq as N,h as A,ap as L,O as B,ai as D}from"./index-9SfE-Hb9.js";import{Q as S}from"./QChip-CRfxooJC.js";import{Q as _}from"./QSpace-CTrApUhu.js";import{Q as P}from"./QBadge-C6wJdJ1E.js";import{Q as I,b as V,a as k}from"./QItem-DxWjfZl6.js";import{Q as T}from"./QList-DtKPpibr.js";import{Q as w}from"./QSelect-Dx49PoVW.js";import{Q as E}from"./QPage-B95ABWpD.js";import{I as M}from"./ImprimirTicket-Do9M3lu9.js";import"./format-Dj_JoG5g.js";import"./position-engine-DhdGn4WK.js";const F={name:"VentasPage",data(){return{loading:!1,products:[],llagua:!0,categories:[{id:"Refrescos y Bebidas",name:"Refrescos y Bebidas",icon:"local_drink",color:"blue"},{id:"Acompañamientos",name:"Acompañamientos",icon:"restaurant",color:"teal"},{id:"Pollos",name:"Pollos",icon:"lunch_dining",color:"brown"}],search:"",categoryId:"",cart:[],payDlg:!1,client:{ci:"",name:"SN",mesa:"MESA",pago:"EFECTIVO",llamada:0,comment:""},recibido:"",cantidades:Array.from({length:100},(i,e)=>e+1)}},computed:{filteredProducts(){const i=(this.search||"").toLowerCase();return this.products.filter(e=>{const u=!this.categoryId||e.category_id===this.categoryId,q=!i||String(e.name||"").toLowerCase().includes(i)||String(e.description||"").toLowerCase().includes(i);return u&&q})},total(){return this.cart.reduce((i,e)=>i+Number(e.price||0)*Number(e.cantidadSale||0),0)}},mounted(){this.fetchAll()},methods:{money(i){return Number(i||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},imageUrl(i){return i.image_url||`${this.$url}/../storage/${i.image}`},async fetchAll(){this.loading=!0,this.$axios.get("productos").then(({data:i})=>{const e=Array.isArray(i)?i:[];this.products=e.map(u=>({...u,price:Number(u.price||0)}))}).catch(()=>{this.$q.notify?.({type:"negative",message:"No se pudieron cargar los productos"})}).finally(()=>{this.loading=!1})},selectCategory(i){this.categoryId=i},addToCart(i){const e=this.cart.findIndex(u=>u.id===i.id);e>=0?this.cart[e].cantidadSale+=1:this.cart.push({id:i.id,name:i.name,price:Number(i.price||0),cantidadSale:1}),this.$q.notify?.({type:"positive",message:`${i.name} agregado`})},removeFromCart(i){this.cart=this.cart.filter(e=>e.id!==i)},clearCart(){this.cart=[]},openPayDialog(){if(!this.cart.length){this.$q.notify?.({type:"warning",message:"Carrito vacío"});return}this.recibido="",this.payDlg=!0},toUpperName(){this.client.name=(this.client.name||"").toUpperCase()},async searchClient(){if(!this.client.ci){this.client.name="SN";return}try{const{data:i}=await this.$axios.get(`searchClient/${this.client.ci}`);i&&i.name&&(this.client.name=i.name)}catch{}},async submitSale(){if(!this.cart.length){this.$q.notify?.({type:"negative",message:"Carrito vacío"});return}this.loading=!0;try{const i={client:this.client,products:this.cart,mesa:this.client.mesa,llamada:this.client.llamada,pago:this.client.pago,comment:this.client.comment||""},{data:e}=await this.$axios.post("sales",i);this.$q.notify?.({type:"positive",message:"Venta realizada"}),M.ticket(e),this.cart=[],this.payDlg=!1,this.client={ci:"",name:"SN",mesa:"MESA",pago:"EFECTIVO",llamada:0,comment:""},this.recibido=""}catch(i){const e=i?.response?.data?.message||"No se pudo registrar la venta";this.$q.notify?.({type:"negative",message:e})}finally{this.loading=!1}}}},O={class:"row"},z={class:"col-12 col-md-8"},R={class:"row items-center q-col-gutter-sm"},G={class:"col-12 col-sm-4"},j={class:"col-12 col-sm-8"},H={class:"row items-center q-gutter-xs"},J={class:"row q-col-gutter-md q-mt-sm"},K={class:"relative-position",style:{height:"160px",background:"#111"}},W=["src"],X={key:1,class:"full-width full-height flex flex-center text-white"},Y={class:"absolute-bottom-right q-ma-sm bg-red text-white",style:{padding:"4px 10px","border-radius":"999px","font-weight":"700"}},Z={class:"absolute-bottom bg-gradient text-white q-pa-sm"},$={class:"text-subtitle2 text-weight-bold ellipsis-2-lines"},ee={class:"row items-center"},te={class:"text-caption text-grey"},le={key:0,class:"col-12"},oe={class:"col-12 col-md-4"},se={class:"row q-col-gutter-xs"},ie={class:"col-5"},ae={class:"col-5"},ne={class:"col-2 flex flex-center"},de={class:"text-bold"},re={class:"q-mt-sm text-right text-subtitle1"},ce={class:"row q-col-gutter-sm"},me={class:"col-12 col-md-3"},ue={class:"col-12 col-md-5"},ge={class:"col-6 col-md-2"},pe={class:"col-6 col-md-2"},he={class:"col-6 col-md-2"},fe={class:"col-6 col-md-2"},be={class:"col-12 col-md-8"},ye={class:"row items-center q-col-gutter-sm"},_e={class:"col-12 col-md-4"},ve={class:"col-12 col-md-4 text-red text-subtitle1 text-bold"},xe={class:"col-12 col-md-4 text-blue text-subtitle1 text-bold"},Ce={key:0};function Ve(i,e,u,q,o,n){return d(),y(E,{class:"bg-grey-3 q-pa-sm"},{default:a(()=>[s("div",O,[s("div",z,[l(b,{flat:"",bordered:""},{default:a(()=>[l(p,{class:"q-pa-sm"},{default:a(()=>[s("div",R,[s("div",G,[l(h,{modelValue:o.search,"onUpdate:modelValue":e[0]||(e[0]=t=>o.search=t),dense:"",outlined:"",debounce:"300",placeholder:"Buscar producto..."},null,8,["modelValue"])]),s("div",j,[s("div",H,[l(S,{clickable:"",color:o.categoryId===""?"indigo":"grey-4","text-color":o.categoryId===""?"white":"black",icon:"public",onClick:e[1]||(e[1]=t=>n.selectCategory(""))},{default:a(()=>[...e[14]||(e[14]=[f("Todo",-1)])]),_:1},8,["color","text-color"]),(d(!0),c(v,null,x(o.categories,t=>(d(),y(S,{key:t.id,clickable:"",color:o.categoryId===t.id?t.color||"indigo":"grey-4","text-color":o.categoryId===t.id?"white":"black",icon:t.icon||"category",onClick:g=>n.selectCategory(t.id)},{default:a(()=>[f(r(t.name),1)]),_:2},1032,["color","text-color","icon","onClick"]))),128)),l(_),l(m,{flat:"",color:"primary",icon:"refresh",loading:o.loading,onClick:n.fetchAll},null,8,["loading","onClick"])])])]),s("div",J,[(d(!0),c(v,null,x(n.filteredProducts,t=>(d(),c("div",{key:t.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[l(b,{class:"hoverable cursor-pointer",onClick:g=>n.addToCart(t)},{default:a(()=>[s("div",K,[t.image?(d(),c("img",{key:0,src:n.imageUrl(t),alt:"",style:{width:"100%",height:"100%","object-fit":"cover"},loading:"lazy"},null,8,W)):(d(),c("div",X,[l(Q,{name:"image",size:"48px"})])),s("div",Y,r(n.money(t.price))+" Bs ",1),s("div",Z,[s("div",$,r(t.name),1)])]),l(p,{class:"q-py-xs"},{default:a(()=>[s("div",ee,[l(P,{outline:"",color:"grey-7",class:"q-mr-sm"},{default:a(()=>[f(r(t.unit||"UND"),1)]),_:2},1024),s("div",te,r(t.categoria||"—"),1),l(_),l(m,{dense:"",round:"",flat:"",icon:"add_shopping_cart",onClick:N(g=>n.addToCart(t),["stop"])},null,8,["onClick"])])]),_:2},1024)]),_:2},1032,["onClick"])]))),128)),!o.loading&&!n.filteredProducts.length?(d(),c("div",le,[l(b,{flat:"",bordered:""},{default:a(()=>[l(p,{class:"text-center text-grey"},{default:a(()=>[...e[15]||(e[15]=[f("No hay productos",-1)])]),_:1})]),_:1})])):C("",!0)])]),_:1})]),_:1})]),s("div",oe,[l(b,{flat:"",bordered:""},{default:a(()=>[l(p,{class:"q-pa-sm row items-center bg-yellow-3"},{default:a(()=>[e[16]||(e[16]=s("div",{class:"text-subtitle1 text-bold"},"Carrito",-1)),l(_),l(m,{dense:"",color:"red",icon:"delete_sweep",label:"Limpiar","no-caps":"",onClick:n.clearCart},null,8,["onClick"])]),_:1}),l(p,{class:"q-pa-sm"},{default:a(()=>[l(T,{bordered:"",dense:""},{default:a(()=>[(d(!0),c(v,null,x(o.cart,t=>(d(),y(I,{key:t.id},{default:a(()=>[l(V,null,{default:a(()=>[l(k,{class:"text-bold"},{default:a(()=>[f(r(t.name),1)]),_:2},1024),l(k,{caption:""},{default:a(()=>[s("div",se,[s("div",ie,[l(h,{modelValue:t.price,"onUpdate:modelValue":g=>t.price=g,modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),s("div",ae,[l(h,{modelValue:t.cantidadSale,"onUpdate:modelValue":g=>t.cantidadSale=g,modelModifiers:{number:!0},type:"number",step:"1",min:"1",dense:"",outlined:""},{prepend:a(()=>[l(Q,{name:"shopping_cart",size:"14px"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),s("div",ne,[l(m,{dense:"",flat:"",round:"",icon:"delete",color:"red",onClick:g=>n.removeFromCart(t.id)},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024),l(V,{side:"",class:"text-right"},{default:a(()=>[s("div",de,r(n.money(t.price*t.cantidadSale)),1)]),_:2},1024)]),_:2},1024))),128)),o.cart.length?C("",!0):(d(),y(I,{key:0},{default:a(()=>[l(V,null,{default:a(()=>[l(k,{caption:""},{default:a(()=>[...e[17]||(e[17]=[f("Carrito vacío",-1)])]),_:1})]),_:1})]),_:1}))]),_:1}),s("div",re,[e[18]||(e[18]=s("b",null,"Total:",-1)),f(" "+r(n.money(n.total))+" Bs ",1)]),l(m,{class:"q-mt-md",color:"indigo",icon:"shopping_cart",label:"Pagar",disable:!o.cart.length,loading:o.loading,"no-caps":"",onClick:n.openPayDialog},null,8,["disable","loading","onClick"])]),_:1})]),_:1})])]),l(A,{modelValue:o.payDlg,"onUpdate:modelValue":e[13]||(e[13]=t=>o.payDlg=t),persistent:""},{default:a(()=>[l(b,{style:{width:"860px","max-width":"95vw"}},{default:a(()=>[l(p,{class:"q-pa-sm row items-center"},{default:a(()=>[e[19]||(e[19]=s("div",{class:"text-h6 text-bold"},"Pago",-1)),l(_),l(m,{flat:"",dense:"",icon:"close",onClick:e[2]||(e[2]=t=>o.payDlg=!1)})]),_:1}),l(p,{class:"q-pt-none"},{default:a(()=>[s("div",ce,[s("div",me,[l(h,{modelValue:o.client.ci,"onUpdate:modelValue":[e[3]||(e[3]=t=>o.client.ci=t),n.searchClient],label:"CI/NIT",outlined:"",dense:"",clearable:"",debounce:"300"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",ue,[l(h,{modelValue:o.client.name,"onUpdate:modelValue":[e[4]||(e[4]=t=>o.client.name=t),n.toUpperName],label:"Nombre",outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue"])]),s("div",ge,[l(w,{modelValue:o.client.mesa,"onUpdate:modelValue":e[5]||(e[5]=t=>o.client.mesa=t),label:"Mesa",outlined:"",dense:"",options:["MESA","LLEVAR"]},null,8,["modelValue"])]),s("div",pe,[l(w,{modelValue:o.client.pago,"onUpdate:modelValue":e[6]||(e[6]=t=>o.client.pago=t),label:"Pago",outlined:"",dense:"",options:["EFECTIVO","QR"]},null,8,["modelValue"])]),s("div",he,[l(w,{modelValue:o.client.llamada,"onUpdate:modelValue":e[7]||(e[7]=t=>o.client.llamada=t),label:"Llamada",outlined:"",dense:"",options:o.cantidades},null,8,["modelValue","options"])]),s("div",fe,[l(L,{modelValue:o.llagua,"onUpdate:modelValue":[e[8]||(e[8]=t=>o.llagua=t),e[9]||(e[9]=t=>o.client.comment=o.llagua?o.client.comment.replace("SIN LLAGUA",""):o.client.comment+" SIN LLAGUA")],label:"Llagua",dense:""},null,8,["modelValue"])]),s("div",be,[l(h,{modelValue:o.client.comment,"onUpdate:modelValue":e[10]||(e[10]=t=>o.client.comment=t),label:"Comentario",outlined:"",dense:""},null,8,["modelValue"])])]),l(B,{class:"q-my-sm"}),s("div",ye,[s("div",_e,[l(h,{modelValue:o.recibido,"onUpdate:modelValue":e[11]||(e[11]=t=>o.recibido=t),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Monto recibido",outlined:"",dense:""},null,8,["modelValue"])]),s("div",ve," Total: "+r(n.money(n.total))+" Bs ",1),s("div",xe,[o.recibido!==""?(d(),c("span",Ce,"Cambio: "+r(n.money(o.recibido-n.total))+" Bs",1)):C("",!0)])])]),_:1}),l(D,{align:"right"},{default:a(()=>[l(m,{flat:"",color:"negative",label:"Cancelar","no-caps":"",onClick:e[12]||(e[12]=t=>o.payDlg=!1)}),l(m,{color:"positive",label:"Confirmar y cobrar","no-caps":"",loading:o.loading,onClick:n.submitSale},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[20]||(e[20]=s("div",{id:"myelement",class:"hidden"},null,-1))]),_:1})}const De=U(F,[["render",Ve],["__scopeId","data-v-3f05ca12"]]);export{De as default};
