import{j as De,ad as N,z as qe,ae as Ue,B as _e,g as Ae,r as K,k as A,af as Ee,Z as Oe,ag as Ge,G as Ne,ah as ze,s as X,v as Y,O as $,U as ee,ai as Fe,l as se,T as Be,m as Ie,L as Le,_ as He,c as m,o as n,w as a,a as s,b,a6 as T,a7 as z,a8 as F,a9 as B,a5 as p,t as k,ab as je,d as v,J as S,f as c,aj as C,h as I,Q as L,e as P,ak as Me,al as Re}from"./index-B6V3Ze-P.js";import{Q as x,b as f,a as D}from"./QItem-Cs49oPqm.js";import{Q as le}from"./QList-DSXtuBMq.js";import{Q as We}from"./QBtnDropdown-5ru5qQh_.js";import{Q as E}from"./QTd-LGHuZmid.js";import{v as Je,a as te,u as Ze,p as ae,d as Ke,e as Xe,f as Ye,r as oe,s as $e,c as ie,Q as re}from"./format-D6R3fDkS.js";import{Q as es}from"./QImg-oaKHA1Ww.js";import{Q as ne}from"./QBadge-BIHiN6Wi.js";import{Q as ss}from"./QTable-BUplLhHL.js";import{Q as H}from"./QSpace-BJqOMTX5.js";import{Q as ls}from"./QSelect-CoaHKff4.js";import{Q as ue}from"./QForm-CfPgOmCl.js";import{Q as ts}from"./QPage-Bxs0I-s-.js";import{C as q}from"./ClosePopup-B2NCcMBN.js";import"./moment-BLMuvzoS.js";const as=De({name:"QTooltip",inheritAttrs:!1,props:{...Ze,..._e,...N,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...N.transitionShow,default:"jump-down"},transitionHide:{...N.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:te},self:{type:String,default:"top middle",validator:te},offset:{type:Array,default:()=>[14,14],validator:Je},scrollTarget:Ue,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...qe],setup(t,{slots:e,emit:g,attrs:u}){let o,r;const l=Ae(),{proxy:{$q:i}}=l,w=K(null),U=K(!1),de=A(()=>ae(t.anchor,i.lang.rtl)),me=A(()=>ae(t.self,i.lang.rtl)),ce=A(()=>t.persistent!==!0),{registerTick:fe,removeTick:ge}=Ee(),{registerTimeout:_}=Oe(),{transitionProps:pe,transitionStyle:he}=Ge(t),{localScrollTarget:j,changeScrollEvent:ve,unconfigureScrollTarget:be}=Ke(t,J),{anchorEl:h,canShow:ye,anchorEvents:V}=Xe({showing:U,configureAnchorEl:Qe}),{show:we,hide:O}=Ne({showing:U,canShow:ye,handleShow:Ce,handleHide:Pe,hideOnRouteChange:ce,processOnMount:!0});Object.assign(V,{delayShow:xe,delayHide:Ve});const{showPortal:M,hidePortal:R,renderPortal:ke}=ze(l,w,Se,"tooltip");if(i.platform.is.mobile===!0){const d={anchorEl:h,innerRef:w,onClickOutside(y){return O(y),y.target.classList.contains("q-dialog__backdrop")&&Le(y),!0}},G=A(()=>t.modelValue===null&&t.persistent!==!0&&U.value===!0);X(G,y=>{(y===!0?Ye:oe)(d)}),Y(()=>{oe(d)})}function Ce(d){M(),fe(()=>{r=new MutationObserver(()=>Q()),r.observe(w.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),Q(),J()}),o===void 0&&(o=X(()=>i.screen.width+"|"+i.screen.height+"|"+t.self+"|"+t.anchor+"|"+i.lang.rtl,Q)),_(()=>{M(!0),g("show",d)},t.transitionDuration)}function Pe(d){ge(),R(),W(),_(()=>{R(!0),g("hide",d)},t.transitionDuration)}function W(){r!==void 0&&(r.disconnect(),r=void 0),o!==void 0&&(o(),o=void 0),be(),$(V,"tooltipTemp")}function Q(){$e({targetEl:w.value,offset:t.offset,anchorEl:h.value,anchorOrigin:de.value,selfOrigin:me.value,maxHeight:t.maxHeight,maxWidth:t.maxWidth})}function xe(d){if(i.platform.is.mobile===!0){ie(),document.body.classList.add("non-selectable");const G=h.value,y=["touchmove","touchcancel","touchend","click"].map(Z=>[G,Z,"delayHide","passiveCapture"]);ee(V,"tooltipTemp",y)}_(()=>{we(d)},t.delay)}function Ve(d){i.platform.is.mobile===!0&&($(V,"tooltipTemp"),ie(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),_(()=>{O(d)},t.hideDelay)}function Qe(){if(t.noParentEvent===!0||h.value===null)return;const d=i.platform.is.mobile===!0?[[h.value,"touchstart","delayShow","passive"]]:[[h.value,"mouseenter","delayShow","passive"],[h.value,"mouseleave","delayHide","passive"]];ee(V,"anchor",d)}function J(){if(h.value!==null||t.scrollTarget!==void 0){j.value=Fe(h.value,t.scrollTarget);const d=t.noParentEvent===!0?Q:O;ve(j.value,d)}}function Te(){return U.value===!0?se("div",{...u,ref:w,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",u.class],style:[u.style,he.value],role:"tooltip"},Ie(e.default)):null}function Se(){return se(Be,pe.value,Te)}return Y(W),Object.assign(l.proxy,{updatePosition:Q}),ke}}),os={name:"UsuariosPage",data(){return{users:[],user:{},userDialog:!1,loading:!1,actionUser:"",gestiones:[],filter:"",roles:["Administrador","Vendedor"],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"name",label:"Nombre",align:"left",field:"name"},{name:"username",label:"Usuario",align:"left",field:"username"},{name:"avatar",label:"Avatar",align:"left",field:t=>t.avatar},{name:"role",label:"Rol",align:"left",field:"role"},{name:"permissions",label:"Permisos",align:"left",field:t=>(t.permissions||[]).map(e=>e.name).join(", ")}],permissions:[],dialogPermisos:!1,permFilter:"",cambioAvatarDialogo:!1,docentes:[]}},async mounted(){this.usersGet()},methods:{onFileChange(t){const e=t.target.files[0],g=new FormData;g.append("avatar",e),this.loading=!0,this.$axios.post(this.user.id+"/avatar",g,{headers:{"Content-Type":"multipart/form-data"}}).then(u=>{this.cambioAvatarDialogo=!1,this.$alert.success("Avatar actualizado"),this.usersGet()}).catch(u=>{this.$alert.error(u.response.data.message)}).finally(()=>{this.loading=!1})},cambiarAvatar(t){this.cambioAvatarDialogo=!0,this.user={...t}},userNew(){this.user={name:"",email:"",password:"",area_id:1,username:"",cargo:"",role:"Vendedor"},this.actionUser="Nuevo",this.userDialog=!0},usersGet(){this.loading=!0,this.users=[],this.$axios.get("users").then(t=>{this.users=t.data}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(t=>{this.gestiones=t.data,this.loading=!1}).catch(t=>{this.$alert.error(t.response.data.message),this.loading=!1})},userPost(){this.loading=!0,this.$axios.post("users",this.user).then(t=>{this.userDialog=!1,this.$alert.success("User creado"),this.usersGet()}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},userPut(){this.loading=!0,this.$axios.put("users/"+this.user.id,this.user).then(t=>{this.usersGet(),this.userDialog=!1,this.$alert.success("User actualizado")}).catch(t=>{this.$alert.error(t.response.data.message)}).finally(()=>{this.loading=!1})},async permisosShow(t){this.user={...t},this.dialogPermisos=!0,this.loading=!0;try{const e=await this.$axios.get("permissions").then(u=>u.data),g=await this.$axios.get(`users/${t.id}/permissions`).then(u=>u.data);this.permissions=e.map(u=>({...u,checked:g.includes(u.id)}))}catch(e){this.$alert.error(e.response?.data?.message||"Error cargando permisos")}finally{this.loading=!1}},async permisosPost(){this.loading=!0;try{const t=this.permissions.filter(e=>e.checked).map(e=>e.id);await this.$axios.put(`users/${this.user.id}/permissions`,{permissions:t}),this.dialogPermisos=!1,this.$alert.success("Permisos actualizados"),this.usersGet()}catch(t){this.$alert.error(t.response?.data?.message||"No se pudo guardar")}finally{this.loading=!1}},userEditPassword(t){this.user={...t},this.$alert.dialogPrompt("Nueva contraseña","Ingrese la nueva contraseña","password").onOk(e=>{this.$axios.put("updatePassword/"+t.id,{password:e}).then(g=>{this.usersGet(),this.$alert.success("Contraseña actualizada de "+t.username)}).catch(g=>{this.$alert.error(g.response.data.message)})})},userEdit(t){this.user={...t},this.actionUser="Editar",this.userDialog=!0},userDelete(t){this.$alert.dialog("¿Desea eliminar el user?").onOk(()=>{this.loading=!0,this.$axios.delete("users/"+t).then(e=>{this.usersGet(),this.$alert.success("User eliminado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})}},computed:{filteredPermissions(){if(!this.permFilter)return this.permissions;const t=this.permFilter.toLowerCase();return this.permissions.filter(e=>e.name.toLowerCase().includes(t))}}},is={class:"row items-center q-col-gutter-xs"},rs={class:"text-left"},ns={class:"text-right"},us={style:{position:"relative",top:"0",left:"0"}},ds=["src"],ms={class:"text-right"};function cs(t,e,g,u,o,r){return n(),m(ts,{class:"q-pa-md"},{default:a(()=>[s(ss,{rows:o.users,columns:o.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Usuarios",filter:o.filter},{"top-right":a(()=>[s(c,{color:"positive",label:"Nuevo",onClick:r.userNew,"no-caps":"",icon:"add_circle_outline",loading:o.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),s(c,{color:"primary",label:"Actualizar",onClick:r.usersGet,"no-caps":"",icon:"refresh",loading:o.loading},null,8,["onClick","loading"]),s(C,{modelValue:o.filter,"onUpdate:modelValue":e[0]||(e[0]=l=>o.filter=l),label:"Buscar",dense:"",outlined:""},{append:a(()=>[s(v,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":a(l=>[s(E,{props:l},{default:a(()=>[s(We,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:a(()=>[s(le,null,{default:a(()=>[S((n(),m(x,{clickable:"",onClick:i=>r.userEdit(l.row)},{default:a(()=>[s(f,{avatar:""},{default:a(()=>[s(v,{name:"edit"})]),_:1}),s(f,null,{default:a(()=>[s(D,null,{default:a(()=>[...e[20]||(e[20]=[p("Editar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[q]]),S((n(),m(x,{clickable:"",onClick:i=>r.userDelete(l.row.id)},{default:a(()=>[s(f,{avatar:""},{default:a(()=>[s(v,{name:"delete"})]),_:1}),s(f,null,{default:a(()=>[s(D,null,{default:a(()=>[...e[21]||(e[21]=[p("Eliminar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[q]]),S((n(),m(x,{clickable:"",onClick:i=>r.userEditPassword(l.row)},{default:a(()=>[s(f,{avatar:""},{default:a(()=>[s(v,{name:"lock_reset"})]),_:1}),s(f,null,{default:a(()=>[s(D,null,{default:a(()=>[...e[22]||(e[22]=[p("Cambiar contraseña",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[q]]),S((n(),m(x,{clickable:"",onClick:i=>r.cambiarAvatar(l.row)},{default:a(()=>[s(f,{avatar:""},{default:a(()=>[s(v,{name:"image"})]),_:1}),s(f,null,{default:a(()=>[s(D,null,{default:a(()=>[...e[23]||(e[23]=[p("Cambiar avatar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[q]]),S((n(),m(x,{clickable:"",onClick:i=>r.permisosShow(l.row)},{default:a(()=>[s(f,{avatar:""},{default:a(()=>[s(v,{name:"lock"})]),_:1}),s(f,null,{default:a(()=>[s(D,null,{default:a(()=>[...e[24]||(e[24]=[p("Permisos",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[q]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":a(l=>[s(E,{props:l},{default:a(()=>[s(re,{label:l.row.role,color:t.$filters.color(l.row.role),"text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),"body-cell-avatar":a(l=>[s(E,{props:l},{default:a(()=>[s(je,{rounded:""},{default:a(()=>[l.row.avatar?(n(),m(es,{key:0,src:`${t.$url}/../images/${l.row.avatar}`,width:"40px",height:"40px"},null,8,["src"])):(n(),m(v,{key:1,name:"person",size:"40px"}))]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-permissions":a(l=>[s(E,{props:l},{default:a(()=>[b("div",is,[(n(!0),T(F,null,B((l.row.permissions||[]).slice(0,3),(i,w)=>(n(),m(re,{key:i.id,dense:"",color:"grey-3","text-color":"black",size:"12px",class:"q-mr-xs q-mb-xs"},{default:a(()=>[p(k(i.name),1)]),_:2},1024))),128)),(l.row.permissions||[]).length>3?(n(),m(ne,{key:0,outline:"",color:"primary",class:"q-ml-xs"},{default:a(()=>[p(" +"+k((l.row.permissions||[]).length-3)+" ",1),s(as,{anchor:"top middle",self:"bottom middle",offset:[0,8]},{default:a(()=>[b("div",rs,[(n(!0),T(F,null,B(l.row.permissions,i=>(n(),T("div",{key:i.id},"• "+k(i.name),1))),128))])]),_:2},1024)]),_:2},1024)):z("",!0),(l.row.permissions||[]).length?z("",!0):(n(),m(ne,{key:1,color:"grey-5","text-color":"white",outline:""},{default:a(()=>[...e[25]||(e[25]=[p(" Sin permisos ",-1)])]),_:1}))])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),s(I,{modelValue:o.userDialog,"onUpdate:modelValue":e[9]||(e[9]=l=>o.userDialog=l),persistent:""},{default:a(()=>[s(L,{style:{width:"400px"}},{default:a(()=>[s(P,{class:"q-pb-none row items-center"},{default:a(()=>[b("div",null,k(o.actionUser)+" user ",1),s(H),s(c,{icon:"close",flat:"",round:"",dense:"",onClick:e[1]||(e[1]=l=>o.userDialog=!1)})]),_:1}),s(P,{class:"q-pt-none"},{default:a(()=>[s(ue,{onSubmit:e[8]||(e[8]=l=>o.user.id?r.userPut():r.userPost())},{default:a(()=>[s(C,{modelValue:o.user.name,"onUpdate:modelValue":e[2]||(e[2]=l=>o.user.name=l),label:"Nombre",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),s(C,{modelValue:o.user.username,"onUpdate:modelValue":e[3]||(e[3]=l=>o.user.username=l),label:"Usuario",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),s(C,{modelValue:o.user.email,"onUpdate:modelValue":e[4]||(e[4]=l=>o.user.email=l),label:"Email",dense:"",outlined:"",hint:""},null,8,["modelValue"]),o.user.id?z("",!0):(n(),m(C,{key:0,modelValue:o.user.password,"onUpdate:modelValue":e[5]||(e[5]=l=>o.user.password=l),label:"Contraseña",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])),s(ls,{modelValue:o.user.role,"onUpdate:modelValue":e[6]||(e[6]=l=>o.user.role=l),label:"Rol",dense:"",outlined:"",options:o.roles,rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","rules"]),b("div",ns,[s(c,{color:"negative",label:"Cancelar",onClick:e[7]||(e[7]=l=>o.userDialog=!1),"no-caps":"",loading:o.loading},null,8,["loading"]),s(c,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:o.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(I,{modelValue:o.cambioAvatarDialogo,"onUpdate:modelValue":e[15]||(e[15]=l=>o.cambioAvatarDialogo=l),persistent:""},{default:a(()=>[s(L,null,{default:a(()=>[s(P,{class:"q-pb-none row items-center text-bold"},{default:a(()=>[e[26]||(e[26]=p(" Cambiar avatar ",-1)),s(H),s(c,{icon:"close",flat:"",round:"",dense:"",onClick:e[10]||(e[10]=l=>o.cambioAvatarDialogo=!1)})]),_:1}),s(P,{class:"q-pt-none"},{default:a(()=>[s(ue,{onSubmit:e[14]||(e[14]=l=>r.userPut())},{default:a(()=>[b("div",null,[b("div",us,[s(c,{icon:"edit",size:"10px",class:"absolute q-mt-sm q-ml-sm",onClick:e[11]||(e[11]=l=>t.$refs.fileInput.click()),dense:"",outline:"",label:"Cambiar foto","no-caps":""})]),o.user.avatar?(n(),T("img",{key:0,src:`${t.$url}/../images/${o.user.avatar}`,width:"300px",height:"300px"},null,8,ds)):(n(),m(v,{key:1,name:"person",size:"100px"})),b("input",{ref:"fileInput",type:"file",style:{display:"none"},onChange:e[12]||(e[12]=(...l)=>r.onFileChange&&r.onFileChange(...l)),accept:"image/*"},null,544)]),b("div",ms,[s(c,{color:"negative",label:"Cancelar",onClick:e[13]||(e[13]=l=>o.cambioAvatarDialogo=!1),"no-caps":"",loading:o.loading},null,8,["loading"]),s(c,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:o.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(I,{modelValue:o.dialogPermisos,"onUpdate:modelValue":e[19]||(e[19]=l=>o.dialogPermisos=l),persistent:""},{default:a(()=>[s(L,{style:{"min-width":"420px"}},{default:a(()=>[s(P,{class:"q-pb-none row items-center text-bold"},{default:a(()=>[p(" Permisos de "+k(o.user.username)+" ",1),s(H),s(c,{icon:"close",flat:"",round:"",dense:"",onClick:e[16]||(e[16]=l=>o.dialogPermisos=!1)})]),_:1}),s(P,{class:"q-pt-none"},{default:a(()=>[s(C,{modelValue:o.permFilter,"onUpdate:modelValue":e[17]||(e[17]=l=>o.permFilter=l),dense:"",outlined:"",placeholder:"Filtrar permisos...",class:"q-mb-sm"},{append:a(()=>[s(v,{name:"search"})]),_:1},8,["modelValue"]),s(le,{dense:"",bordered:""},{default:a(()=>[(n(!0),T(F,null,B(r.filteredPermissions,l=>(n(),m(x,{key:l.id},{default:a(()=>[s(f,null,{default:a(()=>[p(k(l.name),1)]),_:2},1024),s(f,{side:""},{default:a(()=>[s(Me,{modelValue:l.checked,"onUpdate:modelValue":i=>l.checked=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(Re,{align:"right"},{default:a(()=>[s(c,{color:"negative",label:"Cancelar",onClick:e[18]||(e[18]=l=>o.dialogPermisos=!1),"no-caps":"",loading:o.loading},null,8,["loading"]),s(c,{color:"primary",label:"Guardar",onClick:r.permisosPost,"no-caps":"",loading:o.loading},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ss=He(os,[["render",cs]]);export{Ss as default};
