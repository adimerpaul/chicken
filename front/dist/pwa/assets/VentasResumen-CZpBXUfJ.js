import{_ as V,c as A,o as _,w as i,a as o,b as t,Q as c,e as u,af as x,f,t as a,a8 as r,d as y,O as v,a9 as h,aa as p,ab as b,ac as w,aA as g,ag as B}from"./index-9SfE-Hb9.js";import{Q as R}from"./QSpace-CTrApUhu.js";import{Q as q}from"./QChip-CRfxooJC.js";import{Q as T}from"./QBadge-C6wJdJ1E.js";import{Q as N}from"./QMarkupTable-qZZssitA.js";import{Q as L}from"./QInnerLoading-D9isOrIi.js";import{Q as C}from"./QPage-B95ABWpD.js";import{h as Q}from"./moment-BLMuvzoS.js";const k={name:"VentasResumen",data(){const l=Q().format("YYYY-MM-DD");return{loading:!1,filters:{date_from:l,date_to:l},resumen:{date_from:null,date_to:null,ventas_brutas:0,costo_insumos_vendidos:0,gastos:0,utilidad_bruta:0,utilidad_neta:0},mesaRows:[],llevarRows:[]}},computed:{mesaTot(){return this.sumTotales(this.mesaRows)},llevarTot(){return this.sumTotales(this.llevarRows)}},mounted(){this.fetchAll()},methods:{toNum(l){if(l==null)return 0;if(typeof l=="number")return isFinite(l)?l:0;const e=String(l).trim().replace(/\s/g,"").replace(/,/g,""),m=Number(e);return isFinite(m)?m:0},money(l){return this.toNum(l).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},num(l){return this.toNum(l).toLocaleString("es-BO",{maximumFractionDigits:2})},sumTotales(l){return(l||[]).reduce((e,m)=>(e.cantidad+=this.toNum(m.cantidad),e.venta+=this.toNum(m.total_venta),e.costo+=this.toNum(m.costo_insumos),e.utilidad+=this.toNum(m.utilidad),e),{cantidad:0,venta:0,costo:0,utilidad:0})},setToday(){const l=Q().format("YYYY-MM-DD");this.filters.date_from=l,this.filters.date_to=l,this.fetchAll()},async fetchAll(){this.loading=!0;try{await Promise.all([this.fetchResumen(),this.fetchMesa(),this.fetchLlevar()])}finally{this.loading=!1}},async fetchResumen(){const l={date_from:this.filters.date_from,date_to:this.filters.date_to},{data:e}=await this.$axios.get("salesResumen",{params:l});this.resumen={date_from:e.date_from,date_to:e.date_to,ventas_brutas:e.ventas_brutas||0,costo_insumos_vendidos:e.costo_insumos_vendidos||0,gastos:e.gastos||0,utilidad_bruta:e.utilidad_bruta||0,utilidad_neta:e.utilidad_neta||0}},async fetchMesa(){try{const l={date_from:this.filters.date_from,date_to:this.filters.date_to},{data:e}=await this.$axios.get("salesResumenProductosMesa",{params:l});this.mesaRows=Array.isArray(e)?e:[]}catch{this.mesaRows=[],this.$q.notify?.({type:"negative",message:"No se pudo cargar productos en MESA"})}},async fetchLlevar(){try{const l={date_from:this.filters.date_from,date_to:this.filters.date_to},{data:e}=await this.$axios.get("salesResumenProductosLlevar",{params:l});this.llevarRows=Array.isArray(e)?e:[]}catch{this.llevarRows=[],this.$q.notify?.({type:"negative",message:"No se pudo cargar productos para LLEVAR"})}}}},S={class:"col-6 col-sm-3"},D={class:"col-6 col-sm-3"},E={class:"col-12 col-sm-3 text-right"},M={class:"row q-col-gutter-sm"},U={class:"col-12 col-sm-3"},P={class:"text-h6 text-bold"},Y={class:"col-12 col-sm-3"},F={class:"text-h6 text-negative text-bold"},I={class:"col-12 col-sm-3"},O={class:"text-h6 text-negative text-bold"},z={class:"col-12 col-sm-3"},G={class:"text-h6 text-positive text-bold"},H={class:"text-caption text-grey-7"},j={class:"text-body2"},J={class:"row q-col-gutter-sm q-mt-sm"},K={class:"col-12 col-md-6"},W={class:"text-subtitle1 text-weight-bold"},X={class:"text-left"},Z={class:"text-weight-medium"},$={class:"text-caption text-grey-7"},tt={class:"text-left"},et={class:"text-right text-weight-bold"},st={class:"text-right"},ot={class:"text-right text-negative"},at={key:0},lt={class:"text-right text-weight-bold"},it={class:"text-right text-weight-bold"},dt={class:"text-right text-weight-bold text-negative"},nt={class:"col-12 col-md-6"},rt={class:"text-subtitle1 text-weight-bold"},ut={class:"text-left"},mt={class:"text-weight-medium"},ct={class:"text-caption text-grey-7"},_t={class:"text-left"},ht={class:"text-right text-weight-bold"},gt={class:"text-right"},xt={class:"text-right text-negative"},ft={key:0},yt={class:"text-right text-weight-bold"},vt={class:"text-right text-weight-bold"},pt={class:"text-right text-weight-bold text-negative"};function bt(l,e,m,wt,d,s){return _(),A(C,{class:"q-pa-sm bg-grey-3"},{default:i(()=>[o(c,{flat:"",bordered:"",class:"q-mb-sm"},{default:i(()=>[o(u,{class:"row items-end q-col-gutter-sm"},{default:i(()=>[e[2]||(e[2]=t("div",{class:"col-12 col-sm-3"},[t("div",{class:"text-h6 text-weight-bold"},"Resumen de Ventas"),t("div",{class:"text-caption text-grey-7"}," Ventas, costos, ganancias y productos por tipo (Mesa / Llevar) ")],-1)),t("div",S,[o(x,{modelValue:d.filters.date_from,"onUpdate:modelValue":e[0]||(e[0]=n=>d.filters.date_from=n),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),t("div",D,[o(x,{modelValue:d.filters.date_to,"onUpdate:modelValue":e[1]||(e[1]=n=>d.filters.date_to=n),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])]),t("div",E,[o(f,{color:"primary",icon:"search",label:"Actualizar","no-caps":"",loading:d.loading,onClick:s.fetchAll,class:"q-mr-sm"},null,8,["loading","onClick"]),o(f,{outline:"",color:"primary",icon:"filter_alt_off",label:"Hoy","no-caps":"",onClick:s.setToday},null,8,["onClick"])])]),_:1})]),_:1}),t("div",M,[t("div",U,[o(c,{flat:"",bordered:""},{default:i(()=>[o(u,{class:"q-pa-sm"},{default:i(()=>[e[3]||(e[3]=t("div",{class:"text-caption text-grey-7"},"Vendido (INGRESO)",-1)),t("div",P,a(s.money(d.resumen.ventas_brutas))+" Bs ",1)]),_:1})]),_:1})]),t("div",Y,[o(c,{flat:"",bordered:""},{default:i(()=>[o(u,{class:"q-pa-sm"},{default:i(()=>[e[4]||(e[4]=t("div",{class:"text-caption text-grey-7"},"Costo insumos vendidos",-1)),t("div",F,a(s.money(d.resumen.costo_insumos_vendidos))+" Bs ",1)]),_:1})]),_:1})]),t("div",I,[o(c,{flat:"",bordered:""},{default:i(()=>[o(u,{class:"q-pa-sm"},{default:i(()=>[e[5]||(e[5]=t("div",{class:"text-caption text-grey-7"},"Gastos / Egresos",-1)),t("div",O,a(s.money(d.resumen.gastos))+" Bs ",1)]),_:1})]),_:1})]),t("div",z,[o(c,{flat:"",bordered:""},{default:i(()=>[o(u,{class:"q-pa-sm"},{default:i(()=>[e[8]||(e[8]=t("div",{class:"text-caption text-grey-7"},"Ganancia neta",-1)),t("div",G,a(s.money(d.resumen.utilidad_neta))+" Bs ",1),t("div",H,[e[6]||(e[6]=r(" (Utilidad bruta: ",-1)),t("b",null,a(s.money(d.resumen.utilidad_bruta))+" Bs",1),e[7]||(e[7]=r(") ",-1))])]),_:1})]),_:1})])]),o(c,{flat:"",bordered:"",class:"q-mt-sm"},{default:i(()=>[o(u,{class:"q-pa-sm"},{default:i(()=>[t("div",j,[e[9]||(e[9]=r(" Entre ",-1)),t("b",null,a(d.resumen.date_from||"-"),1),e[10]||(e[10]=r(" y ",-1)),t("b",null,a(d.resumen.date_to||"-"),1),e[11]||(e[11]=r(" vendiste ",-1)),t("b",null,a(s.money(d.resumen.ventas_brutas))+" Bs",1),e[12]||(e[12]=r(", gastaste ",-1)),t("b",null,a(s.money(d.resumen.costo_insumos_vendidos+d.resumen.gastos))+" Bs",1),e[13]||(e[13]=r(" (insumos + egresos) y tu ganancia neta fue de ",-1)),t("b",null,a(s.money(d.resumen.utilidad_neta))+" Bs",1),e[14]||(e[14]=r(". ",-1))])]),_:1})]),_:1}),t("div",J,[t("div",K,[o(c,{flat:"",bordered:""},{default:i(()=>[o(u,{class:"row items-center q-pa-sm"},{default:i(()=>[t("div",W,[o(y,{name:"table_restaurant",class:"q-mr-xs"}),e[15]||(e[15]=r(" Productos en MESA ",-1))]),o(R),o(q,{dense:"",color:"indigo","text-color":"white",icon:"inventory_2"},{default:i(()=>[r(a(d.mesaRows.length)+" items ",1)]),_:1})]),_:1}),o(v),o(u,{class:"q-pa-none"},{default:i(()=>[o(N,{dense:"",flat:"",bordered:"",separator:"horizontal"},{default:i(()=>[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Producto"),t("th",{class:"text-left",style:{width:"70px"}},"Und"),t("th",{class:"text-right",style:{width:"95px"}},"Cant."),t("th",{class:"text-right",style:{width:"120px"}},"Venta"),t("th",{class:"text-right",style:{width:"120px"}},"Costo"),t("th",{class:"text-right",style:{width:"120px"}},"Utilidad")])],-1)),t("tbody",null,[(_(!0),h(b,null,w(d.mesaRows,n=>(_(),h("tr",{key:"mesa-"+(n.product_id||n.producto)},[t("td",X,[t("div",Z,a(n.producto),1),t("div",$,"ID: "+a(n.product_id),1)]),t("td",tt,[o(T,{outline:"",color:"grey-7"},{default:i(()=>[r(a(n.unidad||"UND"),1)]),_:2},1024)]),t("td",et,a(s.num(n.cantidad)),1),t("td",st,a(s.money(n.total_venta)),1),t("td",ot,a(s.money(n.costo_insumos)),1),t("td",{class:g(["text-right text-weight-bold",s.toNum(n.utilidad)>=0?"text-positive":"text-negative"])},a(s.money(n.utilidad)),3)]))),128)),!d.loading&&d.mesaRows.length===0?(_(),h("tr",at,[...e[16]||(e[16]=[t("td",{colspan:"6",class:"text-center text-grey q-pa-md"}," No hay ventas en MESA para este rango. ",-1)])])):p("",!0)]),t("tfoot",null,[t("tr",null,[e[17]||(e[17]=t("td",{colspan:"2",class:"text-right text-grey-7"},"TOTALES",-1)),t("td",lt,a(s.num(s.mesaTot.cantidad)),1),t("td",it,a(s.money(s.mesaTot.venta)),1),t("td",dt,a(s.money(s.mesaTot.costo)),1),t("td",{class:g(["text-right text-weight-bold",s.mesaTot.utilidad>=0?"text-positive":"text-negative"])},a(s.money(s.mesaTot.utilidad)),3)])])]),_:1})]),_:1})]),_:1})]),t("div",nt,[o(c,{flat:"",bordered:""},{default:i(()=>[o(u,{class:"row items-center q-pa-sm"},{default:i(()=>[t("div",rt,[o(y,{name:"takeout_dining",class:"q-mr-xs"}),e[19]||(e[19]=r(" Productos para LLEVAR ",-1))]),o(R),o(q,{dense:"",color:"deep-orange","text-color":"white",icon:"inventory_2"},{default:i(()=>[r(a(d.llevarRows.length)+" items ",1)]),_:1})]),_:1}),o(v),o(u,{class:"q-pa-none"},{default:i(()=>[o(N,{dense:"",flat:"",bordered:"",separator:"horizontal"},{default:i(()=>[e[22]||(e[22]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Producto"),t("th",{class:"text-left",style:{width:"70px"}},"Und"),t("th",{class:"text-right",style:{width:"95px"}},"Cant."),t("th",{class:"text-right",style:{width:"120px"}},"Venta"),t("th",{class:"text-right",style:{width:"120px"}},"Costo"),t("th",{class:"text-right",style:{width:"120px"}},"Utilidad")])],-1)),t("tbody",null,[(_(!0),h(b,null,w(d.llevarRows,n=>(_(),h("tr",{key:"llevar-"+(n.product_id||n.producto)},[t("td",ut,[t("div",mt,a(n.producto),1),t("div",ct,"ID: "+a(n.product_id),1)]),t("td",_t,[o(T,{outline:"",color:"grey-7"},{default:i(()=>[r(a(n.unidad||"UND"),1)]),_:2},1024)]),t("td",ht,a(s.num(n.cantidad)),1),t("td",gt,a(s.money(n.total_venta)),1),t("td",xt,a(s.money(n.costo_insumos)),1),t("td",{class:g(["text-right text-weight-bold",s.toNum(n.utilidad)>=0?"text-positive":"text-negative"])},a(s.money(n.utilidad)),3)]))),128)),!d.loading&&d.llevarRows.length===0?(_(),h("tr",ft,[...e[20]||(e[20]=[t("td",{colspan:"6",class:"text-center text-grey q-pa-md"}," No hay ventas para LLEVAR en este rango. ",-1)])])):p("",!0)]),t("tfoot",null,[t("tr",null,[e[21]||(e[21]=t("td",{colspan:"2",class:"text-right text-grey-7"},"TOTALES",-1)),t("td",yt,a(s.num(s.llevarTot.cantidad)),1),t("td",vt,a(s.money(s.llevarTot.venta)),1),t("td",pt,a(s.money(s.llevarTot.costo)),1),t("td",{class:g(["text-right text-weight-bold",s.llevarTot.utilidad>=0?"text-positive":"text-negative"])},a(s.money(s.llevarTot.utilidad)),3)])])]),_:1})]),_:1})]),_:1})])]),o(L,{showing:d.loading},{default:i(()=>[o(B,{size:"40px"})]),_:1},8,["showing"])]),_:1})}const Lt=V(k,[["render",bt]]);export{Lt as default};
