import{_ as Q,c as p,o as b,w as o,a as l,ap as g,af as d,a8 as c,t as _,P as k,d as v,f as m,h as C,Q as N,e as w,b as r,aq as U}from"./index-9SfE-Hb9.js";import{Q as h,b as f,a as V}from"./QItem-DxWjfZl6.js";import{Q as x}from"./QList-DtKPpibr.js";import{Q as S}from"./QBtnDropdown-BhS9rIRb.js";import{Q as u}from"./QTd-_FmILg_d.js";import{Q as D}from"./QChip-CRfxooJC.js";import{Q as q}from"./QTable-CwkvIVNk.js";import{Q as E}from"./QSpace-CTrApUhu.js";import{Q as B}from"./QSelect-Dx49PoVW.js";import{Q as I}from"./QForm-BpqmFjWG.js";import{Q as M}from"./QPage-B95ABWpD.js";import{C as y}from"./ClosePopup-AuAI_FHE.js";import"./format-Dj_JoG5g.js";import"./position-engine-DhdGn4WK.js";import"./QMarkupTable-qZZssitA.js";const A={name:"InsumosPage",data(){return{rows:[],loading:!1,filter:"",dlg:!1,item:{},unidades:[{label:"UND",value:"UND"},{label:"KG",value:"KG"},{label:"LT",value:"LT"},{label:"PAQ",value:"PAQ"}],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"nombre",label:"Nombre",align:"left",field:"nombre",sortable:!0},{name:"unidad",label:"Unidad",align:"left",field:"unidad",sortable:!0},{name:"stock",label:"Stock",align:"left",field:"stock",sortable:!0},{name:"costo",label:"Costo (Bs)",align:"left",field:"costo",sortable:!0},{name:"no_contar",label:"No contar en stock",align:"left",field:"no_contar"},{name:"es_mesa",label:"Es mesa",align:"left",field:"es_mesa"},{name:"es_llevar",label:"Es llevar",align:"left",field:"es_llevar"},{name:"min_stock",label:"Mínimo",align:"left",field:"min_stock"},{name:"descripcion",label:"Descripción",align:"left",field:"descripcion"}]}},mounted(){this.fetchRows()},methods:{async updateStock(s){if(s.id)try{this.loading=!0,await this.$axios.put(`insumos/${s.id}`,{stock:s.stock,no_contar:s.no_contar?1:0,es_mesa:s.es_mesa?1:0,es_llevar:s.es_llevar?1:0}),this.$alert?.success?.("Actualizado")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}},formatMoney(s){return s=Number(s||0),s.toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},badgeColor(s){return s.min_stock&&Number(s.stock)<=Number(s.min_stock)?"negative":"primary"},async fetchRows(){this.loading=!0;try{const s=await this.$axios.get("insumos");this.rows=s.data}catch(s){this.$alert?.error?.(s.response?.data?.message||"No se pudo cargar")}finally{this.loading=!1}},onNew(){this.item={nombre:"",unidad:"UND",stock:0,costo:0,min_stock:null,descripcion:""},this.dlg=!0},onEdit(s){this.item={...s},this.dlg=!0},async onDelete(s){this.$alert.dialog("¿Eliminar el insumo?").onOk(async()=>{this.loading=!0;try{await this.$axios.delete(`insumos/${s}`),this.$alert?.success?.("Eliminado"),this.fetchRows()}catch(t){this.$alert?.error?.(t.response?.data?.message||"Error al eliminar")}finally{this.loading=!1}})},async submit(){this.loading=!0;try{this.item.id?(await this.$axios.put(`insumos/${this.item.id}`,this.item),this.$alert?.success?.("Actualizado")):(await this.$axios.post("insumos",this.item),this.$alert?.success?.("Creado")),this.dlg=!1,this.fetchRows()}catch(s){this.$alert?.error?.(s.response?.data?.message||"No se pudo guardar")}finally{this.loading=!1}}}},P={class:"row q-col-gutter-sm"},z={class:"col-12 col-sm-8"},L={class:"col-12 col-sm-4"},R={class:"col-6"},T={class:"col-6"},F={class:"col-6"},G={class:"col-12"},O={class:"text-right q-mt-md"};function K(s,t,j,H,a,n){return b(),p(M,{class:"q-pa-md"},{default:o(()=>[l(q,{rows:a.rows,columns:a.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Insumos",filter:a.filter},{"top-right":o(()=>[l(m,{color:"secondary",label:"Desde almacén",onClick:t[0]||(t[0]=e=>s.$router.push("/movimientos-almacen-insumos/nuevo")),"no-caps":"",icon:"inventory_2",loading:a.loading,class:"q-mr-sm"},null,8,["loading"]),l(m,{color:"positive",label:"Nuevo",onClick:n.onNew,"no-caps":"",icon:"add_circle_outline",loading:a.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),l(m,{color:"primary",label:"Actualizar",onClick:n.fetchRows,"no-caps":"",icon:"refresh",loading:a.loading},null,8,["onClick","loading"]),l(d,{modelValue:a.filter,"onUpdate:modelValue":t[1]||(t[1]=e=>a.filter=e),label:"Buscar",dense:"",outlined:"",class:"q-ml-sm"},{append:o(()=>[l(v,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":o(e=>[l(u,{props:e},{default:o(()=>[l(S,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:o(()=>[l(x,null,{default:o(()=>[k((b(),p(h,{clickable:"",onClick:i=>n.onEdit(e.row)},{default:o(()=>[l(f,{avatar:""},{default:o(()=>[l(v,{name:"edit"})]),_:1}),l(f,null,{default:o(()=>[l(V,null,{default:o(()=>[...t[11]||(t[11]=[c("Editar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[y]]),k((b(),p(h,{clickable:"",onClick:i=>n.onDelete(e.row.id)},{default:o(()=>[l(f,{avatar:""},{default:o(()=>[l(v,{name:"delete"})]),_:1}),l(f,null,{default:o(()=>[l(V,null,{default:o(()=>[...t[12]||(t[12]=[c("Eliminar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[y]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-costo":o(e=>[l(u,{props:e},{default:o(()=>[c(_(n.formatMoney(e.row.costo)),1)]),_:2},1032,["props"])]),"body-cell-stock":o(e=>[l(u,{props:e},{default:o(()=>[l(d,{modelValue:e.row.stock,"onUpdate:modelValue":[i=>e.row.stock=i,i=>n.updateStock(e.row)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",step:"0.01",style:{"max-width":"150px"},debounce:"500"},{append:o(()=>[l(D,{dense:"",color:e.row.min_stock&&Number(e.row.stock)<=Number(e.row.min_stock)?"negative":"primary","text-color":"white"},{default:o(()=>[c(_(e.row.unidad),1)]),_:2},1032,["color"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-no_contar":o(e=>[l(u,{props:e},{default:o(()=>[l(g,{modelValue:e.row.no_contar,"onUpdate:modelValue":[i=>e.row.no_contar=i,i=>n.updateStock(e.row)],"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-es_mesa":o(e=>[l(u,{props:e},{default:o(()=>[l(g,{modelValue:e.row.es_mesa,"onUpdate:modelValue":[i=>e.row.es_mesa=i,i=>n.updateStock(e.row)],"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-es_llevar":o(e=>[l(u,{props:e},{default:o(()=>[l(g,{modelValue:e.row.es_llevar,"onUpdate:modelValue":[i=>e.row.es_llevar=i,i=>n.updateStock(e.row)],"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),l(C,{modelValue:a.dlg,"onUpdate:modelValue":t[10]||(t[10]=e=>a.dlg=e),persistent:""},{default:o(()=>[l(N,{style:{width:"520px","max-width":"90vw"}},{default:o(()=>[l(w,{class:"q-pb-none row items-center"},{default:o(()=>[r("div",null,_(a.item.id?"Editar":"Nuevo")+" insumo",1),l(E),l(m,{icon:"close",flat:"",round:"",dense:"",onClick:t[2]||(t[2]=e=>a.dlg=!1)})]),_:1}),l(w,{class:"q-pt-none"},{default:o(()=>[l(I,{onSubmit:U(n.submit,["prevent"])},{default:o(()=>[r("div",P,[r("div",z,[l(d,{modelValue:a.item.nombre,"onUpdate:modelValue":t[3]||(t[3]=e=>a.item.nombre=e),label:"Nombre",dense:"",outlined:""},null,8,["modelValue"])]),r("div",L,[l(B,{modelValue:a.item.unidad,"onUpdate:modelValue":t[4]||(t[4]=e=>a.item.unidad=e),label:"Unidad",dense:"",outlined:"",options:a.unidades,"emit-value":"","map-options":""},null,8,["modelValue","options"])]),r("div",R,[l(d,{modelValue:a.item.stock,"onUpdate:modelValue":t[5]||(t[5]=e=>a.item.stock=e),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Stock",dense:"",outlined:""},null,8,["modelValue"])]),r("div",T,[l(d,{modelValue:a.item.costo,"onUpdate:modelValue":t[6]||(t[6]=e=>a.item.costo=e),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Costo (Bs)",dense:"",outlined:""},null,8,["modelValue"])]),r("div",F,[l(d,{modelValue:a.item.min_stock,"onUpdate:modelValue":t[7]||(t[7]=e=>a.item.min_stock=e),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Stock mínimo",dense:"",outlined:""},null,8,["modelValue"])]),r("div",G,[l(d,{modelValue:a.item.descripcion,"onUpdate:modelValue":t[8]||(t[8]=e=>a.item.descripcion=e),type:"textarea",autogrow:"",label:"Descripción",dense:"",outlined:""},null,8,["modelValue"])])]),r("div",O,[l(m,{color:"negative",label:"Cancelar","no-caps":"",onClick:t[9]||(t[9]=e=>a.dlg=!1),loading:a.loading},null,8,["loading"]),l(m,{color:"primary",label:"Guardar","no-caps":"",class:"q-ml-sm",type:"submit",loading:a.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const de=Q(A,[["render",K]]);export{de as default};
