import{_ as x,c as w,o as v,w as l,a as e,b as a,Q as m,e as d,af as b,f as k,t as i,a8 as n,O as c}from"./index-D2Z3lgRK.js";import{Q as y}from"./QSelect-DfEOIbho.js";import{Q as p}from"./QSpace-n8o2liL3.js";import{Q as u}from"./QBadge-DEd0qZch.js";import{Q as _}from"./QTable-DwFpO_Jd.js";import{Q as F}from"./QPage-DPU8kwmd.js";import{h}from"./moment-BLMuvzoS.js";import"./QChip-BSLZ8Baf.js";import"./QItem-hbtxYLQf.js";import"./format-KGr3QpCO.js";import"./position-engine-BA0I2poh.js";import"./QList-DEnR3NzJ.js";import"./QMarkupTable-DEdMIXu9.js";const q={name:"ReportesPage",data(){return{loading:!1,users:[],filters:{date_from:"",date_to:"",user_id:null},kpis:{ingresos:0,egresos:0,neto:0,ventas:0,items:0,ticket_promedio:0},pagos:[],mesas:[],qr:{total:0,items:0},porDia:[],insumos:[],insumosResumen:{costo_insumos:0,ingresos:0,ganancia_aprox:0,cantidad_usada:0,stock_actual:0,cantidad_total:0},insumosFiltro:[],insumosFiltroResumen:{costo_insumos:0,cantidad_usada:0,stock_actual:0,cantidad_total:0},colsPagos:[{name:"pago",label:"Pago",field:"pago",align:"left"},{name:"items",label:"# ventas",field:"items",align:"right",format:s=>Number(s).toLocaleString()},{name:"total",label:"Total (Bs)",field:"total",align:"right",format:s=>Number(s||0).toFixed(2)}],colsMesas:[{name:"mesa",label:"Mesa",field:"mesa",align:"left"},{name:"items",label:"# ventas",field:"items",align:"right",format:s=>Number(s).toLocaleString()},{name:"total",label:"Total (Bs)",field:"total",align:"right",format:s=>Number(s||0).toFixed(2)}],colsDia:[{name:"date",label:"Fecha",field:"date",align:"left"},{name:"ingreso",label:"Ingreso",field:"ingreso",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"egreso",label:"Egreso",field:"egreso",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"neto",label:"Neto",field:"neto",align:"right",format:s=>Number(s||0).toFixed(2)}],colsInsumos:[{name:"nombre",label:"Insumo",field:"nombre",align:"left"},{name:"unidad",label:"Unidad",field:"unidad",align:"left"},{name:"total_cant",label:"Total",field:"total_cant",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"usado",label:"Cant. usada",field:"usado",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"stock_actual",label:"Stock actual",field:"stock_actual",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"costo",label:"Costo unit. (Bs)",field:"costo",align:"right",format:s=>Number(s||0).toFixed(2)},{name:"costo_total",label:"Costo total (Bs)",field:"costo_total",align:"right",format:s=>Number(s||0).toFixed(2)}]}},mounted(){this.prefillDates(),this.loadUsers(),this.fetchAll()},methods:{prefillDates(){this.filters.date_from=h().format("YYYY-MM-DD"),this.filters.date_to=h().format("YYYY-MM-DD")},async loadUsers(){try{const{data:s}=await this.$axios.get("users");this.users=Array.isArray(s?.data)?s.data:Array.isArray(s)?s:[]}catch{}},async fetchAll(){this.loading=!0;try{const s={...this.filters},o=await this.$axios.get("reportes/ventas",{params:s});this.kpis=o.data?.kpis||this.kpis,this.pagos=o.data?.pagos||[],this.qr=o.data?.qr||{total:0,items:0},this.mesas=o.data?.mesas||[],this.porDia=o.data?.por_dia||[];const f=await this.$axios.get("reportes/insumos",{params:s});this.insumos=f.data?.consumo||[],this.insumosResumen=f.data?.resumen||this.insumosResumen,this.insumosFiltro=f.data?.consumo_filtrado||[],this.insumosFiltroResumen=f.data?.resumen_filtrado||this.insumosFiltroResumen}catch(s){const o=s?.response?.data?.message||"No se pudieron obtener los reportes";this.$q.notify?.({type:"negative",message:o})}finally{this.loading=!1}},money(s){return Number(s||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},qty(s){return Number(s||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})}}},B={class:"col-12 col-sm-3"},N={class:"col-12 col-sm-3"},R={class:"col-12 col-sm-3"},D={class:"col-12 col-sm-3"},Q={class:"row q-col-gutter-md q-mb-md"},C={class:"col-12 col-sm-6 col-md-3"},S={class:"text-h5 text-weight-bold"},V={class:"col-12 col-sm-6 col-md-3"},M={class:"text-h5 text-weight-bold"},A={class:"col-12 col-sm-6 col-md-3"},I={class:"text-h5 text-weight-bold"},P={class:"col-12 col-sm-6 col-md-3"},T={class:"text-h5 text-weight-bold"},Y={class:"text-caption text-grey"},U={class:"row q-col-gutter-md q-mb-md"},L={class:"col-12 col-md-6"},O={class:"col-12 col-md-6"};function E(s,o,f,z,t,r){return v(),w(F,{class:"q-pa-md bg-grey-3"},{default:l(()=>[e(m,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[e(d,{class:"row q-col-gutter-sm items-end"},{default:l(()=>[a("div",B,[e(b,{modelValue:t.filters.date_from,"onUpdate:modelValue":o[0]||(o[0]=g=>t.filters.date_from=g),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),a("div",N,[e(b,{modelValue:t.filters.date_to,"onUpdate:modelValue":o[1]||(o[1]=g=>t.filters.date_to=g),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),a("div",R,[e(y,{modelValue:t.filters.user_id,"onUpdate:modelValue":o[2]||(o[2]=g=>t.filters.user_id=g),options:t.users,"option-value":"id","option-label":"name","emit-value":"","map-options":"",clearable:"",dense:"",outlined:"",label:"Usuario"},null,8,["modelValue","options"])]),a("div",D,[e(k,{color:"primary",icon:"search",label:"Consultar",loading:t.loading,"no-caps":"",class:"full-width",onClick:r.fetchAll},null,8,["loading","onClick"])])]),_:1})]),_:1}),a("div",Q,[a("div",C,[e(m,{flat:"",bordered:"",class:"kpi kpi-green"},{default:l(()=>[e(d,null,{default:l(()=>[o[3]||(o[3]=a("div",{class:"text-caption text-positive"},"Ingresos",-1)),a("div",S,i(r.money(t.kpis.ingresos))+" Bs",1)]),_:1})]),_:1})]),a("div",V,[e(m,{flat:"",bordered:"",class:"kpi kpi-red"},{default:l(()=>[e(d,null,{default:l(()=>[o[4]||(o[4]=a("div",{class:"text-caption text-negative"},"Egresos",-1)),a("div",M,i(r.money(t.kpis.egresos))+" Bs",1)]),_:1})]),_:1})]),a("div",A,[e(m,{flat:"",bordered:"",class:"kpi kpi-indigo"},{default:l(()=>[e(d,null,{default:l(()=>[o[5]||(o[5]=a("div",{class:"text-caption"},"Neto",-1)),a("div",I,i(r.money(t.kpis.neto))+" Bs",1)]),_:1})]),_:1})]),a("div",P,[e(m,{flat:"",bordered:"",class:"kpi"},{default:l(()=>[e(d,null,{default:l(()=>[o[6]||(o[6]=a("div",{class:"text-caption"},"Ticket promedio",-1)),a("div",T,i(r.money(t.kpis.ticket_promedio))+" Bs",1),a("div",Y," #ventas: "+i(t.kpis.ventas)+" · ítems: "+i(t.kpis.items),1)]),_:1})]),_:1})])]),a("div",U,[a("div",L,[e(m,{flat:"",bordered:""},{default:l(()=>[e(d,{class:"row items-center"},{default:l(()=>[o[7]||(o[7]=a("div",{class:"text-subtitle1 text-weight-bold"},"Pagos",-1)),e(p),e(u,{color:"blue",outline:""},{default:l(()=>[n(" QR: "+i(r.money(t.qr.total))+" Bs ("+i(t.qr.items)+") ",1)]),_:1})]),_:1}),e(c),e(_,{rows:t.pagos,columns:t.colsPagos,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1})]),a("div",O,[e(m,{flat:"",bordered:""},{default:l(()=>[e(d,{class:"text-subtitle1 text-weight-bold"},{default:l(()=>[...o[8]||(o[8]=[n(" Mesas ",-1)])]),_:1}),e(c),e(_,{rows:t.mesas,columns:t.colsMesas,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1})])]),e(m,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[e(d,{class:"text-subtitle1 text-weight-bold"},{default:l(()=>[...o[9]||(o[9]=[n(" Movimiento por día ",-1)])]),_:1}),e(c),e(_,{rows:t.porDia,columns:t.colsDia,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1}),e(m,{flat:"",bordered:""},{default:l(()=>[e(d,{class:"row items-center"},{default:l(()=>[...o[10]||(o[10]=[a("div",{class:"text-subtitle1 text-weight-bold"},"Consumo de insumos",-1)])]),_:1}),e(c),e(_,{rows:t.insumos,columns:t.colsInsumos,dense:"",flat:"",bordered:"","rows-per-page-options":[0,20,50,100]},null,8,["rows","columns"]),e(c),e(d,{class:"row items-center q-gutter-sm"},{default:l(()=>[e(u,{color:"orange",outline:""},{default:l(()=>[n(" Cantidad usada: "+i(r.qty(t.insumosResumen.cantidad_usada)),1)]),_:1}),e(u,{color:"indigo",outline:""},{default:l(()=>[n(" Stock actual: "+i(r.qty(t.insumosResumen.stock_actual)),1)]),_:1}),e(u,{color:"teal",outline:""},{default:l(()=>[n(" Total (usado + stock): "+i(r.qty(t.insumosResumen.cantidad_total)),1)]),_:1}),e(p),e(u,{color:"brown",outline:""},{default:l(()=>[n(" Costo insumos: "+i(r.money(t.insumosResumen.costo_insumos))+" Bs ",1)]),_:1}),e(u,{color:"green",outline:""},{default:l(()=>[n(" Ganancia aprox: "+i(r.money(t.insumosResumen.ganancia_aprox))+" Bs ",1)]),_:1})]),_:1})]),_:1}),e(m,{flat:"",bordered:"",class:"q-mt-md"},{default:l(()=>[e(d,{class:"row items-center"},{default:l(()=>[o[11]||(o[11]=a("div",{class:"text-subtitle1 text-weight-bold"}," Consumo (Bebidas + Pollo/Papa/Arroz) ",-1)),e(p),e(u,{color:"orange",outline:""},{default:l(()=>[n(" Cantidad usada: "+i(r.qty(t.insumosFiltroResumen.cantidad_usada)),1)]),_:1}),e(u,{color:"indigo",outline:""},{default:l(()=>[n(" Stock actual: "+i(r.qty(t.insumosFiltroResumen.stock_actual)),1)]),_:1}),e(u,{color:"teal",outline:""},{default:l(()=>[n(" Total: "+i(r.qty(t.insumosFiltroResumen.cantidad_total)),1)]),_:1}),e(u,{color:"brown",outline:""},{default:l(()=>[n(" Costo: "+i(r.money(t.insumosFiltroResumen.costo_insumos))+" Bs ",1)]),_:1})]),_:1}),e(c),e(_,{rows:t.insumosFiltro,columns:t.colsInsumos,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1})]),_:1})}const le=x(q,[["render",E],["__scopeId","data-v-e007ee8d"]]);export{le as default};
