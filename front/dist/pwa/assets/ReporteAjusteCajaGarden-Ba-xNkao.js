import{_ as O,c as m,o as d,w as o,a as s,b as t,Q as g,e as _,t as r,af as x,f as Q,P as w,d as y,a8 as f,a9 as c,aa as b,ab as p,ac as v,aD as C,O as A,ay as q}from"./index-BF4dt-Cm.js";import{b as L,Q as D,a as h}from"./QList-C0ZM9h-2.js";import{Q as N}from"./QBtnDropdown-Ro1hN3Wv.js";import{Q as R}from"./QBadge-B6AAQ0RY.js";import{Q as T}from"./QInnerLoading-DROHN7yd.js";import{Q as j}from"./QPage-DIMUm5LX.js";import{C as k}from"./ClosePopup-BHVHXZ4J.js";import{h as S}from"./moment-BLMuvzoS.js";import"./QMenu-k06FYV4R.js";import"./position-engine-BnOkn63N.js";const I={name:"ReporteAjusteCajaGarden",data(){return{loading:!1,title:"AJUSTE EN CAJA GARDEN ORURO",filters:{date_from:null,date_to:null},users:[],rows:[],detalle:{ingresos_by_day:{},egresos_by_day:{}},totales:{ingresos:0,egresos:0,en_caja:0},selectedDay:null}},computed:{selectedRow(){return this.rows.find(n=>n.fecha===this.selectedDay)||null},ingSelected(){return this.selectedDay?this.detalle.ingresos_by_day?.[this.selectedDay]||{}:{}},egrSelectedList(){return this.selectedDay?this.detalle.egresos_by_day?.[this.selectedDay]||[]:[]}},mounted(){this.setWeek()},methods:{money(n){return Number(n||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},numberNoDecimals(n){return Number(n||0).toLocaleString("es-BO",{minimumFractionDigits:0,maximumFractionDigits:0})},setToday(){const n=S().format("YYYY-MM-DD");this.filters.date_from=n,this.filters.date_to=n,this.fetchData(!1)},setWeek(){const n=S().startOf("isoWeek"),e=S().endOf("isoWeek");this.filters.date_from=n.format("YYYY-MM-DD"),this.filters.date_to=e.format("YYYY-MM-DD"),this.fetchData(!1)},selectDay(n){this.selectedDay=n},async fetchData(n=!1){this.loading=!0;try{const e=n?{week:1}:{date_from:this.filters.date_from,date_to:this.filters.date_to},{data:u}=await this.$axios.get("reportes/ajuste-caja",{params:e});this.title=u.title||this.title,this.filters.date_from=u.date_from,this.filters.date_to=u.date_to,this.users=u.users||[],this.rows=u.rows||[],this.detalle=u.detalle||{ingresos_by_day:{},egresos_by_day:{}},this.totales=u.totales||this.totales,this.selectedDay=this.rows?.[0]?.fecha||null}catch{this.$q.notify?.({type:"negative",message:"No se pudo cargar el reporte de ajuste en caja"})}finally{this.loading=!1}},exportExcel(){const n=new URLSearchParams({date_from:this.filters.date_from,date_to:this.filters.date_to}).toString();window.open(`${this.$axios.defaults.baseURL}/reportes/ajuste-caja/excel?${n}`,"_blank")}}},Y={class:"col-12 col-sm-4"},V={class:"text-h6 text-weight-bold"},B={class:"col-6 col-sm-3"},G={class:"col-6 col-sm-3"},U={class:"col-12 col-sm-2 text-right"},M={class:"row q-col-gutter-sm"},P={class:"col-12 col-md-7"},z={class:"table-wrap blue"},F={class:"pdf-table"},W=["onClick"],J={class:"td-center"},H={class:"td-left"},K={class:"td-right td-bold"},X={key:0},Z={class:"col-12 col-md-5"},$={class:"totales-box"},tt={class:"tot-row"},et={class:"val"},st={class:"tot-row"},lt={class:"val"},at={class:"tot-row tot-strong"},ot={class:"val"},dt={class:"table-wrap orange"},it={class:"pdf-table"},rt=["onClick"],nt={class:"td-center"},ct={class:"td-left"},ut={class:"td-right td-bold"},mt={key:0},_t={key:0,class:"day-chip"},ft={class:"text-weight-bold"},ht={class:"q-ml-sm"},gt={class:"q-ml-sm"},bt={class:"q-ml-sm"},yt={class:"col-auto"},pt={class:"col-12 col-md-6"},vt={class:"panel-wrap"},wt={class:"mini-table"},Dt={class:"td-left"},kt={class:"td-right"},St={key:0},xt={class:"col-12 col-md-6"},Ct={class:"panel-wrap"},Rt={class:"mini-table"},Et={class:"td-left"},Ot={class:"td-right"},Qt={key:0};function At(n,e,u,qt,i,l){return d(),m(j,{class:"q-pa-sm bg-grey-3"},{default:o(()=>[s(g,{flat:"",bordered:"",class:"q-mb-sm"},{default:o(()=>[s(_,{class:"row items-end q-col-gutter-sm"},{default:o(()=>[t("div",Y,[t("div",V,r(i.title),1),e[3]||(e[3]=t("div",{class:"text-caption text-grey-7"}," Semana Lun-Dom: totales por día (arriba) + desglose por día (abajo). ",-1))]),t("div",B,[s(x,{modelValue:i.filters.date_from,"onUpdate:modelValue":e[0]||(e[0]=a=>i.filters.date_from=a),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),t("div",G,[s(x,{modelValue:i.filters.date_to,"onUpdate:modelValue":e[1]||(e[1]=a=>i.filters.date_to=a),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])]),t("div",U,[s(Q,{color:"primary",icon:"search",label:"Actualizar","no-caps":"",loading:i.loading,onClick:e[2]||(e[2]=a=>l.fetchData(!1)),class:"q-mr-sm"},null,8,["loading"]),s(N,{color:"grey-9",icon:"more_horiz",label:"Acciones","no-caps":""},{default:o(()=>[s(L,null,{default:o(()=>[w((d(),m(D,{clickable:"",onClick:l.setWeek},{default:o(()=>[s(h,{avatar:""},{default:o(()=>[s(y,{name:"date_range"})]),_:1}),s(h,null,{default:o(()=>[...e[4]||(e[4]=[f("Semana (Lun-Dom)",-1)])]),_:1})]),_:1},8,["onClick"])),[[k]]),w((d(),m(D,{clickable:"",onClick:l.setToday},{default:o(()=>[s(h,{avatar:""},{default:o(()=>[s(y,{name:"today"})]),_:1}),s(h,null,{default:o(()=>[...e[5]||(e[5]=[f("Hoy",-1)])]),_:1})]),_:1},8,["onClick"])),[[k]]),w((d(),m(D,{clickable:"",onClick:l.exportExcel},{default:o(()=>[s(h,{avatar:""},{default:o(()=>[s(y,{name:"grid_on"})]),_:1}),s(h,null,{default:o(()=>[...e[6]||(e[6]=[f("Exportar Excel",-1)])]),_:1})]),_:1},8,["onClick"])),[[k]])]),_:1})]),_:1})])]),_:1})]),_:1}),t("div",M,[t("div",P,[s(g,{flat:"",bordered:"",class:"card-like"},{default:o(()=>[s(_,{class:"q-pa-none"},{default:o(()=>[e[9]||(e[9]=t("div",{class:"pdf-title blue"},[t("div",{class:"pdf-title-left"},"INGRESOS (TOTAL POR DÍA)")],-1)),t("div",z,[t("table",F,[e[8]||(e[8]=t("thead",null,[t("tr",null,[t("th",{class:"th-center w-dia"},"DIA"),t("th",{class:"th-left"},"fecha"),t("th",{class:"th-right w-total"},"TOTAL")])],-1)),t("tbody",null,[(d(!0),c(p,null,v(i.rows,a=>(d(),c("tr",{key:a.fecha,class:C(["click-row",{active:i.selectedDay===a.fecha}]),onClick:E=>l.selectDay(a.fecha)},[t("td",J,r(a.dia),1),t("td",H,r(a.label),1),t("td",K,r(l.numberNoDecimals(a.ingresos_total)),1)],10,W))),128)),i.rows.length?b("",!0):(d(),c("tr",X,[...e[7]||(e[7]=[t("td",{colspan:"3",class:"td-center muted"},"Sin datos",-1)])]))])])])]),_:1})]),_:1})]),t("div",Z,[s(g,{flat:"",bordered:"",class:"card-like q-mb-sm"},{default:o(()=>[s(_,{class:"q-pa-none"},{default:o(()=>[t("div",$,[e[13]||(e[13]=t("div",{class:"totales-title"},"TOTALES",-1)),t("div",tt,[e[10]||(e[10]=t("div",{class:"label"},"INGRESOS",-1)),t("div",et,r(l.money(i.totales.ingresos)),1)]),t("div",st,[e[11]||(e[11]=t("div",{class:"label"},"EGRESOS",-1)),t("div",lt,r(l.money(i.totales.egresos)),1)]),t("div",at,[e[12]||(e[12]=t("div",{class:"label"},"EN CAJA",-1)),t("div",ot,r(l.money(i.totales.en_caja)),1)])])]),_:1})]),_:1}),s(g,{flat:"",bordered:"",class:"card-like"},{default:o(()=>[s(_,{class:"q-pa-none"},{default:o(()=>[e[19]||(e[19]=t("div",{class:"pdf-title orange"},[t("div",{class:"pdf-title-left"},"EGRESOS (TOTAL POR DÍA)")],-1)),t("div",dt,[t("table",it,[e[15]||(e[15]=t("thead",null,[t("tr",null,[t("th",{class:"th-center w-dia"},"DIA"),t("th",{class:"th-left"},"fecha"),t("th",{class:"th-right w-total"},"TOTAL")])],-1)),t("tbody",null,[(d(!0),c(p,null,v(i.rows,a=>(d(),c("tr",{key:a.fecha+"-e",class:C(["click-row",{active:i.selectedDay===a.fecha}]),onClick:E=>l.selectDay(a.fecha)},[t("td",nt,r(a.dia),1),t("td",ct,r(a.label),1),t("td",ut,r(l.numberNoDecimals(a.egresos_total)),1)],10,rt))),128)),i.rows.length?b("",!0):(d(),c("tr",mt,[...e[14]||(e[14]=[t("td",{colspan:"3",class:"td-center muted"},"Sin datos",-1)])]))])])]),l.selectedRow?(d(),c("div",_t,[s(y,{name:"event",class:"q-mr-xs"}),t("span",ft,r(l.selectedRow.label),1),t("span",ht,[e[16]||(e[16]=f("| Ingresos: ",-1)),t("b",null,r(l.money(l.selectedRow.ingresos_total)),1)]),t("span",gt,[e[17]||(e[17]=f("| Egresos: ",-1)),t("b",null,r(l.money(l.selectedRow.egresos_total)),1)]),t("span",bt,[e[18]||(e[18]=f("| En caja: ",-1)),t("b",null,r(l.money(l.selectedRow.en_caja)),1)])])):b("",!0)]),_:1})]),_:1})])]),s(g,{flat:"",bordered:"",class:"q-mt-sm card-like"},{default:o(()=>[s(_,{class:"row items-center q-col-gutter-sm"},{default:o(()=>[e[20]||(e[20]=t("div",{class:"col"},[t("div",{class:"text-subtitle1 text-weight-bold"},"Desglose del día"),t("div",{class:"text-caption text-grey-7"}," Click en un día (arriba) para ver el detalle (ingresos por usuario + egresos itemizados). ")],-1)),t("div",yt,[l.selectedRow?(d(),m(R,{key:0,color:"primary",label:l.selectedRow.label},null,8,["label"])):(d(),m(R,{key:1,color:"grey-7",label:"Selecciona un día"}))])]),_:1}),s(A),s(_,{class:"row q-col-gutter-sm"},{default:o(()=>[t("div",pt,[e[23]||(e[23]=t("div",{class:"panel-title blue"},"INGRESOS (por usuario)",-1)),t("div",vt,[t("table",wt,[e[22]||(e[22]=t("thead",null,[t("tr",null,[t("th",{class:"th-left"},"Usuario"),t("th",{class:"th-right"},"Total")])],-1)),t("tbody",null,[(d(!0),c(p,null,v(i.users,a=>(d(),c("tr",{key:a.id},[t("td",Dt,r(a.name),1),t("td",kt,r(l.money(l.ingSelected[String(a.id)]||0)),1)]))),128)),i.users.length?b("",!0):(d(),c("tr",St,[...e[21]||(e[21]=[t("td",{colspan:"2",class:"td-center muted"},"Sin usuarios",-1)])]))])])])]),t("div",xt,[e[26]||(e[26]=t("div",{class:"panel-title orange"},"EGRESOS (detalle)",-1)),t("div",Ct,[t("table",Rt,[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",{class:"th-left"},"Detalle"),t("th",{class:"th-right"},"Total")])],-1)),t("tbody",null,[(d(!0),c(p,null,v(l.egrSelectedList,a=>(d(),c("tr",{key:a.id},[t("td",Et,r(a.detalle),1),t("td",Ot,r(l.money(a.total)),1)]))),128)),l.egrSelectedList.length?b("",!0):(d(),c("tr",Qt,[...e[24]||(e[24]=[t("td",{colspan:"2",class:"td-center muted"},"Sin egresos",-1)])]))])])])])]),_:1})]),_:1}),s(T,{showing:i.loading},{default:o(()=>[s(q,{size:"40px"})]),_:1},8,["showing"])]),_:1})}const Mt=O(I,[["render",At],["__scopeId","data-v-a4985d9f"]]);export{Mt as default};
