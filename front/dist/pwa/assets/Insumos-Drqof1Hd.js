import{_ as V,c as p,o as b,w as s,a as l,ao as Q,af as d,a8 as u,t as g,P as h,d as k,f as m,h as C,Q as N,e as _,b as a,ap as x}from"./index-9hTxiiah.js";import{c as U,Q as w,b as c,a as v}from"./QList-Dh4UTpLy.js";import{Q as D}from"./QBtnDropdown-0b47kfEs.js";import{Q as f}from"./QTd-CNbPfmHG.js";import{Q as S}from"./format-CdGxTvCD.js";import{Q as q}from"./QTable-C7k-FvPC.js";import{Q as B}from"./QSpace-ClfUNfe8.js";import{Q as E}from"./QSelect-DD16MVuz.js";import{Q as I}from"./QForm-906WMNiI.js";import{Q as M}from"./QPage-BNp2kcGA.js";import{C as y}from"./ClosePopup-BuBM62SM.js";import"./position-engine-AsWGiY-O.js";const A={name:"InsumosPage",data(){return{rows:[],loading:!1,filter:"",dlg:!1,item:{},unidades:[{label:"UND",value:"UND"},{label:"KG",value:"KG"},{label:"LT",value:"LT"},{label:"PAQ",value:"PAQ"}],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"nombre",label:"Nombre",align:"left",field:"nombre",sortable:!0},{name:"unidad",label:"Unidad",align:"left",field:"unidad",sortable:!0},{name:"stock",label:"Stock",align:"left",field:"stock",sortable:!0},{name:"costo",label:"Costo (Bs)",align:"left",field:"costo",sortable:!0},{name:"no_contar",label:"No contar en stock",align:"left",field:"no_contar"},{name:"min_stock",label:"Mínimo",align:"left",field:"min_stock"},{name:"descripcion",label:"Descripción",align:"left",field:"descripcion"}]}},mounted(){this.fetchRows()},methods:{async updateStock(i){if(i.id)try{this.loading=!0,await this.$axios.put(`insumos/${i.id}`,{stock:i.stock,no_contar:i.no_contar?1:0}),this.$alert?.success?.("Actualizado")}catch(o){this.$alert?.error?.(o.response?.data?.message||"No se pudo actualizar")}finally{this.loading=!1}},formatMoney(i){return i=Number(i||0),i.toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},badgeColor(i){return i.min_stock&&Number(i.stock)<=Number(i.min_stock)?"negative":"primary"},async fetchRows(){this.loading=!0;try{const i=await this.$axios.get("insumos");this.rows=i.data}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo cargar")}finally{this.loading=!1}},onNew(){this.item={nombre:"",unidad:"UND",stock:0,costo:0,min_stock:null,descripcion:""},this.dlg=!0},onEdit(i){this.item={...i},this.dlg=!0},async onDelete(i){this.$alert.dialog("¿Eliminar el insumo?").onOk(async()=>{this.loading=!0;try{await this.$axios.delete(`insumos/${i}`),this.$alert?.success?.("Eliminado"),this.fetchRows()}catch(o){this.$alert?.error?.(o.response?.data?.message||"Error al eliminar")}finally{this.loading=!1}})},async submit(){this.loading=!0;try{this.item.id?(await this.$axios.put(`insumos/${this.item.id}`,this.item),this.$alert?.success?.("Actualizado")):(await this.$axios.post("insumos",this.item),this.$alert?.success?.("Creado")),this.dlg=!1,this.fetchRows()}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo guardar")}finally{this.loading=!1}}}},P={class:"row q-col-gutter-sm"},z={class:"col-12 col-sm-8"},L={class:"col-12 col-sm-4"},R={class:"col-6"},T={class:"col-6"},F={class:"col-6"},G={class:"col-12"},O={class:"text-right q-mt-md"};function K(i,o,j,H,t,n){return b(),p(M,{class:"q-pa-md"},{default:s(()=>[l(q,{rows:t.rows,columns:t.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Insumos",filter:t.filter},{"top-right":s(()=>[l(m,{color:"secondary",label:"Desde almacén",onClick:o[0]||(o[0]=e=>i.$router.push("/movimientos-almacen-insumos/nuevo")),"no-caps":"",icon:"inventory_2",loading:t.loading,class:"q-mr-sm"},null,8,["loading"]),l(m,{color:"positive",label:"Nuevo",onClick:n.onNew,"no-caps":"",icon:"add_circle_outline",loading:t.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),l(m,{color:"primary",label:"Actualizar",onClick:n.fetchRows,"no-caps":"",icon:"refresh",loading:t.loading},null,8,["onClick","loading"]),l(d,{modelValue:t.filter,"onUpdate:modelValue":o[1]||(o[1]=e=>t.filter=e),label:"Buscar",dense:"",outlined:"",class:"q-ml-sm"},{append:s(()=>[l(k,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":s(e=>[l(f,{props:e},{default:s(()=>[l(D,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:s(()=>[l(U,null,{default:s(()=>[h((b(),p(w,{clickable:"",onClick:r=>n.onEdit(e.row)},{default:s(()=>[l(c,{avatar:""},{default:s(()=>[l(k,{name:"edit"})]),_:1}),l(c,null,{default:s(()=>[l(v,null,{default:s(()=>[...o[11]||(o[11]=[u("Editar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[y]]),h((b(),p(w,{clickable:"",onClick:r=>n.onDelete(e.row.id)},{default:s(()=>[l(c,{avatar:""},{default:s(()=>[l(k,{name:"delete"})]),_:1}),l(c,null,{default:s(()=>[l(v,null,{default:s(()=>[...o[12]||(o[12]=[u("Eliminar",-1)])]),_:1})]),_:1})]),_:1},8,["onClick"])),[[y]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-costo":s(e=>[l(f,{props:e},{default:s(()=>[u(g(n.formatMoney(e.row.costo)),1)]),_:2},1032,["props"])]),"body-cell-stock":s(e=>[l(f,{props:e},{default:s(()=>[l(d,{modelValue:e.row.stock,"onUpdate:modelValue":[r=>e.row.stock=r,r=>n.updateStock(e.row)],modelModifiers:{number:!0},type:"number",dense:"",outlined:"",step:"0.01",style:{"max-width":"150px"},debounce:"500"},{append:s(()=>[l(S,{dense:"",color:e.row.min_stock&&Number(e.row.stock)<=Number(e.row.min_stock)?"negative":"primary","text-color":"white"},{default:s(()=>[u(g(e.row.unidad),1)]),_:2},1032,["color"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-no_contar":s(e=>[l(f,{props:e},{default:s(()=>[l(Q,{modelValue:e.row.no_contar,"onUpdate:modelValue":[r=>e.row.no_contar=r,r=>n.updateStock(e.row)],"true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),l(C,{modelValue:t.dlg,"onUpdate:modelValue":o[10]||(o[10]=e=>t.dlg=e),persistent:""},{default:s(()=>[l(N,{style:{width:"520px","max-width":"90vw"}},{default:s(()=>[l(_,{class:"q-pb-none row items-center"},{default:s(()=>[a("div",null,g(t.item.id?"Editar":"Nuevo")+" insumo",1),l(B),l(m,{icon:"close",flat:"",round:"",dense:"",onClick:o[2]||(o[2]=e=>t.dlg=!1)})]),_:1}),l(_,{class:"q-pt-none"},{default:s(()=>[l(I,{onSubmit:x(n.submit,["prevent"])},{default:s(()=>[a("div",P,[a("div",z,[l(d,{modelValue:t.item.nombre,"onUpdate:modelValue":o[3]||(o[3]=e=>t.item.nombre=e),label:"Nombre",dense:"",outlined:""},null,8,["modelValue"])]),a("div",L,[l(E,{modelValue:t.item.unidad,"onUpdate:modelValue":o[4]||(o[4]=e=>t.item.unidad=e),label:"Unidad",dense:"",outlined:"",options:t.unidades,"emit-value":"","map-options":""},null,8,["modelValue","options"])]),a("div",R,[l(d,{modelValue:t.item.stock,"onUpdate:modelValue":o[5]||(o[5]=e=>t.item.stock=e),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Stock",dense:"",outlined:""},null,8,["modelValue"])]),a("div",T,[l(d,{modelValue:t.item.costo,"onUpdate:modelValue":o[6]||(o[6]=e=>t.item.costo=e),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Costo (Bs)",dense:"",outlined:""},null,8,["modelValue"])]),a("div",F,[l(d,{modelValue:t.item.min_stock,"onUpdate:modelValue":o[7]||(o[7]=e=>t.item.min_stock=e),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Stock mínimo",dense:"",outlined:""},null,8,["modelValue"])]),a("div",G,[l(d,{modelValue:t.item.descripcion,"onUpdate:modelValue":o[8]||(o[8]=e=>t.item.descripcion=e),type:"textarea",autogrow:"",label:"Descripción",dense:"",outlined:""},null,8,["modelValue"])])]),a("div",O,[l(m,{color:"negative",label:"Cancelar","no-caps":"",onClick:o[9]||(o[9]=e=>t.dlg=!1),loading:t.loading},null,8,["loading"]),l(m,{color:"primary",label:"Guardar","no-caps":"",class:"q-ml-sm",type:"submit",loading:t.loading},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ae=V(A,[["render",K]]);export{ae as default};
