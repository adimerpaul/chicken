import{_ as A,c as m,o as r,w as o,a as s,b as e,Q as g,e as _,t as n,af as O,f as T,P as D,d as b,a8 as f,O as V,a9 as c,aa as p,ab as y,ac as v,aA as C,ag as q}from"./index-D2Z3lgRK.js";import{Q as E}from"./QSelect-DfEOIbho.js";import{Q as k,b as h}from"./QItem-hbtxYLQf.js";import{Q as L}from"./QList-DEnR3NzJ.js";import{Q as N}from"./QBtnDropdown-DRCnuNzF.js";import{Q}from"./QBadge-DEd0qZch.js";import{Q as Y}from"./QInnerLoading-De0xBfTN.js";import{Q as j}from"./QPage-DPU8kwmd.js";import{C as S}from"./ClosePopup-DZGTKbeH.js";import{h as w}from"./moment-BLMuvzoS.js";import"./QChip-BSLZ8Baf.js";import"./format-KGr3QpCO.js";import"./position-engine-BA0I2poh.js";const I={name:"ReporteAjusteCajaGarden",data(){return{loading:!1,title:"AJUSTE EN CAJA GARDEN ORURO",filters:{date_from:null,date_to:null,pago:null,user_id:null},users:[],rows:[],detalle:{ingresos_by_day:{},egresos_by_day:{}},totales:{ingresos:0,egresos:0,en_caja:0},selectedDay:null,pagoOptions:[{label:"Todos",value:null},{label:"EFECTIVO",value:"EFECTIVO"},{label:"QR",value:"QR"}]}},computed:{userOptions(){return[{label:"Todos",value:null},...this.users.map(d=>({label:d.name,value:d.id}))]},selectedRow(){return this.rows.find(d=>d.fecha===this.selectedDay)||null},ingSelected(){return this.selectedDay?this.detalle.ingresos_by_day?.[this.selectedDay]||{}:{}},egrSelectedList(){return this.selectedDay?this.detalle.egresos_by_day?.[this.selectedDay]||[]:[]}},mounted(){this.setWeek()},methods:{money(d){return Number(d||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},numberNoDecimals(d){return Number(d||0).toLocaleString("es-BO",{minimumFractionDigits:0,maximumFractionDigits:0})},setToday(){const d=w().format("YYYY-MM-DD");this.filters.date_from=d,this.filters.date_to=d,this.fetchData(!1)},setWeek(){const d=w().startOf("month"),t=w().endOf("month");this.filters.date_from=d.format("YYYY-MM-DD"),this.filters.date_to=t.format("YYYY-MM-DD"),this.fetchData(!1)},selectDay(d){this.selectedDay=d},async fetchData(d=!1){this.loading=!0;try{const t=d?{week:1}:{date_from:this.filters.date_from,date_to:this.filters.date_to,pago:this.filters.pago,user_id:this.filters.user_id},{data:u}=await this.$axios.get("reportes/ajuste-caja",{params:t});this.title=u.title||this.title,this.filters.date_from=u.date_from,this.filters.date_to=u.date_to,this.filters.pago=u.pago??this.filters.pago,this.filters.user_id=u.user_id??this.filters.user_id,this.users=u.users||[],this.rows=u.rows||[],this.detalle=u.detalle||{ingresos_by_day:{},egresos_by_day:{}},this.totales=u.totales||this.totales,this.selectedDay=this.rows?.[0]?.fecha||null;const x=w().format("YYYY-MM-DD");this.selectDay(x)}catch{this.$q.notify?.({type:"negative",message:"No se pudo cargar el reporte de ajuste en caja"})}finally{this.loading=!1}},exportExcel(){const d=new URLSearchParams({date_from:this.filters.date_from,date_to:this.filters.date_to,pago:this.filters.pago||"",user_id:this.filters.user_id||""}).toString();window.open(`${this.$axios.defaults.baseURL}/reportes/ajuste-caja/excel?${d}`,"_blank")}}},U={class:"col-12 col-sm-4"},B={class:"text-h6 text-weight-bold"},G={class:"col-6 col-sm-2"},M={class:"col-6 col-sm-2"},F={class:"col-6 col-sm-2"},P={class:"col-6 col-sm-2"},z={class:"col-12 col-sm-2 text-right"},J={class:"row"},W={class:"col-12"},H={class:"totales-box"},K={class:"tot-row"},X={class:"val"},Z={class:"tot-row"},$={class:"val"},ee={class:"tot-row tot-strong"},te={class:"val"},se={class:"col-auto"},le={class:"col-12 col-md-6"},ae={class:"panel-wrap"},oe={class:"mini-table"},ie={class:"td-left"},de={class:"td-right"},re={key:0},ne={class:"col-12 col-md-6"},ce={class:"panel-wrap"},ue={class:"mini-table"},me={class:"td-left"},_e={class:"td-right"},fe={key:0},he={class:"row q-col-gutter-sm"},ge={class:"col-12 col-md-7"},pe={class:"table-wrap blue"},be={class:"pdf-table"},ye=["onClick"],ve={class:"td-center"},we={class:"td-left"},De={class:"td-right td-bold"},ke={key:0},Se={class:"col-12 col-md-5"},xe={class:"table-wrap orange"},Oe={class:"pdf-table"},Ce=["onClick"],Ee={class:"td-center"},Qe={class:"td-left"},Re={class:"td-right td-bold"},Ae={key:0},Te={key:0,class:"day-chip"},Ve={class:"text-weight-bold"},qe={class:"q-ml-sm"},Le={class:"q-ml-sm"},Ne={class:"q-ml-sm"};function Ye(d,t,u,x,i,a){return r(),m(j,{class:"q-pa-sm bg-grey-3"},{default:o(()=>[s(g,{flat:"",bordered:"",class:"q-mb-sm"},{default:o(()=>[s(_,{class:"row items-end q-col-gutter-sm"},{default:o(()=>[e("div",U,[e("div",B,n(i.title),1),t[5]||(t[5]=e("div",{class:"text-caption text-grey-7"}," Semana Lun-Dom: totales por día (arriba) + desglose por día (abajo). ",-1))]),e("div",G,[s(O,{modelValue:i.filters.date_from,"onUpdate:modelValue":t[0]||(t[0]=l=>i.filters.date_from=l),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),e("div",M,[s(O,{modelValue:i.filters.date_to,"onUpdate:modelValue":t[1]||(t[1]=l=>i.filters.date_to=l),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])]),e("div",F,[s(E,{modelValue:i.filters.pago,"onUpdate:modelValue":t[2]||(t[2]=l=>i.filters.pago=l),options:i.pagoOptions,label:"Pago",dense:"",outlined:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"])]),e("div",P,[s(E,{modelValue:i.filters.user_id,"onUpdate:modelValue":t[3]||(t[3]=l=>i.filters.user_id=l),options:a.userOptions,label:"Usuario",dense:"",outlined:"","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"])]),e("div",z,[s(T,{color:"primary",icon:"search",label:"Actualizar","no-caps":"",loading:i.loading,onClick:t[4]||(t[4]=l=>a.fetchData(!1)),class:"q-mr-sm"},null,8,["loading"]),s(N,{color:"grey-9",icon:"more_horiz",label:"Acciones","no-caps":""},{default:o(()=>[s(L,null,{default:o(()=>[D((r(),m(k,{clickable:"",onClick:a.setWeek},{default:o(()=>[s(h,{avatar:""},{default:o(()=>[s(b,{name:"date_range"})]),_:1}),s(h,null,{default:o(()=>[...t[6]||(t[6]=[f("Semana (Lun-Dom)",-1)])]),_:1})]),_:1},8,["onClick"])),[[S]]),D((r(),m(k,{clickable:"",onClick:a.setToday},{default:o(()=>[s(h,{avatar:""},{default:o(()=>[s(b,{name:"today"})]),_:1}),s(h,null,{default:o(()=>[...t[7]||(t[7]=[f("Hoy",-1)])]),_:1})]),_:1},8,["onClick"])),[[S]]),D((r(),m(k,{clickable:"",onClick:a.exportExcel},{default:o(()=>[s(h,{avatar:""},{default:o(()=>[s(b,{name:"grid_on"})]),_:1}),s(h,null,{default:o(()=>[...t[8]||(t[8]=[f("Exportar Excel",-1)])]),_:1})]),_:1},8,["onClick"])),[[S]])]),_:1})]),_:1})])]),_:1})]),_:1}),e("div",J,[e("div",W,[s(g,{flat:"",bordered:"",class:"card-like q-mb-sm"},{default:o(()=>[s(_,{class:"q-pa-none"},{default:o(()=>[e("div",H,[t[12]||(t[12]=e("div",{class:"totales-title"},"TOTALES",-1)),e("div",K,[t[9]||(t[9]=e("div",{class:"label"},"INGRESOS",-1)),e("div",X,n(a.money(i.totales.ingresos)),1)]),e("div",Z,[t[10]||(t[10]=e("div",{class:"label"},"EGRESOS",-1)),e("div",$,n(a.money(i.totales.egresos)),1)]),e("div",ee,[t[11]||(t[11]=e("div",{class:"label"},"EN CAJA",-1)),e("div",te,n(a.money(i.totales.en_caja)),1)])])]),_:1})]),_:1})])]),s(g,{flat:"",bordered:"",class:"q-mt-sm card-like"},{default:o(()=>[s(_,{class:"row items-center q-col-gutter-sm"},{default:o(()=>[t[13]||(t[13]=e("div",{class:"col"},[e("div",{class:"text-subtitle1 text-weight-bold"},"Desglose del día"),e("div",{class:"text-caption text-grey-7"}," Click en un día (arriba) para ver el detalle (ingresos por usuario + egresos itemizados). ")],-1)),e("div",se,[a.selectedRow?(r(),m(Q,{key:0,color:"primary",label:a.selectedRow.label},null,8,["label"])):(r(),m(Q,{key:1,color:"grey-7",label:"Selecciona un día"}))])]),_:1}),s(V),s(_,{class:"row q-col-gutter-sm"},{default:o(()=>[e("div",le,[t[16]||(t[16]=e("div",{class:"panel-title blue"},"INGRESOS (por usuario)",-1)),e("div",ae,[e("table",oe,[t[15]||(t[15]=e("thead",null,[e("tr",null,[e("th",{class:"th-left"},"Usuario"),e("th",{class:"th-right"},"Total")])],-1)),e("tbody",null,[(r(!0),c(y,null,v(i.users,l=>(r(),c("tr",{key:l.id},[e("td",ie,n(l.name),1),e("td",de,n(a.money(a.ingSelected[String(l.id)]||0)),1)]))),128)),i.users.length?p("",!0):(r(),c("tr",re,[...t[14]||(t[14]=[e("td",{colspan:"2",class:"td-center muted"},"Sin usuarios",-1)])]))])])])]),e("div",ne,[t[19]||(t[19]=e("div",{class:"panel-title orange"},"EGRESOS (detalle)",-1)),e("div",ce,[e("table",ue,[t[18]||(t[18]=e("thead",null,[e("tr",null,[e("th",{class:"th-left"},"Detalle"),e("th",{class:"th-right"},"Total")])],-1)),e("tbody",null,[(r(!0),c(y,null,v(a.egrSelectedList,l=>(r(),c("tr",{key:l.id},[e("td",me,n(l.detalle),1),e("td",_e,n(a.money(l.total)),1)]))),128)),a.egrSelectedList.length?p("",!0):(r(),c("tr",fe,[...t[17]||(t[17]=[e("td",{colspan:"2",class:"td-center muted"},"Sin egresos",-1)])]))])])])])]),_:1})]),_:1}),e("div",he,[e("div",ge,[s(g,{flat:"",bordered:"",class:"card-like"},{default:o(()=>[s(_,{class:"q-pa-none"},{default:o(()=>[t[22]||(t[22]=e("div",{class:"pdf-title blue"},[e("div",{class:"pdf-title-left"},"INGRESOS (TOTAL POR DÍA)")],-1)),e("div",pe,[e("table",be,[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",{class:"th-center w-dia"},"DIA"),e("th",{class:"th-left"},"fecha"),e("th",{class:"th-right w-total"},"TOTAL")])],-1)),e("tbody",null,[(r(!0),c(y,null,v(i.rows,l=>(r(),c("tr",{key:l.fecha,class:C(["click-row",{active:i.selectedDay===l.fecha}]),onClick:R=>a.selectDay(l.fecha)},[e("td",ve,n(l.dia),1),e("td",we,n(l.label),1),e("td",De,n(a.numberNoDecimals(l.ingresos_total)),1)],10,ye))),128)),i.rows.length?p("",!0):(r(),c("tr",ke,[...t[20]||(t[20]=[e("td",{colspan:"3",class:"td-center muted"},"Sin datos",-1)])]))])])])]),_:1})]),_:1})]),e("div",Se,[s(g,{flat:"",bordered:"",class:"card-like"},{default:o(()=>[s(_,{class:"q-pa-none"},{default:o(()=>[t[28]||(t[28]=e("div",{class:"pdf-title orange"},[e("div",{class:"pdf-title-left"},"EGRESOS (TOTAL POR DÍA)")],-1)),e("div",xe,[e("table",Oe,[t[24]||(t[24]=e("thead",null,[e("tr",null,[e("th",{class:"th-center w-dia"},"DIA"),e("th",{class:"th-left"},"fecha"),e("th",{class:"th-right w-total"},"TOTAL")])],-1)),e("tbody",null,[(r(!0),c(y,null,v(i.rows,l=>(r(),c("tr",{key:l.fecha+"-e",class:C(["click-row",{active:i.selectedDay===l.fecha}]),onClick:R=>a.selectDay(l.fecha)},[e("td",Ee,n(l.dia),1),e("td",Qe,n(l.label),1),e("td",Re,n(a.numberNoDecimals(l.egresos_total)),1)],10,Ce))),128)),i.rows.length?p("",!0):(r(),c("tr",Ae,[...t[23]||(t[23]=[e("td",{colspan:"3",class:"td-center muted"},"Sin datos",-1)])]))])])]),a.selectedRow?(r(),c("div",Te,[s(b,{name:"event",class:"q-mr-xs"}),e("span",Ve,n(a.selectedRow.label),1),e("span",qe,[t[25]||(t[25]=f("| Ingresos: ",-1)),e("b",null,n(a.money(a.selectedRow.ingresos_total)),1)]),e("span",Le,[t[26]||(t[26]=f("| Egresos: ",-1)),e("b",null,n(a.money(a.selectedRow.egresos_total)),1)]),e("span",Ne,[t[27]||(t[27]=f("| En caja: ",-1)),e("b",null,n(a.money(a.selectedRow.en_caja)),1)])])):p("",!0)]),_:1})]),_:1})])]),s(Y,{showing:i.loading},{default:o(()=>[s(q,{size:"40px"})]),_:1},8,["showing"])]),_:1})}const Xe=A(I,[["render",Ye],["__scopeId","data-v-b474366a"]]);export{Xe as default};
