import{_ as Q,c as v,o as f,w as r,b as s,a as o,Q as g,e as p,f as i,af as u,a9 as _,ab as V,ac as w,t as d,O as N,aa as U,a8 as b,h as k,ai as q}from"./index-9SfE-Hb9.js";import{Q as y}from"./QSpace-CTrApUhu.js";import{Q as D,b as C,a as x}from"./QItem-DxWjfZl6.js";import{Q as S}from"./QList-DtKPpibr.js";import{Q as B}from"./QPage-B95ABWpD.js";const I={name:"InsumosResumen",data(){const a=new Date().toISOString().substr(0,10);return{loading:!1,search:"",insumos:[],carrito:[],qtyDlg:!1,current:null,form:{cantidad:null,costo:null},payDlg:!1,compra:{fecha:a,proveedor:"",nota:""}}},computed:{filteredInsumos(){const a=(this.search||"").toLowerCase();return a?this.insumos.filter(e=>String(e.nombre||"").toLowerCase().includes(a)||String(e.unidad||"").toLowerCase().includes(a)||String(e.descripcion||"").toLowerCase().includes(a)):this.insumos},total(){return this.carrito.reduce((a,e)=>{const m=Number(e.cantidad||0),h=Number(e.costo||0);return a+m*h},0)}},mounted(){this.insumosGet()},methods:{to2(a){return Number(a||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},money(a){return this.to2(a)},async insumosGet(){this.loading=!0;try{const a=await this.$axios.get("insumos");this.insumos=Array.isArray(a.data)?a.data:[]}catch{this.$alert&&this.$alert.error&&this.$alert.error("No se pudo cargar los insumos")}finally{this.loading=!1}},openQtyDialog(a){this.current=a,this.form={cantidad:1,costo:Number(a.costo||0)},this.addToCart()},addToCart(){const a=Number(this.form.cantidad||0),e=Number(this.form.costo||0),m=this.carrito.findIndex(h=>h.id===this.current.id);m>=0?(this.carrito[m].cantidad+=a,this.carrito[m].costo=e):this.carrito.push({id:this.current.id,nombre:this.current.nombre,unidad:this.current.unidad,subtotal:a*e,cantidad:a,costo:e}),this.qtyDlg=!1},removeFromCart(a){this.carrito=this.carrito.filter(e=>e.id!==a)},clearCart(){this.carrito=[]},openPayDialog(){if(!this.carrito.length){this.$alert&&this.$alert.error&&this.$alert.error("Carrito vacío");return}this.payDlg=!0},async savePurchase(){const a={fecha:this.compra.fecha,proveedor:this.compra.proveedor||null,nota:this.compra.nota||null,detalles:this.carrito.map(e=>({insumo_id:e.id,cantidad:Number(e.cantidad||0),costo:Number(e.costo||0)}))};this.loading=!0;try{await this.$axios.post("compras",a),this.$alert&&this.$alert.success&&this.$alert.success("Compra registrada"),this.payDlg=!1,this.carrito=[],this.compra.proveedor="",this.compra.nota="",this.insumosGet()}catch(e){const m=e&&e.response&&e.response.data&&e.response.data.message?e.response.data.message:"No se pudo registrar la compra";this.$alert&&this.$alert.error&&this.$alert.error(m)}finally{this.loading=!1}}}},F={class:"row"},L={class:"col-12 col-md-8"},P={class:"row items-center"},T={class:"col-12"},A={class:"col-12 col-md-6 q-pa-xs"},G={class:"col-12 col-md-6 q-pa-xs text-right"},M={class:"row q-mt-sm"},O=["onClick"],R={class:"col-8"},E={class:"text-body1"},j={class:"text-caption text-grey"},z={class:"col-4 text-right"},H={class:"text-body1"},J={class:"col-12 col-md-4"},K={class:"row q-col-gutter-xs"},W={class:"col-4"},X={class:"col-4"},Y={class:"col-4"},Z={class:"text-bold"},$={class:"q-mt-sm text-right text-subtitle1"},ee={class:"text-subtitle1"},te={class:"text-caption q-mb-xs"},oe={class:"row q-col-gutter-sm"},se={class:"col-12 col-sm-6"},le={class:"col-12 col-sm-6"},ae={class:"col-12"},re={class:"q-mt-sm text-right text-subtitle1"};function ne(a,e,m,h,l,n){return f(),v(B,{class:"bg-grey-3 q-pa-sm"},{default:r(()=>[s("div",F,[s("div",L,[o(g,null,{default:r(()=>[o(p,{class:"q-pa-sm"},{default:r(()=>[s("div",P,[s("div",T,[o(i,{flat:"",color:"primary",icon:"shopping_cart",label:"Ir a Compras","no-caps":"",href:"/compras"})]),s("div",A,[o(u,{modelValue:l.search,"onUpdate:modelValue":e[0]||(e[0]=t=>l.search=t),dense:"",outlined:"",placeholder:"Buscar insumo (nombre, unidad, descripción)"},null,8,["modelValue"])]),s("div",G,[o(i,{flat:"",color:"primary",icon:"refresh",loading:l.loading,onClick:n.insumosGet},null,8,["loading","onClick"])])]),s("div",M,[e[12]||(e[12]=s("div",{class:"col-8"},[s("div",{class:"text-subtitle1 text-weight-bold"},"Insumo")],-1)),e[13]||(e[13]=s("div",{class:"col-4 text-right"},[s("div",{class:"text-subtitle1 text-weight-bold"},"Stock")],-1)),(f(!0),_(V,null,w(n.filteredInsumos,t=>(f(),_("div",{key:t.id,class:"col-12 q-mt-sm"},[s("div",{class:"row cursor-pointer",onClick:c=>n.openQtyDialog(t)},[s("div",R,[s("div",E,d(t.nombre),1),s("div",j,d(t.unidad)+" — "+d(t.costo||"—"),1)]),s("div",z,[s("div",H,d(n.to2(t.stock)),1)])],8,O),o(N,{spaced:"",inset:""})]))),128))])]),_:1})]),_:1})]),s("div",J,[o(g,null,{default:r(()=>[o(p,{class:"q-pa-sm row items-center bg-yellow-3"},{default:r(()=>[e[14]||(e[14]=s("div",{class:"text-subtitle1 text-bold"},"Carrito",-1)),o(y),o(i,{dense:"",color:"red",icon:"delete_sweep",label:"Limpiar","no-caps":"",onClick:n.clearCart},null,8,["onClick"])]),_:1}),o(p,{class:"q-pa-sm"},{default:r(()=>[o(S,{bordered:"",dense:""},{default:r(()=>[(f(!0),_(V,null,w(l.carrito,t=>(f(),v(D,{key:t.id},{default:r(()=>[o(C,null,{default:r(()=>[o(x,{class:"text-bold"},{default:r(()=>[b(d(t.nombre),1)]),_:2},1024),o(x,{caption:""},{default:r(()=>[s("div",K,[s("div",W,[o(u,{modelValue:t.cantidad,"onUpdate:modelValue":[c=>t.cantidad=c,c=>t.subtotal=(t.cantidad*t.costo).toFixed(2)],modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Cantidad"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",X,[o(u,{modelValue:t.costo,"onUpdate:modelValue":[c=>t.costo=c,c=>t.subtotal=(t.cantidad*t.costo).toFixed(2)],modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Costo (Bs)"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",Y,[o(u,{modelValue:t.subtotal,"onUpdate:modelValue":[c=>t.subtotal=c,c=>t.costo=(t.subtotal/t.cantidad).toFixed(2)],modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Subtotal (Bs)"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024)]),_:2},1024),o(C,{side:"",class:"text-right"},{default:r(()=>[s("div",Z,d(n.money(t.cantidad*t.costo)),1),o(i,{dense:"",flat:"",round:"",icon:"delete",color:"red",onClick:c=>n.removeFromCart(t.id)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),l.carrito.length?U("",!0):(f(),v(D,{key:0},{default:r(()=>[o(C,null,{default:r(()=>[o(x,{caption:""},{default:r(()=>[...e[15]||(e[15]=[b("Carrito vacío",-1)])]),_:1})]),_:1})]),_:1}))]),_:1}),s("div",$,[e[16]||(e[16]=s("b",null,"Total:",-1)),b(" "+d(n.money(n.total))+" Bs ",1)]),o(i,{class:"q-mt-md",color:"indigo",icon:"shopping_cart",label:"Registrar compra",disable:!l.carrito.length,loading:l.loading,"no-caps":"",onClick:n.openPayDialog},null,8,["disable","loading","onClick"])]),_:1})]),_:1})])]),o(k,{modelValue:l.qtyDlg,"onUpdate:modelValue":e[5]||(e[5]=t=>l.qtyDlg=t)},{default:r(()=>[o(g,{style:{width:"420px","max-width":"90vw"}},{default:r(()=>[o(p,{class:"row items-center q-pb-none"},{default:r(()=>[s("div",ee,"Agregar: "+d(l.current?.nombre),1),o(y),o(i,{flat:"",round:"",dense:"",icon:"close",onClick:e[1]||(e[1]=t=>l.qtyDlg=!1)})]),_:1}),o(p,{class:"q-pt-none"},{default:r(()=>[s("div",te,"Unidad: "+d(l.current?.unidad)+" | Stock: "+d(n.to2(l.current?.stock)),1),o(u,{modelValue:l.form.cantidad,"onUpdate:modelValue":e[2]||(e[2]=t=>l.form.cantidad=t),modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Cantidad",class:"q-mb-sm"},null,8,["modelValue"]),o(u,{modelValue:l.form.costo,"onUpdate:modelValue":e[3]||(e[3]=t=>l.form.costo=t),modelModifiers:{number:!0},type:"number",step:"0.01",dense:"",outlined:"",label:"Costo (Bs)"},null,8,["modelValue"])]),_:1}),o(q,{align:"right"},{default:r(()=>[o(i,{flat:"",label:"Cancelar",color:"negative","no-caps":"",onClick:e[4]||(e[4]=t=>l.qtyDlg=!1)}),o(i,{label:"Agregar",color:"primary","no-caps":"",onClick:n.addToCart},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(k,{modelValue:l.payDlg,"onUpdate:modelValue":e[11]||(e[11]=t=>l.payDlg=t)},{default:r(()=>[o(g,{style:{width:"540px","max-width":"95vw"}},{default:r(()=>[o(p,{class:"row items-center q-pb-none"},{default:r(()=>[e[17]||(e[17]=s("div",{class:"text-subtitle1"},"Confirmar compra",-1)),o(y),o(i,{flat:"",round:"",dense:"",icon:"close",onClick:e[6]||(e[6]=t=>l.payDlg=!1)})]),_:1}),o(p,{class:"q-pt-none"},{default:r(()=>[s("div",oe,[s("div",se,[o(u,{modelValue:l.compra.fecha,"onUpdate:modelValue":e[7]||(e[7]=t=>l.compra.fecha=t),label:"Fecha",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),s("div",le,[o(u,{modelValue:l.compra.proveedor,"onUpdate:modelValue":e[8]||(e[8]=t=>l.compra.proveedor=t),label:"Proveedor",dense:"",outlined:""},null,8,["modelValue"])]),s("div",ae,[o(u,{modelValue:l.compra.nota,"onUpdate:modelValue":e[9]||(e[9]=t=>l.compra.nota=t),label:"Nota",type:"textarea",autogrow:"",dense:"",outlined:""},null,8,["modelValue"])])]),s("div",re,[e[18]||(e[18]=s("b",null,"Total:",-1)),b(" "+d(n.money(n.total))+" Bs ",1)])]),_:1}),o(q,{align:"right"},{default:r(()=>[o(i,{flat:"",color:"negative",label:"Cancelar","no-caps":"",onClick:e[10]||(e[10]=t=>l.payDlg=!1)}),o(i,{color:"positive",label:"Guardar","no-caps":"",loading:l.loading,onClick:n.savePurchase},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const pe=Q(I,[["render",ne]]);export{pe as default};
