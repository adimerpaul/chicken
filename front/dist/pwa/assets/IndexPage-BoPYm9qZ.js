import{_ as B,c as f,o as n,w as o,a7 as V,aa as _,a9 as h,Q as g,a as s,e as c,b as t,af as R,f as p,O as x,t as r,a8 as m,d as y,ab as q,ac as P,ae as N,ag as L}from"./index-Bwutk4ap.js";import{Q as w}from"./QSpace-D65WqJTf.js";import{Q as C}from"./QTooltip-qmOoQo3c.js";import{Q as v}from"./QChip-DQvvTsJn.js";import{Q as D}from"./QMarkupTable-DzjjCKRJ.js";import{Q as S}from"./QInnerLoading-BjPhdBP4.js";import{Q as T}from"./QPage-BCFdkDJ_.js";import{h as Q}from"./moment-BLMuvzoS.js";import"./position-engine-CRuj33S7.js";const A={name:"IndexPage",data(){return{loading:!1,productosLoading:!1,fullScreenChart:!1,filters:{date_from:"",date_to:""},kpis:{ingresos:0,egresos:0,neto:0,ventas:0,items:0,ticket_promedio:0},porDia:[],pagos:[],chartVentas:{series:[],options:{}},chartPagos:{series:[],options:{}},productosResumen:[]}},computed:{pollosRows(){return(this.productosResumen||[]).filter(a=>String(a.categoria||"").toLowerCase()==="pollos")},refrescosRows(){return(this.productosResumen||[]).filter(a=>String(a.categoria||"").toLowerCase()==="refrescos y bebidas")},totPollos(){return this.sumRows(this.pollosRows)},totRefrescos(){return this.sumRows(this.refrescosRows)},totGeneralProductos(){return this.toNum(this.totPollos.total_venta)+this.toNum(this.totRefrescos.total_venta)},pctDelIngreso(){const a=this.toNum(this.kpis.ingresos);return a?this.pct(this.totGeneralProductos,a):0}},mounted(){this.prefillDates(),this.fetchDashboard()},methods:{prefillDates(){this.filters.date_from=Q().format("YYYY-MM-DD"),this.filters.date_to=Q().format("YYYY-MM-DD")},async fetchDashboard(){this.loading=!0;try{const a={...this.filters},{data:e}=await this.$axios.get("reportes/ventas",{params:a});this.kpis=e?.kpis||this.kpis,this.porDia=e?.por_dia||[],this.pagos=e?.pagos||[],this.buildChartVentas(),this.buildChartPagos(),await this.fetchProductosResumen()}catch(a){const e=a?.response?.data?.message||"No se pudo cargar el dashboard";this.$q.notify?.({type:"negative",message:e})}finally{this.loading=!1}},async fetchProductosResumen(){this.productosLoading=!0;try{const a={...this.filters},{data:e}=await this.$axios.get("reportes/productos-resumen",{params:a});this.productosResumen=Array.isArray(e)?e:[]}catch{this.productosResumen=[],this.$q.notify?.({type:"negative",message:"No se pudo cargar el resumen de productos"})}finally{this.productosLoading=!1}},buildChartVentas(){const a=this.porDia.map(i=>i.date),e=this.porDia.map(i=>Number(i.ingreso||0)),u=this.porDia.map(i=>Number(i.egreso||0)),b=this.porDia.map(i=>Number(i.neto||0));this.chartVentas={series:[{name:"Ingresos",data:e},{name:"Egresos",data:u},{name:"Neto",data:b}],options:{chart:{type:"bar",toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},xaxis:{categories:a,labels:{rotate:-45}},yaxis:{labels:{formatter:i=>Number(i||0).toFixed(0)}},legend:{position:"top"},tooltip:{y:{formatter:i=>this.money(i)+" Bs"}}}}},buildChartPagos(){const a=this.pagos.map(u=>u.pago||"SN"),e=this.pagos.map(u=>Number(u.total||0));this.chartPagos={series:e,options:{labels:a,legend:{position:"bottom"},tooltip:{y:{formatter:u=>this.money(u)+" Bs"}}}}},toNum(a){if(a==null)return 0;if(typeof a=="number")return isFinite(a)?a:0;const e=String(a).trim().replace(/\s/g,"").replace(/,/g,""),u=Number(e);return isFinite(u)?u:0},sumRows(a){return(a||[]).reduce((e,u)=>(e.cantidad+=this.toNum(u.qty),e.total_venta+=this.toNum(u.total),e),{cantidad:0,total_venta:0})},pct(a,e){const u=this.toNum(a),b=this.toNum(e);return b?Math.round(u/b*100):0},img(a){return`${this.$url}/../storage/${a}`},money(a){return Number(a||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},num(a){return Number(a||0).toLocaleString("es-BO",{maximumFractionDigits:2})}}},I={class:"row items-center q-col-gutter-sm"},Y={class:"col-12 col-sm-3"},z={class:"col-12 col-sm-3"},F={class:"col-12 col-sm-3 col-md-2"},M={class:"row q-col-gutter-sm"},O={class:"col-6 col-sm-3"},E={class:"col-6 col-sm-3"},G={class:"col-6 col-sm-3"},U={class:"col-6 col-sm-3"},j={key:1,class:"row q-col-gutter-md q-mb-md"},H={class:"col-12 col-sm-6 col-md-3"},J={class:"text-h5 text-weight-bold"},K={class:"col-12 col-sm-6 col-md-3"},W={class:"text-h5 text-weight-bold"},X={class:"col-12 col-sm-6 col-md-3"},Z={class:"text-h5 text-weight-bold"},$={class:"text-caption text-grey"},tt={class:"col-12 col-sm-6 col-md-3"},et={class:"text-h5 text-weight-bold"},st={class:"text-caption text-grey"},ot={key:2,class:"row q-col-gutter-md"},lt={class:"col-12 col-md-8"},at={key:1,class:"text-grey text-center q-pa-md text-caption"},it={class:"col-12 col-md-4"},rt={key:1,class:"text-grey text-center q-pa-md text-caption"},dt={key:3,class:"row q-col-gutter-md q-mt-md"},nt={class:"col-12"},ct={class:"row q-col-gutter-sm q-mb-sm"},ut={class:"col-12 col-sm-4"},mt={class:"text-h6 text-weight-bold"},ht={class:"text-caption text-grey-7"},gt={class:"col-12 col-sm-4"},pt={class:"text-h6 text-weight-bold"},ft={class:"text-caption text-grey-7"},_t={class:"col-12 col-sm-4"},xt={class:"text-h6 text-weight-bold text-primary"},vt={class:"text-caption text-grey-7"},bt={class:"row q-col-gutter-md"},yt={class:"col-12 col-md-6"},wt={class:"text-subtitle1 text-weight-bold"},kt={class:"text-left"},Rt={class:"row items-center no-wrap"},qt=["src"],Pt={class:"text-weight-medium"},Nt={class:"text-caption text-grey-7"},Ct={class:"text-right text-weight-bold"},Dt={class:"text-right text-weight-bold"},Qt={class:"text-right"},Bt={key:0},Vt={class:"text-right text-weight-bold"},Lt={class:"text-right text-weight-bold"},St={class:"col-12 col-md-6"},Tt={class:"text-subtitle1 text-weight-bold"},At={class:"text-left"},It={class:"row items-center no-wrap"},Yt=["src"],zt={class:"text-weight-medium"},Ft={class:"text-caption text-grey-7"},Mt={class:"text-right text-weight-bold"},Ot={class:"text-right text-weight-bold"},Et={class:"text-right"},Gt={key:0},Ut={class:"text-right text-weight-bold"},jt={class:"text-right text-weight-bold"};function Ht(a,e,u,b,i,l){const k=V("apexchart");return n(),f(T,{class:"q-pa-md bg-grey-3"},{default:o(()=>[a.$store.user.role=="Administrador"?(n(),f(g,{key:0,flat:"",bordered:"",class:"q-mb-md"},{default:o(()=>[s(c,null,{default:o(()=>[t("div",I,[e[7]||(e[7]=t("div",{class:"col-12 col-md-6"},[t("div",{class:"text-h5 text-weight-bold"}," Dashboard general "),t("div",{class:"text-caption text-grey-7"}," Resumen rápido de ventas, caja e insumos ")],-1)),t("div",Y,[s(R,{modelValue:i.filters.date_from,"onUpdate:modelValue":e[0]||(e[0]=d=>i.filters.date_from=d),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),t("div",z,[s(R,{modelValue:i.filters.date_to,"onUpdate:modelValue":e[1]||(e[1]=d=>i.filters.date_to=d),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),t("div",F,[s(p,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",class:"full-width",loading:i.loading,onClick:l.fetchDashboard},null,8,["loading","onClick"])])])]),_:1}),s(x),s(c,null,{default:o(()=>[t("div",M,[t("div",O,[s(p,{color:"primary",icon:"point_of_sale",label:"Nueva venta","no-caps":"",class:"full-width",onClick:e[2]||(e[2]=d=>a.$router.push({path:"/ventas"}))})]),t("div",E,[s(p,{color:"teal",icon:"shopping_cart",label:"Nueva compra","no-caps":"",class:"full-width",onClick:e[3]||(e[3]=d=>a.$router.push({path:"/compras"}))})]),t("div",G,[s(p,{color:"indigo",icon:"inventory_2",label:"Productos","no-caps":"",class:"full-width",onClick:e[4]||(e[4]=d=>a.$router.push({path:"/productos"}))})]),t("div",U,[s(p,{color:"orange",outline:"",icon:"insights",label:"Reportes detallados","no-caps":"",class:"full-width",onClick:e[5]||(e[5]=d=>a.$router.push({path:"/reportes"}))})])])]),_:1})]),_:1})):_("",!0),a.$store.user.role=="Administrador"?(n(),h("div",j,[t("div",H,[s(g,{flat:"",bordered:"",class:"kpi kpi-green"},{default:o(()=>[s(c,null,{default:o(()=>[e[8]||(e[8]=t("div",{class:"text-caption text-positive"},"Ingresos",-1)),t("div",J,r(l.money(i.kpis.ingresos))+" Bs ",1)]),_:1})]),_:1})]),t("div",K,[s(g,{flat:"",bordered:"",class:"kpi kpi-red"},{default:o(()=>[s(c,null,{default:o(()=>[e[9]||(e[9]=t("div",{class:"text-caption text-negative"},"Egresos",-1)),t("div",W,r(l.money(i.kpis.egresos))+" Bs ",1)]),_:1})]),_:1})]),t("div",X,[s(g,{flat:"",bordered:"",class:"kpi kpi-indigo"},{default:o(()=>[s(c,null,{default:o(()=>[e[10]||(e[10]=t("div",{class:"text-caption"},"Neto",-1)),t("div",Z,r(l.money(i.kpis.neto))+" Bs ",1),t("div",$," Ticket prom.: "+r(l.money(i.kpis.ticket_promedio))+" Bs ",1)]),_:1})]),_:1})]),t("div",tt,[s(g,{flat:"",bordered:"",class:"kpi"},{default:o(()=>[s(c,null,{default:o(()=>[e[11]||(e[11]=t("div",{class:"text-caption"},"Resumen de ventas",-1)),t("div",et,r(i.kpis.ventas)+" ventas ",1),t("div",st," Ítems vendidos: "+r(i.kpis.items),1)]),_:1})]),_:1})])])):_("",!0),a.$store.user.role=="Administrador"?(n(),h("div",ot,[t("div",lt,[s(g,{flat:"",bordered:""},{default:o(()=>[s(c,{class:"row items-center"},{default:o(()=>[e[13]||(e[13]=t("div",{class:"text-subtitle1 text-weight-bold"}," Movimiento diario (Ingresos vs Egresos vs Neto) ",-1)),s(w),s(p,{dense:"",flat:"",icon:"fullscreen",round:"",onClick:e[6]||(e[6]=d=>i.fullScreenChart=!i.fullScreenChart)},{default:o(()=>[s(C,null,{default:o(()=>[...e[12]||(e[12]=[m("Cambiar tamaño",-1)])]),_:1})]),_:1})]),_:1}),s(x),s(c,null,{default:o(()=>[i.chartVentas.series.length?(n(),f(k,{key:0,type:"bar",height:"320",options:i.chartVentas.options,series:i.chartVentas.series},null,8,["options","series"])):(n(),h("div",at," No hay datos en el rango seleccionado. "))]),_:1})]),_:1})]),t("div",it,[s(g,{flat:"",bordered:""},{default:o(()=>[s(c,{class:"text-subtitle1 text-weight-bold"},{default:o(()=>[...e[14]||(e[14]=[m(" Ventas por tipo de pago ",-1)])]),_:1}),s(x),s(c,null,{default:o(()=>[i.chartPagos.series.length?(n(),f(k,{key:0,type:"donut",height:"320",options:i.chartPagos.options,series:i.chartPagos.series},null,8,["options","series"])):(n(),h("div",rt," No hay ventas por tipo de pago en este rango. "))]),_:1})]),_:1})])])):_("",!0),a.$store.user.role=="Administrador"?(n(),h("div",dt,[t("div",nt,[s(g,{flat:"",bordered:""},{default:o(()=>[s(c,{class:"row items-center"},{default:o(()=>[e[16]||(e[16]=t("div",null,[t("div",{class:"text-subtitle1 text-weight-bold"}," Productos (Pollos / Refrescos) "),t("div",{class:"text-caption text-grey-7"}," Resumen por producto dentro del rango seleccionado ")],-1)),s(w),s(v,{dense:"",color:"indigo","text-color":"white",icon:"lunch_dining",class:"q-mr-xs"},{default:o(()=>[m(" Pollos: "+r(l.pollosRows.length),1)]),_:1}),s(v,{dense:"",color:"blue","text-color":"white",icon:"local_drink",class:"q-mr-sm"},{default:o(()=>[m(" Refrescos: "+r(l.refrescosRows.length),1)]),_:1}),s(p,{dense:"",flat:"",icon:"refresh",round:"",loading:i.productosLoading,onClick:l.fetchProductosResumen},{default:o(()=>[s(C,null,{default:o(()=>[...e[15]||(e[15]=[m("Actualizar productos",-1)])]),_:1})]),_:1},8,["loading","onClick"])]),_:1}),s(x),s(c,{class:"q-pt-sm"},{default:o(()=>[t("div",ct,[t("div",ut,[s(g,{flat:"",bordered:"",class:"mini"},{default:o(()=>[s(c,{class:"q-pa-sm"},{default:o(()=>[e[18]||(e[18]=t("div",{class:"text-caption text-grey-7"},"Total Pollos",-1)),t("div",mt,r(l.money(l.totPollos.total_venta))+" Bs ",1),t("div",ht,[e[17]||(e[17]=m(" Cantidad: ",-1)),t("b",null,r(l.num(l.totPollos.cantidad)),1)])]),_:1})]),_:1})]),t("div",gt,[s(g,{flat:"",bordered:"",class:"mini"},{default:o(()=>[s(c,{class:"q-pa-sm"},{default:o(()=>[e[20]||(e[20]=t("div",{class:"text-caption text-grey-7"},"Total Refrescos",-1)),t("div",pt,r(l.money(l.totRefrescos.total_venta))+" Bs ",1),t("div",ft,[e[19]||(e[19]=m(" Cantidad: ",-1)),t("b",null,r(l.num(l.totRefrescos.cantidad)),1)])]),_:1})]),_:1})]),t("div",_t,[s(g,{flat:"",bordered:"",class:"mini"},{default:o(()=>[s(c,{class:"q-pa-sm"},{default:o(()=>[e[22]||(e[22]=t("div",{class:"text-caption text-grey-7"},"Total (Pollos + Refrescos)",-1)),t("div",xt,r(l.money(l.totGeneralProductos))+" Bs ",1),t("div",vt,[e[21]||(e[21]=m(" % del ingreso: ",-1)),t("b",null,r(l.pctDelIngreso)+"%",1)])]),_:1})]),_:1})])]),t("div",bt,[t("div",yt,[s(g,{flat:"",bordered:""},{default:o(()=>[s(c,{class:"row items-center q-pa-sm"},{default:o(()=>[t("div",wt,[s(y,{name:"lunch_dining",class:"q-mr-xs"}),e[23]||(e[23]=m(" Pollos ",-1))]),s(w),s(v,{dense:"",color:"indigo","text-color":"white"},{default:o(()=>[m(r(l.money(l.totPollos.total_venta))+" Bs ",1)]),_:1})]),_:1}),s(x),s(c,{class:"q-pa-none"},{default:o(()=>[s(D,{dense:"",flat:"",bordered:"",separator:"horizontal"},{default:o(()=>[e[27]||(e[27]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Producto"),t("th",{class:"text-right",style:{width:"90px"}},"Cant."),t("th",{class:"text-right",style:{width:"120px"}},"Total"),t("th",{class:"text-right",style:{width:"90px"}},"%")])],-1)),t("tbody",null,[(n(!0),h(q,null,P(l.pollosRows,d=>(n(),h("tr",{key:"po-"+(d.product_id||d.name)},[t("td",kt,[t("div",Rt,[s(N,{size:"38px",class:"q-mr-sm"},{default:o(()=>[d.image?(n(),h("img",{key:0,src:l.img(d.image)},null,8,qt)):(n(),f(y,{key:1,name:"image"}))]),_:2},1024),t("div",null,[t("div",Pt,r(d.name),1),t("div",Nt,r(d.categoria||"Pollos"),1)])])]),t("td",Ct,r(l.num(d.qty)),1),t("td",Dt,r(l.money(d.total)),1),t("td",Qt,[s(v,{dense:"",square:"",color:"grey-3","text-color":"dark"},{default:o(()=>[m(r(l.pct(d.total,l.totPollos.total_venta))+"% ",1)]),_:2},1024)])]))),128)),!i.productosLoading&&l.pollosRows.length===0?(n(),h("tr",Bt,[...e[24]||(e[24]=[t("td",{colspan:"4",class:"text-center text-grey q-pa-md"}," Sin ventas de Pollos en este rango. ",-1)])])):_("",!0)]),t("tfoot",null,[t("tr",null,[e[25]||(e[25]=t("td",{class:"text-right text-grey-7"},"TOTAL",-1)),t("td",Vt,r(l.num(l.totPollos.cantidad)),1),t("td",Lt,r(l.money(l.totPollos.total_venta)),1),e[26]||(e[26]=t("td",{class:"text-right text-weight-bold"},"100%",-1))])])]),_:1})]),_:1})]),_:1})]),t("div",St,[s(g,{flat:"",bordered:""},{default:o(()=>[s(c,{class:"row items-center q-pa-sm"},{default:o(()=>[t("div",Tt,[s(y,{name:"local_drink",class:"q-mr-xs"}),e[28]||(e[28]=m(" Refrescos y Bebidas ",-1))]),s(w),s(v,{dense:"",color:"blue","text-color":"white"},{default:o(()=>[m(r(l.money(l.totRefrescos.total_venta))+" Bs ",1)]),_:1})]),_:1}),s(x),s(c,{class:"q-pa-none"},{default:o(()=>[s(D,{dense:"",flat:"",bordered:"",separator:"horizontal"},{default:o(()=>[e[32]||(e[32]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Producto"),t("th",{class:"text-right",style:{width:"90px"}},"Cant."),t("th",{class:"text-right",style:{width:"120px"}},"Total"),t("th",{class:"text-right",style:{width:"90px"}},"%")])],-1)),t("tbody",null,[(n(!0),h(q,null,P(l.refrescosRows,d=>(n(),h("tr",{key:"re-"+(d.product_id||d.name)},[t("td",At,[t("div",It,[s(N,{size:"38px",class:"q-mr-sm"},{default:o(()=>[d.image?(n(),h("img",{key:0,src:l.img(d.image)},null,8,Yt)):(n(),f(y,{key:1,name:"image"}))]),_:2},1024),t("div",null,[t("div",zt,r(d.name),1),t("div",Ft,r(d.categoria||"Refrescos y Bebidas"),1)])])]),t("td",Mt,r(l.num(d.qty)),1),t("td",Ot,r(l.money(d.total)),1),t("td",Et,[s(v,{dense:"",square:"",color:"grey-3","text-color":"dark"},{default:o(()=>[m(r(l.pct(d.total,l.totRefrescos.total_venta))+"% ",1)]),_:2},1024)])]))),128)),!i.productosLoading&&l.refrescosRows.length===0?(n(),h("tr",Gt,[...e[29]||(e[29]=[t("td",{colspan:"4",class:"text-center text-grey q-pa-md"}," Sin ventas de Refrescos en este rango. ",-1)])])):_("",!0)]),t("tfoot",null,[t("tr",null,[e[30]||(e[30]=t("td",{class:"text-right text-grey-7"},"TOTAL",-1)),t("td",Ut,r(l.num(l.totRefrescos.cantidad)),1),t("td",jt,r(l.money(l.totRefrescos.total_venta)),1),e[31]||(e[31]=t("td",{class:"text-right text-weight-bold"},"100%",-1))])])]),_:1})]),_:1})]),_:1})])])]),_:1}),s(S,{showing:i.productosLoading},{default:o(()=>[s(L,{size:"40px"})]),_:1},8,["showing"])]),_:1})])])):_("",!0)]),_:1})}const oe=B(A,[["render",Ht],["__scopeId","data-v-795aaf6d"]]);export{oe as default};
