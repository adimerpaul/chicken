import{_ as x,c as v,o as w,w as l,a as t,b as a,Q as d,e as r,af as b,f as k,t as i,a8 as m,O as g}from"./index-VgD-d_Hk.js";import{Q as y}from"./QSelect-SWbiE4-l.js";import{Q as h}from"./QSpace-BxhzS17a.js";import{Q as c}from"./QBadge-DLjQ5mwi.js";import{Q as p}from"./QTable-B3VYCc5t.js";import{Q as N}from"./QPage-DPxtIxUh.js";import"./format-BPPZ152X.js";import"./position-engine-D7bNVPtY.js";import"./QList-BXX2chGN.js";const q={name:"ReportesPage",data(){return{loading:!1,users:[],filters:{date_from:"",date_to:"",user_id:null},kpis:{ingresos:0,egresos:0,neto:0,ventas:0,items:0,ticket_promedio:0},pagos:[],mesas:[],qr:{total:0,items:0},porDia:[],insumos:[],insumosResumen:{costo_insumos:0,ingresos:0,ganancia_aprox:0,cantidad_usada:0,stock_actual:0,cantidad_total:0},colsPagos:[{name:"pago",label:"Pago",field:"pago",align:"left"},{name:"items",label:"# ventas",field:"items",align:"right",format:e=>Number(e).toLocaleString()},{name:"total",label:"Total (Bs)",field:"total",align:"right",format:e=>Number(e||0).toFixed(2)}],colsMesas:[{name:"mesa",label:"Mesa",field:"mesa",align:"left"},{name:"items",label:"# ventas",field:"items",align:"right",format:e=>Number(e).toLocaleString()},{name:"total",label:"Total (Bs)",field:"total",align:"right",format:e=>Number(e||0).toFixed(2)}],colsDia:[{name:"date",label:"Fecha",field:"date",align:"left"},{name:"ingreso",label:"Ingreso",field:"ingreso",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"egreso",label:"Egreso",field:"egreso",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"neto",label:"Neto",field:"neto",align:"right",format:e=>Number(e||0).toFixed(2)}],colsInsumos:[{name:"nombre",label:"Insumo",field:"nombre",align:"left"},{name:"unidad",label:"Unidad",field:"unidad",align:"left"},{name:"usado",label:"Cant. usada",field:"usado",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"stock_actual",label:"Stock actual",field:"stock_actual",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"total_cant",label:"Total (usado + stock)",field:"total_cant",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"costo",label:"Costo unit. (Bs)",field:"costo",align:"right",format:e=>Number(e||0).toFixed(2)},{name:"costo_total",label:"Costo total (Bs)",field:"costo_total",align:"right",format:e=>Number(e||0).toFixed(2)}]}},mounted(){this.prefillDates(),this.loadUsers(),this.fetchAll()},methods:{prefillDates(){const e=new Date,s=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),_=`${s}-${u}-01`,o=`${s}-${u}-${String(new Date(s,e.getMonth()+1,0).getDate()).padStart(2,"0")}`;this.filters.date_from=_,this.filters.date_to=o},async loadUsers(){try{const{data:e}=await this.$axios.get("users");this.users=Array.isArray(e?.data)?e.data:Array.isArray(e)?e:[]}catch{}},async fetchAll(){this.loading=!0;try{const e={...this.filters},s=await this.$axios.get("reportes/ventas",{params:e});this.kpis=s.data?.kpis||this.kpis,this.pagos=s.data?.pagos||[],this.qr=s.data?.qr||{total:0,items:0},this.mesas=s.data?.mesas||[],this.porDia=s.data?.por_dia||[];const u=await this.$axios.get("reportes/insumos",{params:e});this.insumos=u.data?.consumo||[],this.insumosResumen=u.data?.resumen||this.insumosResumen}catch(e){const s=e?.response?.data?.message||"No se pudieron obtener los reportes";this.$q.notify?.({type:"negative",message:s})}finally{this.loading=!1}},money(e){return Number(e||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},qty(e){return Number(e||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})}}},B={class:"col-12 col-sm-3"},Q={class:"col-12 col-sm-3"},D={class:"col-12 col-sm-3"},F={class:"col-12 col-sm-3"},S={class:"row q-col-gutter-md q-mb-md"},C={class:"col-12 col-sm-6 col-md-3"},V={class:"text-h5 text-weight-bold"},R={class:"col-12 col-sm-6 col-md-3"},A={class:"text-h5 text-weight-bold"},I={class:"col-12 col-sm-6 col-md-3"},M={class:"text-h5 text-weight-bold"},T={class:"col-12 col-sm-6 col-md-3"},U={class:"text-h5 text-weight-bold"},P={class:"text-caption text-grey"},L={class:"row q-col-gutter-md q-mb-md"},O={class:"col-12 col-md-6"},E={class:"col-12 col-md-6"};function G(e,s,u,_,o,n){return w(),v(N,{class:"q-pa-md bg-grey-3"},{default:l(()=>[t(d,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[t(r,{class:"row q-col-gutter-sm items-end"},{default:l(()=>[a("div",B,[t(b,{modelValue:o.filters.date_from,"onUpdate:modelValue":s[0]||(s[0]=f=>o.filters.date_from=f),type:"date",label:"Desde",dense:"",outlined:""},null,8,["modelValue"])]),a("div",Q,[t(b,{modelValue:o.filters.date_to,"onUpdate:modelValue":s[1]||(s[1]=f=>o.filters.date_to=f),type:"date",label:"Hasta",dense:"",outlined:""},null,8,["modelValue"])]),a("div",D,[t(y,{modelValue:o.filters.user_id,"onUpdate:modelValue":s[2]||(s[2]=f=>o.filters.user_id=f),options:o.users,"option-value":"id","option-label":"name","emit-value":"","map-options":"",clearable:"",dense:"",outlined:"",label:"Usuario"},null,8,["modelValue","options"])]),a("div",F,[t(k,{color:"primary",icon:"search",label:"Consultar",loading:o.loading,"no-caps":"",class:"full-width",onClick:n.fetchAll},null,8,["loading","onClick"])])]),_:1})]),_:1}),a("div",S,[a("div",C,[t(d,{flat:"",bordered:"",class:"kpi kpi-green"},{default:l(()=>[t(r,null,{default:l(()=>[s[3]||(s[3]=a("div",{class:"text-caption text-positive"},"Ingresos",-1)),a("div",V,i(n.money(o.kpis.ingresos))+" Bs",1)]),_:1})]),_:1})]),a("div",R,[t(d,{flat:"",bordered:"",class:"kpi kpi-red"},{default:l(()=>[t(r,null,{default:l(()=>[s[4]||(s[4]=a("div",{class:"text-caption text-negative"},"Egresos",-1)),a("div",A,i(n.money(o.kpis.egresos))+" Bs",1)]),_:1})]),_:1})]),a("div",I,[t(d,{flat:"",bordered:"",class:"kpi kpi-indigo"},{default:l(()=>[t(r,null,{default:l(()=>[s[5]||(s[5]=a("div",{class:"text-caption"},"Neto",-1)),a("div",M,i(n.money(o.kpis.neto))+" Bs",1)]),_:1})]),_:1})]),a("div",T,[t(d,{flat:"",bordered:"",class:"kpi"},{default:l(()=>[t(r,null,{default:l(()=>[s[6]||(s[6]=a("div",{class:"text-caption"},"Ticket promedio",-1)),a("div",U,i(n.money(o.kpis.ticket_promedio))+" Bs",1),a("div",P," #ventas: "+i(o.kpis.ventas)+" · ítems: "+i(o.kpis.items),1)]),_:1})]),_:1})])]),a("div",L,[a("div",O,[t(d,{flat:"",bordered:""},{default:l(()=>[t(r,{class:"row items-center"},{default:l(()=>[s[7]||(s[7]=a("div",{class:"text-subtitle1 text-weight-bold"},"Pagos",-1)),t(h),t(c,{color:"blue",outline:""},{default:l(()=>[m(" QR: "+i(n.money(o.qr.total))+" Bs ("+i(o.qr.items)+") ",1)]),_:1})]),_:1}),t(g),t(p,{rows:o.pagos,columns:o.colsPagos,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1})]),a("div",E,[t(d,{flat:"",bordered:""},{default:l(()=>[t(r,{class:"text-subtitle1 text-weight-bold"},{default:l(()=>[...s[8]||(s[8]=[m(" Mesas ",-1)])]),_:1}),t(g),t(p,{rows:o.mesas,columns:o.colsMesas,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1})])]),t(d,{flat:"",bordered:"",class:"q-mb-md"},{default:l(()=>[t(r,{class:"text-subtitle1 text-weight-bold"},{default:l(()=>[...s[9]||(s[9]=[m(" Movimiento por día ",-1)])]),_:1}),t(g),t(p,{rows:o.porDia,columns:o.colsDia,dense:"",flat:"",bordered:"","rows-per-page-options":[0]},null,8,["rows","columns"])]),_:1}),t(d,{flat:"",bordered:""},{default:l(()=>[t(r,{class:"row items-center"},{default:l(()=>[...s[10]||(s[10]=[a("div",{class:"text-subtitle1 text-weight-bold"},"Consumo de insumos",-1)])]),_:1}),t(g),t(p,{rows:o.insumos,columns:o.colsInsumos,dense:"",flat:"",bordered:"","rows-per-page-options":[10,20,0]},null,8,["rows","columns"]),t(g),t(r,{class:"row items-center q-gutter-sm"},{default:l(()=>[t(c,{color:"orange",outline:""},{default:l(()=>[m(" Cantidad usada: "+i(n.qty(o.insumosResumen.cantidad_usada)),1)]),_:1}),t(c,{color:"indigo",outline:""},{default:l(()=>[m(" Stock actual: "+i(n.qty(o.insumosResumen.stock_actual)),1)]),_:1}),t(c,{color:"teal",outline:""},{default:l(()=>[m(" Total (usado + stock): "+i(n.qty(o.insumosResumen.cantidad_total)),1)]),_:1}),t(h),t(c,{color:"brown",outline:""},{default:l(()=>[m(" Costo insumos: "+i(n.money(o.insumosResumen.costo_insumos))+" Bs ",1)]),_:1}),t(c,{color:"green",outline:""},{default:l(()=>[m(" Ganancia aprox: "+i(n.money(o.insumosResumen.ganancia_aprox))+" Bs ",1)]),_:1})]),_:1})]),_:1})]),_:1})}const $=x(q,[["render",G],["__scopeId","data-v-0ee2221d"]]);export{$ as default};
