import{j as ne,ad as fe,A as ge,E as pe,g as Z,ag as ve,k as g,l as b,T as he,as as re,r as H,X as be,L as ue,P as ye,at as _e,au as xe,av as Ce,aw as Ve,ax as we,ay as Se,az as te,aA as Fe,aB as ke,W as qe,_ as Pe,c as le,o as V,w as f,b as d,a,f as P,aj as N,d as K,a6 as F,a5 as B,a8 as ie,a9 as oe,t as I,a7 as ae,Q as X,e as O,am as se,h as Ne,ak as Ie}from"./index-B6V3Ze-P.js";import{Q as Y}from"./QSpace-BJqOMTX5.js";import{h as ze,Q as J}from"./format-D6R3fDkS.js";import{Q as De}from"./QBadge-BIHiN6Wi.js";import{Q as Qe}from"./QSelect-CoaHKff4.js";import{Q as Ae}from"./QForm-CfPgOmCl.js";import{Q as Te}from"./QPage-Bxs0I-s-.js";import"./QItem-Cs49oPqm.js";const je=ne({name:"QInnerLoading",props:{...ge,...fe,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:l}){const y=Z(),h=pe(e,y.proxy.$q),{transitionProps:i,transitionStyle:r}=ve(e),t=g(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(h.value===!0?" q-inner-loading--dark":"")),_=g(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function k(){const S=[b(re,{size:e.size,color:e.color})];return e.label!==void 0&&S.push(b("div",{class:_.value,style:e.labelStyle},[e.label])),S}function q(){return e.showing===!0?b("div",{class:t.value,style:r.value},l.default!==void 0?l.default():k()):null}return()=>b(he,i.value,q)}});function z(e,l,y,h){const i=[];return e.forEach(r=>{h(r)===!0?i.push(r):l.push({failedPropValidation:y,file:r})}),i}function E(e){e?.dataTransfer&&(e.dataTransfer.dropEffect="copy"),ue(e)}const Ue={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Be=["rejected"];function Oe({editable:e,dnd:l,getFileInput:y,addFilesToQueue:h}){const{props:i,emit:r,proxy:t}=Z(),_=H(null),k=g(()=>i.accept!==void 0?i.accept.split(",").map(o=>(o=o.trim(),o==="*"?"*/":(o.endsWith("/*")&&(o=o.slice(0,o.length-1)),o.toUpperCase()))):null),q=g(()=>parseInt(i.maxFiles,10)),S=g(()=>parseInt(i.maxTotalSize,10));function A(o){if(e.value)if(o!==Object(o)&&(o={target:null}),o.target?.matches('input[type="file"]')===!0)o.clientX===0&&o.clientY===0&&be(o);else{const x=y();x!==o.target&&x?.click(o)}}function T(o){e.value&&o&&h(null,o)}function L(o,x,D,Q){let n=Array.from(x||o.target.files);const v=[],w=()=>{v.length!==0&&r("rejected",v)};if(i.accept!==void 0&&k.value.indexOf("*/")===-1&&(n=z(n,v,"accept",u=>k.value.some(m=>u.type.toUpperCase().startsWith(m)||u.name.toUpperCase().endsWith(m))),n.length===0))return w();if(i.maxFileSize!==void 0){const u=parseInt(i.maxFileSize,10);if(n=z(n,v,"max-file-size",m=>m.size<=u),n.length===0)return w()}if(i.multiple!==!0&&n.length!==0&&(n=[n[0]]),n.forEach(u=>{u.__key=u.webkitRelativePath+u.lastModified+u.name+u.size}),Q===!0){const u=D.map(m=>m.__key);n=z(n,v,"duplicate",m=>u.includes(m.__key)===!1)}if(n.length===0)return w();if(i.maxTotalSize!==void 0){let u=Q===!0?D.reduce((m,W)=>m+W.size,0):0;if(n=z(n,v,"max-total-size",m=>(u+=m.size,u<=S.value)),n.length===0)return w()}if(typeof i.filter=="function"){const u=i.filter(n);n=z(n,v,"filter",m=>u.includes(m))}if(i.maxFiles!==void 0){let u=Q===!0?D.length:0;if(n=z(n,v,"max-files",()=>(u++,u<=q.value)),n.length===0)return w()}if(w(),n.length!==0)return n}function R(o){E(o),l.value!==!0&&(l.value=!0)}function c(o){ue(o),(o.relatedTarget!==null||ye.is.safari!==!0?o.relatedTarget!==_.value:document.elementsFromPoint(o.clientX,o.clientY).includes(_.value)===!1)===!0&&(l.value=!1)}function j(o){E(o);const x=o.dataTransfer.files;x.length!==0&&h(null,x),l.value=!1}function M(o){if(l.value===!0)return b("div",{ref:_,class:`q-${o}__dnd absolute-full`,onDragenter:E,onDragover:E,onDragleave:c,onDrop:j})}return Object.assign(t,{pickFiles:A,addFiles:T}),{pickFiles:A,addFiles:T,onDragover:R,onDragleave:c,processFiles:L,getDndNode:M,maxFilesNumber:q,maxTotalSizeNumber:S}}const Ee=ne({name:"QFile",inheritAttrs:!1,props:{...Ce,...xe,...Ue,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[..._e,...Be],setup(e,{slots:l,emit:y,attrs:h}){const{proxy:i}=Z(),r=Ve(),t=H(null),_=H(!1),k=we(e),{pickFiles:q,onDragover:S,onDragleave:A,processFiles:T,getDndNode:L}=Oe({editable:r.editable,dnd:_,getFileInput:$,addFilesToQueue:ee}),R=Se(e),c=g(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),j=g(()=>te(c.value)),M=g(()=>c.value.map(s=>s.name).join(", ")),o=g(()=>ze(c.value.reduce((s,p)=>s+p.size,0))),x=g(()=>({totalSize:o.value,filesNumber:c.value.length,maxFiles:e.maxFiles})),D=g(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:k.value,...h,id:r.targetUid.value,disabled:r.editable.value!==!0})),Q=g(()=>"q-file q-field--auto-height"+(_.value===!0?" q-file--dnd":"")),n=g(()=>e.multiple===!0&&e.append===!0);function v(s){const p=c.value.slice();p.splice(s,1),u(p)}function w(s){const p=c.value.indexOf(s);p!==-1&&v(p)}function u(s){y("update:modelValue",e.multiple===!0?s:s[0])}function m(s){s.keyCode===13&&qe(s)}function W(s){(s.keyCode===13||s.keyCode===32)&&q(s)}function $(){return t.value}function ee(s,p){const C=T(s,p,c.value,n.value),G=$();G!=null&&(G.value=""),C!==void 0&&((e.multiple===!0?e.modelValue&&C.every(me=>c.value.includes(me)):e.modelValue===C[0])||u(n.value===!0?c.value.concat(C):C))}function U(){return[b("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function de(){if(l.file!==void 0)return c.value.length===0?U():c.value.map((p,C)=>l.file({index:C,file:p,ref:this}));if(l.selected!==void 0)return c.value.length===0?U():l.selected({files:c.value,ref:this});if(e.useChips===!0)return c.value.length===0?U():c.value.map((p,C)=>b(J,{key:"file-"+C,removable:r.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{v(C)}},()=>b("span",{class:"ellipsis",textContent:p.name})));const s=e.displayValue!==void 0?e.displayValue:M.value;return s.length!==0?[b("div",{class:e.inputClass,style:e.inputStyle,textContent:s})]:U()}function ce(){const s={ref:t,...D.value,...R.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:ee};return e.multiple===!0&&(s.multiple=!0),b("input",s)}return Object.assign(r,{fieldClass:Q,emitValue:u,hasValue:j,inputRef:t,innerValue:c,floatingLabel:g(()=>j.value===!0||te(e.displayValue)),computedCounter:g(()=>{if(e.counterLabel!==void 0)return e.counterLabel(x.value);const s=e.maxFiles;return`${c.value.length}${s!==void 0?" / "+s:""} (${o.value})`}),getControlChild:()=>L("file"),getControl:()=>{const s={ref:r.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return r.editable.value===!0&&Object.assign(s,{onDragover:S,onDragleave:A,onKeydown:m,onKeyup:W}),b("div",s,[ce()].concat(de()))}}),Object.assign(i,{removeAtIndex:v,removeFile:w,getNativeElement:()=>t.value}),Fe(i,"nativeEl",()=>t.value),ke(r)}}),Le={name:"ProductsGrid",data(){return{loading:!1,search:"",categoryId:"all",categories:[{id:"Refrescos y Bebidas",name:"Refrescos y Bebidas",icon:"local_drink",color:"blue"},{id:"Acompañamientos",name:"Acompañamientos",icon:"restaurant",color:"teal"},{id:"Pollos",name:"Pollos",icon:"lunch_dining",color:"brown"}],products:[],dlg:!1,form:{id:null,name:"",categoria:null,description:"",price:0,unit:"UND",active:!0,ord:0,image_url:null},file:null,saving:!1}},computed:{filtered(){const e=(this.search||"").toLowerCase();return this.products.filter(l=>{const y=this.categoryId==="all"||l.categoria===this.categoryId,h=!e||String(l.name||"").toLowerCase().includes(e)||String(l.description||"").toLowerCase().includes(e);return y&&h})}},mounted(){this.fetchProducts()},methods:{toMoney(e){return Number(e||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},selectCategory(e){this.categoryId=e,this.fetchProducts()},async fetchProducts(){this.loading=!0;try{const e={};this.categoryId!=="all"&&(e.categoria=this.categoryId),this.search&&(e.q=this.search);const{data:l}=await this.$axios.get("productos",{params:e});this.products=Array.isArray(l)?l:[]}finally{this.loading=!1}},openNew(){this.form={id:null,name:"",categoria:null,description:"",price:0,unit:"UND",active:!0,ord:0,image_url:null},this.file=null,this.dlg=!0},openEdit(e){this.form={...e,id:e.id,image_url:e.image_url},this.file=null,this.dlg=!0},async save(){this.saving=!0;try{const e=new FormData;e.append("name",this.form.name),e.append("categoria",this.form.categoria||""),e.append("description",this.form.description||""),e.append("price",this.form.price??0),e.append("unit",this.form.unit||"UND"),e.append("active",this.form.active?1:0),e.append("ord",this.form.ord??0),this.file&&e.append("image",this.file),this.form.id?(e.append("_method","PUT"),await this.$axios.post(`productos/${this.form.id}`,e,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Producto actualizado"})):(await this.$axios.post("productos",e,{headers:{"Content-Type":"multipart/form-data"}}),this.$q.notify({type:"positive",message:"Producto creado"})),this.dlg=!1,this.fetchProducts()}catch(e){this.$q.notify({type:"negative",message:e.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}},emitAdd(e){this.$emit("add",e),this.$q.notify({type:"positive",message:`${e.name} agregado`})}},watch:{search(){this.fetchProducts()}}},Re={class:"row items-center q-gutter-sm q-mb-sm"},Me={class:"row q-col-gutter-sm q-mb-md"},We={class:"col-12"},Ge={class:"row items-center q-gutter-sm"},Ke={class:"row q-col-gutter-md"},Xe={class:"relative-position",style:{height:"180px",background:"#111"}},Ye=["src"],He={key:1,class:"full-width full-height flex flex-center text-white"},Je={class:"absolute-bottom-right q-ma-sm bg-red text-white",style:{padding:"4px 10px","border-radius":"999px","font-weight":"700"}},Ze={class:"absolute-bottom bg-gradient text-white q-pa-sm"},$e={class:"text-subtitle2 text-weight-bold ellipsis-2-lines"},et={class:"row items-center"},tt={class:"text-caption text-grey"},lt={key:0,class:"col-12"},it={class:"text-subtitle1"},ot={class:"row q-col-gutter-sm"},at={class:"col-12 col-md-8"},st={class:"col-12 col-md-4"},nt={class:"col-6"},rt={class:"col-6"},ut={class:"col-12"},dt={class:"col-12"},ct={key:0,class:"q-mt-sm"},mt=["src"],ft={class:"col-6"},gt={class:"col-6"},pt={class:"text-right q-mt-md"};function vt(e,l,y,h,i,r){return V(),le(Te,{class:"q-pa-md bg-grey-3"},{default:f(()=>[d("div",Re,[a(P,{flat:"",round:"",dense:"",icon:"menu",class:"lt-md"}),l[13]||(l[13]=d("div",{class:"text-h6 text-weight-bold"},"Productos",-1)),a(Y),a(P,{color:"positive",icon:"add_circle",label:"Nuevo","no-caps":"",onClick:r.openNew,class:"q-mr-sm"},null,8,["onClick"]),a(N,{modelValue:i.search,"onUpdate:modelValue":l[0]||(l[0]=t=>i.search=t),dense:"",outlined:"",debounce:"300",placeholder:"Buscar producto..."},{prepend:f(()=>[a(K,{name:"search"})]),_:1},8,["modelValue"])]),d("div",Me,[d("div",We,[d("div",Ge,[a(J,{clickable:"",color:i.categoryId==="all"?"indigo":"grey-4","text-color":i.categoryId==="all"?"white":"black",onClick:l[1]||(l[1]=t=>r.selectCategory("all")),icon:"public"},{default:f(()=>[...l[14]||(l[14]=[B("Todo",-1)])]),_:1},8,["color","text-color"]),(V(!0),F(ie,null,oe(i.categories,t=>(V(),le(J,{key:t.id,clickable:"",color:i.categoryId===t.id?t.color||"indigo":"grey-4","text-color":i.categoryId===t.id?"white":"black",onClick:_=>r.selectCategory(t.id),icon:t.icon||"category"},{default:f(()=>[B(I(t.name),1)]),_:2},1032,["color","text-color","onClick","icon"]))),128))])])]),d("div",Ke,[(V(!0),F(ie,null,oe(r.filtered,t=>(V(),F("div",{key:t.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[a(X,{class:"overflow-hidden hoverable"},{default:f(()=>[d("div",Xe,[t.image?(V(),F("img",{key:0,src:`${e.$url}/../storage/${t.image}`,alt:"img",style:{width:"100%",height:"100%","object-fit":"cover"},loading:"lazy"},null,8,Ye)):(V(),F("div",He,[a(K,{name:"image",size:"56px"})])),d("div",Je,I(r.toMoney(t.price))+" Bs ",1),d("div",Ze,[d("div",$e,I(t.name),1)])]),a(O,{class:"q-py-xs"},{default:f(()=>[d("div",et,[a(De,{outline:"",color:"grey-7",class:"q-mr-sm"},{default:f(()=>[B(I(t.unit),1)]),_:2},1024),d("div",tt,I(t.categoria||"—"),1),a(Y),a(P,{dense:"",round:"",flat:"",icon:"edit",onClick:se(_=>r.openEdit(t),["stop"])},null,8,["onClick"])])]),_:2},1024)]),_:2},1024)]))),128)),!i.loading&&!r.filtered.length?(V(),F("div",lt,[a(X,{flat:"",bordered:""},{default:f(()=>[a(O,{class:"text-center text-grey"},{default:f(()=>[...l[15]||(l[15]=[B("Sin resultados",-1)])]),_:1})]),_:1})])):ae("",!0)]),a(je,{showing:i.loading},{default:f(()=>[a(re,{size:"50px"})]),_:1},8,["showing"]),a(Ne,{modelValue:i.dlg,"onUpdate:modelValue":l[12]||(l[12]=t=>i.dlg=t),persistent:""},{default:f(()=>[a(X,{style:{width:"680px","max-width":"95vw"}},{default:f(()=>[a(O,{class:"row items-center q-pb-none"},{default:f(()=>[d("div",it,I(i.form.id?"Editar producto":"Nuevo producto"),1),a(Y),a(P,{flat:"",round:"",dense:"",icon:"close",onClick:l[2]||(l[2]=t=>i.dlg=!1)})]),_:1}),a(O,{class:"q-pt-none"},{default:f(()=>[a(Ae,{onSubmit:se(r.save,["prevent"])},{default:f(()=>[d("div",ot,[d("div",at,[a(N,{modelValue:i.form.name,"onUpdate:modelValue":l[3]||(l[3]=t=>i.form.name=t),label:"Nombre",dense:"",outlined:"",rules:[t=>!!t||"Requerido"]},null,8,["modelValue","rules"])]),d("div",st,[a(Qe,{modelValue:i.form.categoria,"onUpdate:modelValue":l[4]||(l[4]=t=>i.form.categoria=t),dense:"",outlined:"",label:"Categoría",options:i.categories.map(t=>t.id),"emit-value":"","map-options":"",rules:[t=>!!t||"Requerido"]},null,8,["modelValue","options","rules"])]),d("div",nt,[a(N,{modelValue:i.form.price,"onUpdate:modelValue":l[5]||(l[5]=t=>i.form.price=t),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Precio (Bs)",dense:"",outlined:"",rules:[t=>t>=0||"≥ 0"]},null,8,["modelValue","rules"])]),d("div",rt,[a(N,{modelValue:i.form.unit,"onUpdate:modelValue":l[6]||(l[6]=t=>i.form.unit=t),label:"Unidad (ej: UND, KG, LT)",dense:"",outlined:""},null,8,["modelValue"])]),d("div",ut,[a(N,{modelValue:i.form.description,"onUpdate:modelValue":l[7]||(l[7]=t=>i.form.description=t),type:"textarea",autogrow:"",label:"Descripción",dense:"",outlined:""},null,8,["modelValue"])]),d("div",dt,[a(Ee,{modelValue:i.file,"onUpdate:modelValue":l[8]||(l[8]=t=>i.file=t),label:"Imagen",dense:"",outlined:"",accept:".png,.jpg,.jpeg,.webp",counter:""},{prepend:f(()=>[a(K,{name:"image"})]),_:1},8,["modelValue"]),i.form.image_url?(V(),F("div",ct,[d("img",{src:i.form.image_url,alt:"preview",style:{"max-width":"160px","border-radius":"8px"}},null,8,mt)])):ae("",!0)]),d("div",ft,[a(Ie,{modelValue:i.form.active,"onUpdate:modelValue":l[9]||(l[9]=t=>i.form.active=t),label:"Activo"},null,8,["modelValue"])]),d("div",gt,[a(N,{modelValue:i.form.ord,"onUpdate:modelValue":l[10]||(l[10]=t=>i.form.ord=t),modelModifiers:{number:!0},type:"number",label:"Orden",dense:"",outlined:""},null,8,["modelValue"])])]),d("div",pt,[a(P,{flat:"",color:"negative",label:"Cancelar","no-caps":"",onClick:l[11]||(l[11]=t=>i.dlg=!1)}),a(P,{color:"primary",label:"Guardar","no-caps":"",class:"q-ml-sm",type:"submit",loading:i.saving},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const St=Pe(Le,[["render",vt],["__scopeId","data-v-e2f6fde0"]]);export{St as default};
