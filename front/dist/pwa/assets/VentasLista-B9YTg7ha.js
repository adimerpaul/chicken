import{j as le,aD as ae,A as oe,g as se,E as ne,k as g,r as ie,s as re,aE as M,aF as ue,l as E,aj as A,an as de,f as P,_ as ce,c as me,o as U,w as i,a as s,b as o,Q as y,e as _,t as d,a5 as f,h as ge,a6 as fe,a7 as be}from"./index-B6V3Ze-P.js";import{Q as B}from"./QSelect-CoaHKff4.js";import{b as pe,Q as j}from"./format-D6R3fDkS.js";import{Q as S}from"./QTd-LGHuZmid.js";import{Q as G}from"./QTable-BUplLhHL.js";import{Q as ve}from"./QSpace-BJqOMTX5.js";import{Q as ye}from"./QPage-Bxs0I-s-.js";import"./QItem-Cs49oPqm.js";import"./QList-DSXtuBMq.js";function N(e,t){return[!0,!1].includes(e)?e:t}const _e=le({name:"QPagination",props:{...oe,modelValue:{type:Number,required:!0},min:{type:[Number,String],default:1},max:{type:[Number,String],required:!0},maxPages:{type:[Number,String],default:0,validator:e=>(typeof e=="string"?parseInt(e,10):e)>=0},inputStyle:[Array,String,Object],inputClass:[Array,String,Object],size:String,disable:Boolean,input:Boolean,iconPrev:String,iconNext:String,iconFirst:String,iconLast:String,toFn:Function,boundaryLinks:{type:Boolean,default:null},boundaryNumbers:{type:Boolean,default:null},directionLinks:{type:Boolean,default:null},ellipses:{type:Boolean,default:null},ripple:{type:[Boolean,Object],default:null},round:Boolean,rounded:Boolean,flat:Boolean,outline:Boolean,unelevated:Boolean,push:Boolean,glossy:Boolean,color:{type:String,default:"primary"},textColor:String,activeDesign:{type:String,default:"",values:e=>e===""||ae.includes(e)},activeColor:String,activeTextColor:String,gutter:String,padding:{type:String,default:"3px 2px"}},emits:["update:modelValue"],setup(e,{emit:t}){const{proxy:m}=se(),{$q:c}=m,a=ne(e,c),r=g(()=>parseInt(e.min,10)),l=g(()=>parseInt(e.max,10)),O=g(()=>parseInt(e.maxPages,10)),I=g(()=>h.value+" / "+l.value),J=g(()=>N(e.boundaryLinks,e.input)),x=g(()=>N(e.boundaryNumbers,!e.input)),z=g(()=>N(e.directionLinks,e.input)),T=g(()=>N(e.ellipses,!e.input)),q=ie(null),h=g({get:()=>e.modelValue,set:n=>{if(n=parseInt(n,10),e.disable||isNaN(n))return;const u=pe(n,r.value,l.value);e.modelValue!==u&&t("update:modelValue",u)}});re(()=>`${r.value}|${l.value}`,()=>{h.value=e.modelValue});const H=g(()=>"q-pagination row no-wrap items-center"+(e.disable===!0?" disabled":"")),D=g(()=>e.gutter in M?`${M[e.gutter]}px`:e.gutter||null),K=g(()=>D.value!==null?`--q-pagination-gutter-parent:-${D.value};--q-pagination-gutter-child:${D.value}`:null),k=g(()=>{const n=[e.iconFirst||c.iconSet.pagination.first,e.iconPrev||c.iconSet.pagination.prev,e.iconNext||c.iconSet.pagination.next,e.iconLast||c.iconSet.pagination.last];return c.lang.rtl===!0?n.reverse():n}),Y=g(()=>({"aria-disabled":e.disable===!0?"true":"false",role:"navigation"})),Q=g(()=>ue(e,"flat")),W=g(()=>({[Q.value]:!0,round:e.round,rounded:e.rounded,padding:e.padding,color:e.color,textColor:e.textColor,size:e.size,ripple:e.ripple!==null?e.ripple:!0})),X=g(()=>{const n={[Q.value]:!1};return e.activeDesign!==""&&(n[e.activeDesign]=!0),n}),Z=g(()=>({...X.value,color:e.activeColor||e.color,textColor:e.activeTextColor||e.textColor})),V=g(()=>{let n=Math.max(O.value,1+(T.value?2:0)+(x.value?2:0));const u={pgFrom:r.value,pgTo:l.value,ellipsesStart:!1,ellipsesEnd:!1,boundaryStart:!1,boundaryEnd:!1,marginalStyle:{minWidth:`${Math.max(2,String(l.value).length)}em`}};return O.value&&n<l.value-r.value+1&&(n=1+Math.floor(n/2)*2,u.pgFrom=Math.max(r.value,Math.min(l.value-n+1,e.modelValue-Math.floor(n/2))),u.pgTo=Math.min(l.value,u.pgFrom+n-1),x.value&&(u.boundaryStart=!0,u.pgFrom++),T.value&&u.pgFrom>r.value+(x.value?1:0)&&(u.ellipsesStart=!0,u.pgFrom++),x.value&&(u.boundaryEnd=!0,u.pgTo--),T.value&&u.pgTo<l.value-(x.value?1:0)&&(u.ellipsesEnd=!0,u.pgTo--)),u});function F(n){h.value=n}function $(n){h.value=h.value+n}function R(){h.value=q.value,q.value=null,c.platform.is.mobile===!0&&document.activeElement.blur()}function ee(n){q.value=n}function te(n){de(n,13)===!0&&R()}function p(n,u,w){const v={"aria-label":u,"aria-current":"false",...W.value,...n};return w===!0&&Object.assign(v,{"aria-current":"true",...Z.value}),u!==void 0&&(e.toFn!==void 0?v.to=e.toFn(u):v.onClick=()=>{F(u)}),E(P,v)}return Object.assign(m,{set:F,setByOffset:$}),()=>{const n=[],u=[];let w;if(J.value===!0&&(n.push(p({key:"bls",disable:e.disable||e.modelValue<=r.value,icon:k.value[0],"aria-label":c.lang.pagination.first},r.value)),u.unshift(p({key:"ble",disable:e.disable||e.modelValue>=l.value,icon:k.value[3],"aria-label":c.lang.pagination.last},l.value))),z.value===!0&&(n.push(p({key:"bdp",disable:e.disable||e.modelValue<=r.value,icon:k.value[1],"aria-label":c.lang.pagination.prev},e.modelValue-1)),u.unshift(p({key:"bdn",disable:e.disable||e.modelValue>=l.value,icon:k.value[2],"aria-label":c.lang.pagination.next},e.modelValue+1))),e.input!==!0){w=[];const{pgFrom:v,pgTo:L,marginalStyle:C}=V.value;if(V.value.boundaryStart===!0){const b=r.value===e.modelValue;n.push(p({key:"bns",style:C,disable:e.disable,label:r.value},r.value,b))}if(V.value.boundaryEnd===!0){const b=l.value===e.modelValue;u.unshift(p({key:"bne",style:C,disable:e.disable,label:l.value},l.value,b))}V.value.ellipsesStart===!0&&n.push(p({key:"bes",style:C,disable:e.disable,label:"…",ripple:!1},v-1)),V.value.ellipsesEnd===!0&&u.unshift(p({key:"bee",style:C,disable:e.disable,label:"…",ripple:!1},L+1));for(let b=v;b<=L;b++)w.push(p({key:`bpg${b}`,style:C,disable:e.disable,label:b},b,b===e.modelValue))}return E("div",{class:H.value,...Y.value},[E("div",{class:"q-pagination__content row no-wrap items-center",style:K.value},[...n,e.input===!0?E(A,{class:"inline",style:{width:`${I.value.length/1.5}em`},type:"number",dense:!0,value:q.value,disable:e.disable,dark:a.value,borderless:!0,inputClass:e.inputClass,inputStyle:e.inputStyle,placeholder:I.value,min:r.value,max:l.value,"onUpdate:modelValue":ee,onKeyup:te,onBlur:R}):E("div",{class:"q-pagination__middle row justify-center"},w),...u])])}}}),he={name:"VentasListado",data(){const e=new Date().toISOString().slice(0,10);return{loading:!1,rows:[],meta:{current_page:1,last_page:1,total:0,from:0,to:0,per_page:20},pagination:{page:1,rowsPerPage:20,sortBy:"date",descending:!0},filters:{date_from:e,date_to:e,type:"",status:"",mesa:"",pago:"",q:""},summary:{total:0,count:0,by_type:[]},dlg:!1,current:null,columns:[{name:"numero",label:"#",field:"numero",align:"left",sortable:!0},{name:"date",label:"Fecha",field:"date",align:"left",sortable:!0},{name:"time",label:"Hora",field:t=>String(t.time).substring(0,8),align:"left"},{name:"name",label:"Cliente",field:"name",align:"left"},{name:"mesa",label:"Mesa",field:"mesa",align:"left"},{name:"pago",label:"Pago",field:"pago",align:"left"},{name:"type",label:"Tipo",field:"type",align:"left"},{name:"status",label:"Estado",field:"status",align:"left"},{name:"total",label:"Total (Bs)",field:"total",align:"right",sortable:!0},{name:"actions",label:"",field:"id",align:"right"}],detailCols:[{name:"name",label:"Producto",field:"name",align:"left"},{name:"qty",label:"Cant.",field:"qty",align:"right"},{name:"price",label:"Precio",field:"price",align:"right"},{name:"subtotal",label:"Subtotal",field:"subtotal",align:"right"}]}},mounted(){this.fetchSales()},methods:{money(e){return Number(e||0).toLocaleString("es-BO",{minimumFractionDigits:2,maximumFractionDigits:2})},typeColor(e){return e==="INGRESO"?"green":e==="EGRESO"?"orange":e==="CAJA"?"blue":"grey"},byType(e){const t=(this.summary.by_type||[]).find(m=>m.type===e);return t?Number(t.total||0):0},resetFilters(){Object.assign(this.filters,{date_from:"",date_to:"",type:"",status:"",mesa:"",pago:"",q:""}),this.pagination.page=1,this.fetchSales()},pageChange(){this.pagination.page=this.meta.current_page,this.fetchSales()},onRequest(){},async fetchSales(){this.loading=!0;try{const e={page:this.pagination.page,per_page:this.pagination.rowsPerPage,...this.filters},{data:t}=await this.$axios.get("sales",{params:e});Array.isArray(t?.data)&&t?.meta?(this.rows=t.data,this.meta={current_page:t.meta.current_page,last_page:t.meta.last_page,total:t.meta.total,from:t.meta.from,to:t.meta.to,per_page:t.meta.per_page},this.summary=t.summary||this.summary):(this.rows=t.data||[],this.meta={current_page:t.current_page||1,last_page:t.last_page||1,total:t.total||0,from:t.from||0,to:t.to||0,per_page:t.per_page||this.pagination.rowsPerPage},this.summary={total:this.rows.reduce((m,c)=>m+Number(c.total||0),0),count:this.rows.length,by_type:[{type:"INGRESO",total:this.rows.filter(m=>m.type==="INGRESO").reduce((m,c)=>m+Number(c.total||0),0)},{type:"EGRESO",total:this.rows.filter(m=>m.type==="EGRESO").reduce((m,c)=>m+Number(c.total||0),0)},{type:"CAJA",total:this.rows.filter(m=>m.type==="CAJA").reduce((m,c)=>m+Number(c.total||0),0)}]})}catch{this.$q.notify?.({type:"negative",message:"No se pudo cargar ventas"})}finally{this.loading=!1}},openDetail(e){this.current=e,this.dlg=!0}},watch:{"filters.type":"fetchSales","filters.status":"fetchSales","filters.mesa":"fetchSales","filters.pago":"fetchSales","filters.q":function(){this.pagination.page=1,this.fetchSales()},"filters.date_from":"fetchSales","filters.date_to":"fetchSales","pagination.rowsPerPage":"fetchSales"}},Se={class:"row items-end q-col-gutter-sm"},xe={class:"col-12 col-sm-2"},Ve={class:"col-12 col-sm-2"},we={class:"col-12 col-sm-2"},Ce={class:"col-12 col-sm-2"},Ee={class:"col-12 col-sm-2"},Pe={class:"col-12 col-sm-2"},qe={class:"col-12 col-sm-4"},ke={class:"col-12 col-sm-8 text-right"},Be={class:"row q-col-gutter-sm q-mt-sm"},Ne={class:"col-12 col-sm-3"},Ae={class:"text-h6 text-bold"},Oe={class:"col-12 col-sm-3"},Te={class:"text-h6 text-bold"},De={class:"col-12 col-sm-3"},Ie={class:"text-h6 text-positive text-bold"},Qe={class:"col-12 col-sm-3"},Fe={class:"text-h6 text-bold"},Re={class:"row items-center q-pa-sm"},Le={class:"col"},Me={class:"text-caption text-grey-7"},Ue={class:"col-auto"},je={class:"text-subtitle1"},Ge={class:"row q-col-gutter-sm q-mb-sm"},Je={class:"col-6"},ze={class:"col-3"},He={class:"col-3"},Ke={class:"col-6"},Ye={class:"col-6"},We={key:0,class:"col-12"},Xe={class:"text-right q-mt-sm text-h6"};function Ze(e,t,m,c,a,r){return U(),me(ye,{class:"bg-grey-3 q-pa-sm"},{default:i(()=>[s(y,{flat:"",bordered:""},{default:i(()=>[s(_,{class:"q-pa-sm"},{default:i(()=>[o("div",Se,[o("div",xe,[s(A,{modelValue:a.filters.date_from,"onUpdate:modelValue":t[0]||(t[0]=l=>a.filters.date_from=l),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),o("div",Ve,[s(A,{modelValue:a.filters.date_to,"onUpdate:modelValue":t[1]||(t[1]=l=>a.filters.date_to=l),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])]),o("div",we,[s(B,{modelValue:a.filters.type,"onUpdate:modelValue":t[2]||(t[2]=l=>a.filters.type=l),dense:"",outlined:"",label:"Tipo",options:["","INGRESO","EGRESO","CAJA"],"emit-value":"","map-options":""},null,8,["modelValue"])]),o("div",Ce,[s(B,{modelValue:a.filters.status,"onUpdate:modelValue":t[3]||(t[3]=l=>a.filters.status=l),dense:"",outlined:"",label:"Estado",options:["","ACTIVO","ANULADO"],"emit-value":"","map-options":""},null,8,["modelValue"])]),o("div",Ee,[s(B,{modelValue:a.filters.mesa,"onUpdate:modelValue":t[4]||(t[4]=l=>a.filters.mesa=l),dense:"",outlined:"",label:"Mesa",options:["","MESA","LLEVAR","DELIVERY","PEDIDOS YA"],"emit-value":"","map-options":""},null,8,["modelValue"])]),o("div",Pe,[s(B,{modelValue:a.filters.pago,"onUpdate:modelValue":t[5]||(t[5]=l=>a.filters.pago=l),dense:"",outlined:"",label:"Pago",options:["","EFECTIVO","TARJETA","ONLINE","QR"],"emit-value":"","map-options":""},null,8,["modelValue"])]),o("div",qe,[s(A,{modelValue:a.filters.q,"onUpdate:modelValue":t[6]||(t[6]=l=>a.filters.q=l),dense:"",outlined:"",debounce:"400",label:"Buscar (cliente, nro, comentario)"},null,8,["modelValue"])]),o("div",ke,[s(P,{flat:"",color:"primary",icon:"refresh",loading:a.loading,onClick:r.fetchSales,label:"Actualizar","no-caps":"",class:"q-mr-sm"},null,8,["loading","onClick"]),s(P,{outline:"",color:"primary",icon:"filter_alt_off",onClick:r.resetFilters,label:"Limpiar","no-caps":""},null,8,["onClick"])])])]),_:1})]),_:1}),o("div",Be,[o("div",Ne,[s(y,{flat:"",bordered:""},{default:i(()=>[s(_,{class:"q-pa-sm"},{default:i(()=>[t[10]||(t[10]=o("div",{class:"text-caption text-grey"},"Total (filtrado)",-1)),o("div",Ae,d(r.money(a.summary.total||0))+" Bs",1)]),_:1})]),_:1})]),o("div",Oe,[s(y,{flat:"",bordered:""},{default:i(()=>[s(_,{class:"q-pa-sm"},{default:i(()=>[t[11]||(t[11]=o("div",{class:"text-caption text-grey"},"# Ventas",-1)),o("div",Te,d(a.summary.count||0),1)]),_:1})]),_:1})]),o("div",De,[s(y,{flat:"",bordered:""},{default:i(()=>[s(_,{class:"q-pa-sm"},{default:i(()=>[t[12]||(t[12]=o("div",{class:"text-caption text-grey"},"Ingreso",-1)),o("div",Ie,d(r.money(r.byType("INGRESO")))+" Bs",1)]),_:1})]),_:1})]),o("div",Qe,[s(y,{flat:"",bordered:""},{default:i(()=>[s(_,{class:"q-pa-sm"},{default:i(()=>[t[13]||(t[13]=o("div",{class:"text-caption text-grey"},"Egreso/Caja",-1)),o("div",Fe,d(r.money(r.byType("EGRESO")+r.byType("CAJA")))+" Bs ",1)]),_:1})]),_:1})])]),s(y,{flat:"",bordered:"",class:"q-mt-sm"},{default:i(()=>[s(G,{rows:a.rows,columns:a.columns,"row-key":"id",flat:"",bordered:"",dense:"",loading:a.loading,"rows-per-page-options":[10,20,50],pagination:a.pagination,onRequest:r.onRequest},{"body-cell-status":i(l=>[s(S,{props:l},{default:i(()=>[s(j,{dense:"",color:l.row.status==="ACTIVO"?"green":"red","text-color":"white"},{default:i(()=>[f(d(l.row.status),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-type":i(l=>[s(S,{props:l},{default:i(()=>[s(j,{dense:"",color:r.typeColor(l.row.type),"text-color":"white"},{default:i(()=>[f(d(l.row.type),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-total":i(l=>[s(S,{props:l,class:"text-right"},{default:i(()=>[f(d(r.money(l.row.total)),1)]),_:2},1032,["props"])]),"body-cell-actions":i(l=>[s(S,{props:l,class:"text-right"},{default:i(()=>[s(P,{dense:"",flat:"",round:"",icon:"visibility",onClick:O=>r.openDetail(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"no-data":i(()=>[...t[14]||(t[14]=[o("div",{class:"full-width row flex-center q-pa-lg text-grey"}," Sin resultados ",-1)])]),_:1},8,["rows","columns","loading","pagination","onRequest"]),o("div",Re,[o("div",Le,[o("span",Me," Mostrando "+d(a.meta.from||0)+"–"+d(a.meta.to||0)+" de "+d(a.meta.total||0),1)]),o("div",Ue,[s(_e,{modelValue:a.meta.current_page,"onUpdate:modelValue":[t[7]||(t[7]=l=>a.meta.current_page=l),r.pageChange],max:a.meta.last_page||1,"max-pages":"8","direction-links":"","boundary-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])])]),_:1}),s(ge,{modelValue:a.dlg,"onUpdate:modelValue":t[9]||(t[9]=l=>a.dlg=l),persistent:""},{default:i(()=>[s(y,{style:{width:"800px","max-width":"95vw"}},{default:i(()=>[s(_,{class:"row items-center q-pb-none"},{default:i(()=>[o("div",je," Venta #"+d(a.current?.numero)+" — "+d(a.current?.date)+" "+d(a.current?.time?.substring(0,8)),1),s(ve),s(P,{flat:"",round:"",dense:"",icon:"close",onClick:t[8]||(t[8]=l=>a.dlg=!1)})]),_:1}),s(_,{class:"q-pt-none"},{default:i(()=>[o("div",Ge,[o("div",Je,[t[15]||(t[15]=o("b",null,"Cliente:",-1)),f(" "+d(a.current?.name),1)]),o("div",ze,[t[16]||(t[16]=o("b",null,"Mesa:",-1)),f(" "+d(a.current?.mesa),1)]),o("div",He,[t[17]||(t[17]=o("b",null,"Pago:",-1)),f(" "+d(a.current?.pago),1)]),o("div",Ke,[t[18]||(t[18]=o("b",null,"Tipo:",-1)),f(" "+d(a.current?.type),1)]),o("div",Ye,[t[19]||(t[19]=o("b",null,"Estado:",-1)),f(" "+d(a.current?.status),1)]),a.current?.comment?(U(),fe("div",We,[t[20]||(t[20]=o("b",null,"Comentario:",-1)),f(" "+d(a.current?.comment),1)])):be("",!0)]),s(G,{rows:a.current?.detalles||[],columns:a.detailCols,flat:"",bordered:"",dense:"","row-key":"id"},{"body-cell-subtotal":i(l=>[s(S,{props:l,class:"text-right"},{default:i(()=>[f(d(r.money(l.row.subtotal)),1)]),_:2},1032,["props"])]),"body-cell-price":i(l=>[s(S,{props:l,class:"text-right"},{default:i(()=>[f(d(r.money(l.row.price)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),o("div",Xe," Total: "+d(r.money(a.current?.total||0))+" Bs ",1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const rt=ce(he,[["render",Ze],["__scopeId","data-v-23c23b4e"]]);export{rt as default};
